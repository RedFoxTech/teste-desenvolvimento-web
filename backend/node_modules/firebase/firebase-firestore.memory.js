!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).firebase)}(this,function(Ud){"use strict";try{!function(){function t(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var e=t(Ud),r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function n(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var o=function(){return(o=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function y(t,s,a,u){return new(a=a||Promise)(function(n,e){function r(t){try{o(u.next(t))}catch(t){e(t)}}function i(t){try{o(u.throw(t))}catch(t){e(t)}}function o(t){var e;t.done?n(t.value):((e=t.value)instanceof a?e:new a(function(t){t(e)})).then(r,i)}o((u=u.apply(t,s||[])).next())})}function g(n,r){var i,o,s,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,o&&(s=2&e[0]?o.return:e[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,e[1])).done)return s;switch(o=0,(e=s?[2&e[0],s.value]:e)[0]){case 0:case 1:s=e;break;case 4:return a.label++,{value:e[1],done:!1};case 5:a.label++,o=e[1],e=[0];continue;case 7:e=a.ops.pop(),a.trys.pop();continue;default:if(!(s=0<(s=a.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){a=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){a.label=e[1];break}if(6===e[0]&&a.label<s[1]){a.label=s[1],s=e;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(e);break}s[2]&&a.ops.pop(),a.trys.pop();continue}e=r.call(n,a)}catch(t){e=[6,t],o=0}finally{i=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}function s(t,e){for(var n=0,r=e.length,i=t.length;n<r;n++,i++)t[i]=e[n];return t}var a={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray:function(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],i=0;i<t.length;i+=3){var o=t[i],s=i+1<t.length,a=s?t[i+1]:0,u=i+2<t.length,c=u?t[i+2]:0,h=(15&a)<<2|c>>6,c=63&c;u||(c=64,s||(h=64)),r.push(n[o>>2],n[(3&o)<<4|a>>4],n[h],n[c])}return r.join("")},encodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(function(t){for(var e=[],n=0,r=0;r<t.length;r++){var i=t.charCodeAt(r);i<128?e[n++]=i:(i<2048?e[n++]=i>>6|192:(55296==(64512&i)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&t.charCodeAt(++r)),e[n++]=i>>18|240,e[n++]=i>>12&63|128):e[n++]=i>>12|224,e[n++]=i>>6&63|128),e[n++]=63&i|128)}return e}(t),e)},decodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){for(var e=[],n=0,r=0;n<t.length;){var i,o,s,a=t[n++];a<128?e[r++]=String.fromCharCode(a):191<a&&a<224?(o=t[n++],e[r++]=String.fromCharCode((31&a)<<6|63&o)):239<a&&a<365?(i=((7&a)<<18|(63&(o=t[n++]))<<12|(63&(s=t[n++]))<<6|63&t[n++])-65536,e[r++]=String.fromCharCode(55296+(i>>10)),e[r++]=String.fromCharCode(56320+(1023&i))):(o=t[n++],s=t[n++],e[r++]=String.fromCharCode((15&a)<<12|(63&o)<<6|63&s))}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray:function(t,e){this.init_();for(var n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],i=0;i<t.length;){var o=n[t.charAt(i++)],s=i<t.length?n[t.charAt(i)]:0,a=++i<t.length?n[t.charAt(i)]:64,u=++i<t.length?n[t.charAt(i)]:64;if(++i,null==o||null==s||null==a||null==u)throw Error();r.push(o<<2|s>>4),64!==a&&(r.push(s<<4&240|a>>2),64!==u&&r.push(a<<6&192|u))}return r},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),(this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t)>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};function h(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}var i,u="FirebaseError",c=(n(l,i=Error),l);function l(t,e,n){e=i.call(this,e)||this;return e.code=t,e.customData=n,e.name=u,Object.setPrototypeOf(e,l.prototype),Error.captureStackTrace&&Error.captureStackTrace(e,f.prototype.create),e}var f=(p.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r,i=e[0]||{},o=this.service+"/"+t,t=this.errors[t],t=t?(r=i,t.replace(v,function(t,e){var n=r[e];return null!=n?String(n):"<"+e+"?>"})):"Error",t=this.serviceName+": "+t+" ("+o+").";return new c(o,t,i)},p);function p(t,e,n){this.service=t,this.serviceName=e,this.errors=n}var d,v=/\{\$([^}]+)}/g;function m(t){return t&&t._delegate?t._delegate:t}(N=d=d||{})[N.DEBUG=0]="DEBUG",N[N.VERBOSE=1]="VERBOSE",N[N.INFO=2]="INFO",N[N.WARN=3]="WARN",N[N.ERROR=4]="ERROR",N[N.SILENT=5]="SILENT";function w(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString(),o=E[e];if(!o)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[o].apply(console,s(["["+i+"]  "+t.name+":"],n))}}var b={debug:d.DEBUG,verbose:d.VERBOSE,info:d.INFO,warn:d.WARN,error:d.ERROR,silent:d.SILENT},_=d.INFO,E=((Ee={})[d.DEBUG]="log",Ee[d.VERBOSE]="log",Ee[d.INFO]="info",Ee[d.WARN]="warn",Ee[d.ERROR]="error",Ee),T=(Object.defineProperty(I.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in d))throw new TypeError('Invalid value "'+t+'" assigned to `logLevel`');this._logLevel=t},enumerable:!1,configurable:!0}),I.prototype.setLogLevel=function(t){this._logLevel="string"==typeof t?b[t]:t},Object.defineProperty(I.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!1,configurable:!0}),I.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,d.DEBUG],t)),this._logHandler.apply(this,s([this,d.DEBUG],t))},I.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,d.VERBOSE],t)),this._logHandler.apply(this,s([this,d.VERBOSE],t))},I.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,d.INFO],t)),this._logHandler.apply(this,s([this,d.INFO],t))},I.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,d.WARN],t)),this._logHandler.apply(this,s([this,d.WARN],t))},I.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,d.ERROR],t)),this._logHandler.apply(this,s([this,d.ERROR],t))},I);function I(t){this.name=t,this._logLevel=_,this._logHandler=w,this._userLogHandler=null}var S=function(t,e){return(S=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function A(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return{value:(t=t&&r>=t.length?void 0:t)&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var N,D="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},C={},R=D||self;function k(){}function O(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function L(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var P="closure_uid_"+(1e9*Math.random()>>>0),M=0;function F(t,e,n){return t.call.apply(t.bind,arguments)}function x(e,n,t){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,r),e.apply(n,t)}}return function(){return e.apply(n,arguments)}}function V(t,e,n){return(V=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?F:x).apply(null,arguments)}function U(e){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function q(t,o){function e(){}e.prototype=o.prototype,t.Z=o.prototype,t.prototype=new e,(t.prototype.constructor=t).Vb=function(t,e,n){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return o.prototype[e].apply(t,r)}}function j(){this.s=this.s,this.o=this.o}j.prototype.s=!1,j.prototype.na=function(){var t;!this.s&&(this.s=!0,this.M(),0)&&(t=this,Object.prototype.hasOwnProperty.call(t,P)&&t[P]||(t[P]=++M))},j.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var B=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},G=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function K(){return Array.prototype.concat.apply([],arguments)}function H(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function W(t){return/^[\s\xa0]*$/.test(t)}var Q,z=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function Y(t,e){return-1!=t.indexOf(e)}function X(t,e){return t<e?-1:e<t?1:0}t:{var J=R.navigator;if(J){J=J.userAgent;if(J){Q=J;break t}}Q=""}function $(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function Z(t){var e,n={};for(e in t)n[e]=t[e];return n}var tt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function et(t){for(var e,n,r=1;r<arguments.length;r++){for(e in n=arguments[r])t[e]=n[e];for(var i=0;i<tt.length;i++)e=tt[i],Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])}}function nt(t){return nt[" "](t),t}nt[" "]=k;var rt,it=Y(Q,"Opera"),ot=Y(Q,"Trident")||Y(Q,"MSIE"),st=Y(Q,"Edge"),at=st||ot,ut=Y(Q,"Gecko")&&!(Y(Q.toLowerCase(),"webkit")&&!Y(Q,"Edge"))&&!(Y(Q,"Trident")||Y(Q,"MSIE"))&&!Y(Q,"Edge"),ct=Y(Q.toLowerCase(),"webkit")&&!Y(Q,"Edge");function ht(){var t=R.document;return t?t.documentMode:void 0}t:{var lt="",ft=(ft=Q,ut?/rv:([^\);]+)(\)|;)/.exec(ft):st?/Edge\/([\d\.]+)/.exec(ft):ot?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(ft):ct?/WebKit\/(\S+)/.exec(ft):it?/(?:Version)[ \/]?(\S+)/.exec(ft):void 0);if(ft&&(lt=ft?ft[1]:""),ot){ft=ht();if(null!=ft&&ft>parseFloat(lt)){rt=String(ft);break t}}rt=lt}var pt={};function dt(){return t=function(){for(var t=0,e=z(String(rt)).split("."),n=z("9").split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++)for(var o=e[i]||"",s=n[i]||"";o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],(0!=o[0].length||0!=s[0].length)&&(t=X(0==o[1].length?0:parseInt(o[1],10),0==s[1].length?0:parseInt(s[1],10))||X(0==o[2].length,0==s[2].length)||X(o[2],s[2]),o=o[3],s=s[3],0==t););return 0<=t},e=pt,Object.prototype.hasOwnProperty.call(e,9)?e[9]:e[9]=t(9);var t,e}var yt=R.document&&ot&&(ht()||parseInt(rt,10))||void 0,gt=function(){if(!R.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{R.addEventListener("test",k,e),R.removeEventListener("test",k,e)}catch(t){}return t}();function vt(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}function mt(t,e){if(vt.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(ut){t:{try{nt(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:wt[t.pointerType]||"",this.state=t.state,(this.i=t).defaultPrevented&&mt.Z.h.call(this)}}vt.prototype.h=function(){this.defaultPrevented=!0},q(mt,vt);var wt={2:"touch",3:"pen",4:"mouse"};mt.prototype.h=function(){mt.Z.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var bt="closure_listenable_"+(1e6*Math.random()|0),_t=0;function Et(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ia=i,this.key=++_t,this.ca=this.fa=!1}function Tt(t){t.ca=!0,t.listener=null,t.proxy=null,t.src=null,t.ia=null}function It(t){this.src=t,this.g={},this.h=0}function St(t,e){var n,r,i,o=e.type;o in t.g&&(n=t.g[o],(i=0<=(r=B(n,e)))&&Array.prototype.splice.call(n,r,1),i&&(Tt(e),0==t.g[o].length&&(delete t.g[o],t.h--)))}function At(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.ca&&o.listener==e&&o.capture==!!n&&o.ia==r)return i}return-1}It.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.g[o])||(t=this.g[o]=[],this.h++);var s=At(t,e,r,i);return-1<s?(e=t[s],n||(e.fa=!1)):((e=new Et(e,this.src,o,!!r,i)).fa=n,t.push(e)),e};var Nt="closure_lm_"+(1e6*Math.random()|0),Dt={};function Ct(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(Array.isArray(n)){for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);return null}r=Ft(r);return e&&e[bt]?e.O(n,r,L(i)?!!i.capture:!!i,o):Rt(e,n,r,!0,i,o)}(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)Ct(t,e[o],n,r,i);return null}return n=Ft(n),t&&t[bt]?t.N(e,n,L(r)?!!r.capture:!!r,i):Rt(t,e,n,!1,r,i)}function Rt(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s,a=L(i)?!!i.capture:!!i,u=Pt(t);if(u||(t[Nt]=u=new It(t)),(n=u.add(e,n,r,a,o)).proxy)return n;if(s=Lt,(n.proxy=r=function t(e){return s.call(t.src,t.listener,e)}).src=t,r.listener=n,t.addEventListener)void 0===(i=!gt?a:i)&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Ot(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function kt(t){var e,n,r;"number"!=typeof t&&t&&!t.ca&&((e=t.src)&&e[bt]?St(e.i,t):(n=t.type,r=t.proxy,e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Ot(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Pt(e))?(St(n,t),0==n.h&&(n.src=null,e[Nt]=null)):Tt(t)))}function Ot(t){return t in Dt?Dt[t]:Dt[t]="on"+t}function Lt(t,e){var n,r;return t=!!t.ca||(e=new mt(e,this),n=t.listener,r=t.ia||t.src,t.fa&&kt(t),n.call(r,e))}function Pt(t){return(t=t[Nt])instanceof It?t:null}var Mt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ft(e){return"function"==typeof e?e:(e[Mt]||(e[Mt]=function(t){return e.handleEvent(t)}),e[Mt])}function xt(){j.call(this),this.i=new It(this),(this.P=this).I=null}function Vt(t,e){var n,r=t.I;if(r)for(n=[];r;r=r.I)n.push(r);if(t=t.P,r=e.type||e,"string"==typeof e?e=new vt(e,t):e instanceof vt?e.target=e.target||t:(s=e,et(e=new vt(r,t),s)),s=!0,n)for(var i=n.length-1;0<=i;i--)var o=e.g=n[i],s=Ut(o,r,!0,e)&&s;if(s=Ut(o=e.g=t,r,!0,e)&&s,s=Ut(o,r,!1,e)&&s,n)for(i=0;i<n.length;i++)s=Ut(o=e.g=n[i],r,!1,e)&&s}function Ut(t,e,n,r){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s,a,u=e[o];u&&!u.ca&&u.capture==n&&(s=u.listener,a=u.ia||u.src,u.fa&&St(t.i,u),i=!1!==s.call(a,r)&&i)}return i&&!r.defaultPrevented}q(xt,j),xt.prototype[bt]=!0,xt.prototype.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(Array.isArray(n))for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);else i=L(i)?!!i.capture:!!i,r=Ft(r),e&&e[bt]?(e=e.i,(n=String(n).toString())in e.g&&-1<(r=At(s=e.g[n],r,i,o))&&(Tt(s[r]),Array.prototype.splice.call(s,r,1),0==s.length&&(delete e.g[n],e.h--))):(e=e&&Pt(e))&&(n=e.g[n.toString()],(r=(e=-1)<(e=n?At(n,r,i,o):e)?n[e]:null)&&kt(r))}(this,t,e,n,r)},xt.prototype.M=function(){if(xt.Z.M.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],r=0;r<n.length;r++)Tt(n[r]);delete e.g[t],e.h--}}this.I=null},xt.prototype.N=function(t,e,n,r){return this.i.add(String(t),e,!1,n,r)},xt.prototype.O=function(t,e,n,r){return this.i.add(String(t),e,!0,n,r)};var qt=R.JSON.stringify;var jt=(Bt.prototype.add=function(t,e){var n=Gt.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n},Bt);function Bt(){this.h=this.g=null}var Gt=(Kt.prototype.get=function(){var t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t},new Kt(function(){return new Wt},function(t){return t.reset()}));function Kt(t,e){this.i=t,this.j=e,this.h=0,this.g=null}var Ht,Wt=(Qt.prototype.set=function(t,e){this.h=t,this.g=e,this.next=null},Qt.prototype.reset=function(){this.next=this.g=this.h=null},Qt);function Qt(){this.next=this.g=this.h=null}function zt(t,e){var n;Ht||(n=R.Promise.resolve(void 0),Ht=function(){n.then(Jt)}),Yt||(Ht(),Yt=!0),Xt.add(t,e)}var Yt=!1,Xt=new jt;function Jt(){for(var t;e=t=void 0,e=null,(t=Xt).g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),t=e;){try{t.h.call(t.g)}catch(t){!function(t){R.setTimeout(function(){throw t},0)}(t)}var e=Gt;e.j(t),e.h<100&&(e.h++,t.next=e.g,e.g=t)}Yt=!1}function $t(t,e){xt.call(this),this.h=t||1,this.g=e||R,this.j=V(this.kb,this),this.l=Date.now()}function Zt(t){t.da=!1,t.S&&(t.g.clearTimeout(t.S),t.S=null)}function te(t,e,n){if("function"==typeof t)n&&(t=V(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=V(t.handleEvent,t)}return 2147483647<Number(e)?-1:R.setTimeout(t,e||0)}q($t,xt),(N=$t.prototype).da=!1,N.S=null,N.kb=function(){var t;this.da&&(0<(t=Date.now()-this.l)&&t<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-t):(this.S&&(this.g.clearTimeout(this.S),this.S=null),Vt(this,"tick"),this.da&&(Zt(this),this.start())))},N.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},N.M=function(){$t.Z.M.call(this),Zt(this),delete this.g};var ee,ne,re,ie=(S(ne=se,re=ee=j),ne.prototype=null===re?Object.create(re):(oe.prototype=re.prototype,new oe),se.prototype.l=function(t){this.h=arguments,this.g?this.i=!0:function t(e){e.g=te(function(){e.g=null,e.i&&(e.i=!1,t(e))},e.j);var n=e.h;e.h=null,e.m.apply(null,n)}(this)},se.prototype.M=function(){ee.prototype.M.call(this),this.g&&(R.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)},se);function oe(){this.constructor=ne}function se(t,e){var n=ee.call(this)||this;return n.m=t,n.j=e,n.h=null,n.i=!1,n.g=null,n}function ae(t){j.call(this),this.h=t,this.g={}}q(ae,j);var ue=[];function ce(t,e,n,r){Array.isArray(n)||(n&&(ue[0]=n.toString()),n=ue);for(var i=0;i<n.length;i++){var o=Ct(e,n[i],r||t.handleEvent,!1,t.h||t);if(!o)break;t.g[o.key]=o}}function he(t){$(t.g,function(t,e){this.g.hasOwnProperty(e)&&kt(t)},t),t.g={}}function le(){this.g=!0}function fe(t,e,n,r){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(r.length<2)){var i=r[1];if(Array.isArray(i)&&!(i.length<1)){var o=i[0];if("noop"!=o&&"stop"!=o&&"close"!=o)for(var s=1;s<i.length;s++)i[s]=""}}}return qt(n)}catch(t){return e}}(t,n)+(r?" "+r:"")})}ae.prototype.M=function(){ae.Z.M.call(this),he(this)},ae.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},le.prototype.Aa=function(){this.g=!1},le.prototype.info=function(){};var pe={},de=null;function ye(){return de=de||new xt}function ge(t){vt.call(this,pe.Ma,t)}function ve(){var t=ye();Vt(t,new ge(t))}function me(t,e){vt.call(this,pe.STAT_EVENT,t),this.stat=e}function we(t){var e=ye();Vt(e,new me(e,t))}function be(t,e){vt.call(this,pe.Na,t),this.size=e}function _e(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return R.setTimeout(function(){t()},e)}pe.Ma="serverreachability",q(ge,vt),pe.STAT_EVENT="statevent",q(me,vt),pe.Na="timingevent",q(be,vt);var Ee={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},D={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function Te(){}function Ie(t){return t.h||(t.h=t.i())}function Se(){}Te.prototype.h=null;jt={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function Ae(){vt.call(this,"d")}function Ne(){vt.call(this,"c")}function De(){}function Ce(t,e,n,r){this.l=t,this.j=e,this.m=n,this.X=r||1,this.V=new ae(this),this.P=Oe,this.W=new $t(t=at?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new Re}function Re(){this.i=null,this.g="",this.h=!1}q(Ae,vt),q(Ne,vt),q(De,Te),De.prototype.g=function(){return new XMLHttpRequest},De.prototype.i=function(){return{}};var ke=new De,Oe=45e3,Le={},Pe={};function Me(t,e,n){t.K=1,t.v=rn(Je(e)),t.s=n,t.U=!0,Fe(t,null)}function Fe(t,e){t.F=Date.now(),Ue(t),t.A=Je(t.v);var s,a,u,c,h,l,n=t.A,r=t.X;Array.isArray(r)||(r=[String(r)]),vn(n.h,"t",r),t.C=0,n=t.l.H,t.h=new Re,t.g=mr(t.l,n?e:null,!t.s),0<t.O&&(t.L=new ie(V(t.Ia,t,t.g),t.O)),ce(t.V,t.g,"readystatechange",t.gb),e=t.H?Z(t.H):{},t.s?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ea(t.A,t.u,t.s,e)):(t.u="GET",t.g.ea(t.A,t.u,null,e)),ve(),s=t.j,a=t.u,u=t.A,c=t.m,h=t.X,l=t.s,s.info(function(){if(s.g)if(l)for(var t="",e=l.split("&"),n=0;n<e.length;n++){var r,i,o=e[n].split("=");1<o.length&&(r=o[0],o=o[1],t=2<=(i=r.split("_")).length&&"type"==i[1]?t+(r+"=")+o+"&":t+(r+"=redacted&"))}else t=null;else t=l;return"XMLHTTP REQ ("+c+") [attempt "+h+"]: "+a+"\n"+u+"\n"+t})}function xe(t){return t.g&&("GET"==t.u&&2!=t.K&&t.l.Ba)}function Ve(t,e,n){for(var r,i,o,s,a,u=!0;!t.I&&t.C<n.length;){if(o=n,a=s=void 0,s=(i=t).C,(r=-1==(a=o.indexOf("\n",s))?Pe:(s=Number(o.substring(s,a)),isNaN(s)?Le:(a+=1)+s>o.length?Pe:(o=o.substr(a,s),i.C=a+s,o)))==Pe){4==e&&(t.o=4,we(14),u=!1),fe(t.j,t.m,null,"[Incomplete Response]");break}if(r==Le){t.o=4,we(15),fe(t.j,t.m,n,"[Invalid Chunk]"),u=!1;break}fe(t.j,t.m,r,null),Ke(t,r)}xe(t)&&r!=Pe&&r!=Le&&(t.h.g="",t.C=0),4!=e||0!=n.length||t.h.h||(t.o=1,we(16),u=!1),t.i=t.i&&u,u?0<n.length&&!t.aa&&(t.aa=!0,(e=t.l).g==t&&e.$&&!e.L&&(e.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),hr(e),e.L=!0,we(11))):(fe(t.j,t.m,n,"[Invalid Chunked Response]"),Ge(t),Be(t))}function Ue(t){t.Y=Date.now()+t.P,qe(t,t.P)}function qe(t,e){if(null!=t.B)throw Error("WatchDog timer not null");t.B=_e(V(t.eb,t),e)}function je(t){t.B&&(R.clearTimeout(t.B),t.B=null)}function Be(t){0==t.l.G||t.I||pr(t.l,t)}function Ge(t){je(t);var e=t.L;e&&"function"==typeof e.na&&e.na(),t.L=null,Zt(t.W),he(t.V),t.g&&(e=t.g,t.g=null,e.abort(),e.na())}function Ke(t,e){try{var n=t.l;if(0!=n.G&&(n.g==t||Sn(n.i,t)))if(n.I=t.N,!t.J&&Sn(n.i,t)&&3==n.G){try{var r=n.Ca.g.parse(e)}catch(y){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!n.u){if(n.g){if(!(n.g.F+3e3<t.F))break t;fr(n),er(n)}cr(n),we(18)}}else n.ta=i[1],0<n.ta-n.U&&i[2]<37500&&n.N&&0==n.A&&!n.v&&(n.v=_e(V(n.ab,n),6e3));if(In(n.i)<=1&&n.ka){try{n.ka()}catch(y){}n.ka=void 0}}else yr(n,11)}else if(!t.J&&n.g!=t||fr(n),!W(e))for(i=n.Ca.g.parse(e),e=0;e<i.length;e++){var o,s,a,u,c,h,l,f,p,d,y=i[e];n.U=y[0],y=y[1],2==n.G?"c"==y[0]?(n.J=y[1],n.la=y[2],null!=(o=y[3])&&(n.ma=o,n.h.info("VER="+n.ma)),null!=(s=y[4])&&(n.za=s,n.h.info("SVER="+n.za)),null!=(a=y[5])&&"number"==typeof a&&0<a&&(r=1.5*a,n.K=r,n.h.info("backChannelRequestTimeoutMs_="+r)),r=n,(u=t.g)&&(!(c=u.g?u.g.getResponseHeader("X-Client-Wire-Protocol"):null)||!(h=r.i).g&&(Y(c,"spdy")||Y(c,"quic")||Y(c,"h2"))&&(h.j=h.l,h.g=new Set,h.h&&(An(h,h.h),h.h=null)),!r.D||(l=u.g?u.g.getResponseHeader("X-HTTP-Session-Id"):null)&&(r.sa=l,nn(r.F,r.D,l))),n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-t.F,n.h.info("Handshake RTT: "+n.O+"ms")),f=t,(r=n).oa=vr(r,r.H?r.la:null,r.W),f.J?(Nn(r.i,f),p=f,(d=r.K)&&p.setTimeout(d),p.B&&(je(p),Ue(p)),r.g=f):ur(r),0<n.l.length&&ir(n)):"stop"!=y[0]&&"close"!=y[0]||yr(n,7):3==n.G&&("stop"==y[0]||"close"==y[0]?"stop"==y[0]?yr(n,7):tr(n):"noop"!=y[0]&&n.j&&n.j.wa(y),n.A=0)}ve()}catch(y){}}function He(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(O(t)||"string"==typeof t)G(t,e,void 0);else{if(t.T&&"function"==typeof t.T)var n=t.T();else if(t.R&&"function"==typeof t.R)n=void 0;else if(O(t)||"string"==typeof t)for(var n=[],r=t.length,i=0;i<r;i++)n.push(i);else for(i in n=[],r=0,t)n[r++]=i;for(var i=(r=function(t){if(t.R&&"function"==typeof t.R)return t.R();if("string"==typeof t)return t.split("");if(O(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length,o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function We(t,e){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof We)for(n=t.T(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function Qe(t){if(t.i!=t.g.length){for(var e=0,n=0;e<t.g.length;){var r=t.g[e];ze(t.h,r)&&(t.g[n++]=r),e++}t.g.length=n}if(t.i!=t.g.length){for(var i={},n=e=0;e<t.g.length;)ze(i,r=t.g[e])||(i[t.g[n++]=r]=1),e++;t.g.length=n}}function ze(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(N=Ce.prototype).setTimeout=function(t){this.P=t},N.gb=function(t){t=t.target;var e=this.L;e&&3==Yn(t)?e.l():this.Ia(t)},N.Ia=function(t){try{if(t==this.g)t:{var e=Yn(this.g),n=this.g.Da();this.g.ba();if(!(e<3)&&(3!=e||at||this.g&&(this.h.h||this.g.ga()||Xn(this.g)))){this.I||4!=e||7==n||ve(),je(this);var r=this.g.ba();this.N=r;e:if(xe(this)){var i=Xn(this.g);t="";var o=i.length,s=4==Yn(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Ge(this),Be(this);var a="";break e}this.h.i=new R.TextDecoder}for(n=0;n<o;n++)this.h.h=!0,t+=this.h.i.decode(i[n],{stream:s&&n==o-1});i.splice(0,o),this.h.g+=t,this.C=0,a=this.h.g}else a=this.g.ga();if(this.i=200==r,l=this.j,f=this.u,p=this.A,d=this.m,y=this.X,g=e,v=r,l.info(function(){return"XMLHTTP RESP ("+d+") [ attempt "+y+"]: "+f+"\n"+p+"\n"+g+" "+v}),this.i){if(this.$&&!this.J){e:{if(this.g){var u,c=this.g;if((u=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!W(u)){var h=u;break e}}h=null}if(!(r=h)){this.i=!1,this.o=3,we(12),Ge(this),Be(this);break t}fe(this.j,this.m,r,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Ke(this,r)}this.U?(Ve(this,e,a),at&&this.i&&3==e&&(ce(this.V,this.W,"tick",this.fb),this.W.start())):(fe(this.j,this.m,a,null),Ke(this,a)),4==e&&Ge(this),this.i&&!this.I&&(4==e?pr(this.l,this):(this.i=!1,Ue(this)))}else 400==r&&0<a.indexOf("Unknown SID")?(this.o=3,we(12)):(this.o=0,we(13)),Ge(this),Be(this)}}}catch(e){}var l,f,p,d,y,g,v},N.fb=function(){var t,e;this.g&&(t=Yn(this.g),e=this.g.ga(),this.C<e.length&&(je(this),Ve(this,t,e),this.i&&4!=t&&Ue(this)))},N.cancel=function(){this.I=!0,Ge(this)},N.eb=function(){this.B=null;var t,e,n=Date.now();0<=n-this.Y?(t=this.j,e=this.A,t.info(function(){return"TIMEOUT: "+e}),2!=this.K&&(ve(),we(17)),Ge(this),this.o=2,Be(this)):qe(this,this.Y-n)},(N=We.prototype).R=function(){Qe(this);for(var t=[],e=0;e<this.g.length;e++)t.push(this.h[this.g[e]]);return t},N.T=function(){return Qe(this),this.g.concat()},N.get=function(t,e){return ze(this.h,t)?this.h[t]:e},N.set=function(t,e){ze(this.h,t)||(this.i++,this.g.push(t)),this.h[t]=e},N.forEach=function(t,e){for(var n=this.T(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var Ye=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Xe(t,e){var n;this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,t instanceof Xe?(this.g=void 0!==e?e:t.g,$e(this,t.j),this.s=t.s,Ze(this,t.i),tn(this,t.m),this.l=t.l,e=t.h,(n=new pn).i=e.i,e.g&&(n.g=new We(e.g),n.h=e.h),en(this,n),this.o=t.o):t&&(n=String(t).match(Ye))?(this.g=!!e,$e(this,n[1]||"",!0),this.s=on(n[2]||""),Ze(this,n[3]||"",!0),tn(this,n[4]),this.l=on(n[5]||"",!0),en(this,n[6]||"",!0),this.o=on(n[7]||"")):(this.g=!!e,this.h=new pn(null,this.g))}function Je(t){return new Xe(t)}function $e(t,e,n){t.j=n?on(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function Ze(t,e,n){t.i=n?on(e,!0):e}function tn(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.m=e}else t.m=null}function en(t,e,n){var r,i;e instanceof pn?(t.h=e,r=t.h,(i=t.g)&&!r.j&&(dn(r),r.i=null,r.g.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(yn(this,e),vn(this,n,t))},r)),r.j=i):(n||(e=sn(e,ln)),t.h=new pn(e,t.g))}function nn(t,e,n){t.h.set(e,n)}function rn(t){return nn(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function on(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function sn(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,an),t=n?t.replace(/%25([0-9a-fA-F]{2})/g,"%$1"):t):null}function an(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Xe.prototype.toString=function(){var t=[],e=this.j;e&&t.push(sn(e,un,!0),":");var n=this.i;return!n&&"file"!=e||(t.push("//"),(e=this.s)&&t.push(sn(e,un,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.l)&&(this.i&&"/"!=n.charAt(0)&&t.push("/"),t.push(sn(n,"/"==n.charAt(0)?hn:cn,!0))),(n=this.h.toString())&&t.push("?",n),(n=this.o)&&t.push("#",sn(n,fn)),t.join("")};var un=/[#\/\?@]/g,cn=/[#\?:]/g,hn=/[#\?]/g,ln=/[#\?@]/g,fn=/#/g;function pn(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function dn(n){n.g||(n.g=new We,n.h=0,n.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r,i=t[n].indexOf("="),o=null;0<=i?(r=t[n].substring(0,i),o=t[n].substring(i+1)):r=t[n],e(r,o?decodeURIComponent(o.replace(/\+/g," ")):"")}}}(n.i,function(t,e){n.add(decodeURIComponent(t.replace(/\+/g," ")),e)}))}function yn(t,e){dn(t),e=mn(t,e),ze(t.g.h,e)&&(t.i=null,t.h-=t.g.get(e).length,ze((t=t.g).h,e)&&(delete t.h[e],t.i--,t.g.length>2*t.i&&Qe(t)))}function gn(t,e){return dn(t),e=mn(t,e),ze(t.g.h,e)}function vn(t,e,n){yn(t,e),0<n.length&&(t.i=null,t.g.set(mn(t,e),H(n)),t.h+=n.length)}function mn(t,e){return e=String(e),e=t.j?e.toLowerCase():e}(N=pn.prototype).add=function(t,e){dn(this),this.i=null,t=mn(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},N.forEach=function(n,r){dn(this),this.g.forEach(function(t,e){G(t,function(t){n.call(r,t,e,this)},this)},this)},N.T=function(){dn(this);for(var t=this.g.R(),e=this.g.T(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},N.R=function(t){dn(this);var e=[];if("string"==typeof t)gn(this,t)&&(e=K(e,this.g.get(mn(this,t))));else{t=this.g.R();for(var n=0;n<t.length;n++)e=K(e,t[n])}return e},N.set=function(t,e){return dn(this),this.i=null,gn(this,t=mn(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},N.get=function(t,e){return t&&0<(t=this.R(t)).length?String(t[0]):e},N.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var t=[],e=this.g.T(),n=0;n<e.length;n++)for(var r=e[n],i=encodeURIComponent(String(r)),r=this.R(r),o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}return this.i=t.join("&")};var wn=function(t,e){this.h=t,this.g=e};function bn(t){this.l=t||En,t=R.PerformanceNavigationTiming?0<(t=R.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(R.g&&R.g.Ea&&R.g.Ea()&&R.g.Ea().Zb),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var _n,En=10;function Tn(t){return t.h||t.g&&t.g.size>=t.j}function In(t){return t.h?1:t.g?t.g.size:0}function Sn(t,e){return t.h?t.h==e:t.g&&t.g.has(e)}function An(t,e){t.g?t.g.add(e):t.h=e}function Nn(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function Dn(t){var e,n;if(null!=t.h)return t.i.concat(t.h.D);if(null==t.g||0===t.g.size)return H(t.i);var r=t.i;try{for(var i=A(t.g.values()),o=i.next();!o.done;o=i.next())var s=o.value,r=r.concat(s.D)}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}function Cn(){}function Rn(){this.g=new Cn}function kn(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}function On(t){this.l=t.$b||null,this.j=t.ib||!1}function Ln(t,e){xt.call(this),this.D=t,this.u=e,this.m=void 0,this.readyState=Pn,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}bn.prototype.cancel=function(){var e,t;if(this.i=Dn(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){try{for(var n=A(this.g.values()),r=n.next();!r.done;r=n.next())r.value.cancel()}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this.g.clear()}},Cn.prototype.stringify=function(t){return R.JSON.stringify(t,void 0)},Cn.prototype.parse=function(t){return R.JSON.parse(t,void 0)},q(On,Te),On.prototype.g=function(){return new Ln(this.l,this.j)},On.prototype.i=(_n={},function(){return _n}),q(Ln,xt);var Pn=0;function Mn(t){t.j.read().then(t.Sa.bind(t)).catch(t.ha.bind(t))}function Fn(t){t.readyState=4,t.l=null,t.j=null,t.A=null,xn(t)}function xn(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(N=Ln.prototype).open=function(t,e){if(this.readyState!=Pn)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,xn(this)},N.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;var e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.D||R).fetch(new Request(this.B,e)).then(this.Va.bind(this),this.ha.bind(this))},N.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Fn(this)),this.readyState=Pn},N.Va=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,xn(this)),this.g&&(this.readyState=3,xn(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==R.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Mn(this)}else t.text().then(this.Ua.bind(this),this.ha.bind(this))},N.Sa=function(t){var e;this.g&&(this.u&&t.value?this.response.push(t.value):this.u||(e=t.value||new Uint8Array(0),(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)),(t.done?Fn:xn)(this),3==this.readyState&&Mn(this))},N.Ua=function(t){this.g&&(this.response=this.responseText=t,Fn(this))},N.Ta=function(t){this.g&&(this.response=t,Fn(this))},N.ha=function(){this.g&&Fn(this)},N.setRequestHeader=function(t,e){this.v.append(t,e)},N.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},N.getAllResponseHeaders=function(){if(!this.h)return"";for(var t=[],e=this.h.entries(),n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(Ln.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var Vn=R.JSON.parse;function Un(t){xt.call(this),this.headers=new We,this.u=t||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=qn,this.K=this.L=!1}q(Un,xt);var qn="",jn=/^https?$/i,Bn=["POST","PUT"];function Gn(t){return"content-type"==t.toLowerCase()}function Kn(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,Hn(t),Qn(t)}function Hn(t){t.D||(t.D=!0,Vt(t,"complete"),Vt(t,"error"))}function Wn(t){if(t.h&&void 0!==C&&(!t.C[1]||4!=Yn(t)||2!=t.ba()))if(t.v&&4==Yn(t))te(t.Fa,0,t);else if(Vt(t,"readystatechange"),4==Yn(t)){t.h=!1;try{var e,n,r,i,o=t.ba();t:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var s=!0;break t;default:s=!1}if((e=s)||((n=0===o)&&(!(i=String(t.H).match(Ye)[1]||null)&&R.self&&R.self.location&&(i=(r=R.self.location.protocol).substr(0,r.length-1)),n=!jn.test(i?i.toLowerCase():"")),e=n),e)Vt(t,"complete"),Vt(t,"success");else{t.m=6;try{var a=2<Yn(t)?t.g.statusText:""}catch(t){a=""}t.j=a+" ["+t.ba()+"]",Hn(t)}}finally{Qn(t)}}}function Qn(t,e){if(t.g){zn(t);var n=t.g,r=t.C[0]?k:null;t.g=null,t.C=null,e||Vt(t,"ready");try{n.onreadystatechange=r}catch(t){}}}function zn(t){t.g&&t.K&&(t.g.ontimeout=null),t.A&&(R.clearTimeout(t.A),t.A=null)}function Yn(t){return t.g?t.g.readyState:0}function Xn(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.J){case qn:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(t){return null}}function Jn(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}var i;r||(i="",$(n,function(t,e){i+=e,i+=":",i+=t,i+="\r\n"}),n=i,"string"==typeof t?null!=n&&encodeURIComponent(String(n)):nn(t,e,n))}function $n(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Zn(t){this.za=0,this.l=[],this.h=new le,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=$n("failFast",!1,t),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=$n("baseRetryDelayMs",5e3,t),this.$a=$n("retryDelaySeedMs",1e4,t),this.Ya=$n("forwardChannelMaxRetries",2,t),this.ra=$n("forwardChannelRequestTimeoutMs",2e4,t),this.qa=t&&t.xmlHttpFactory||void 0,this.Ba=t&&t.Yb||!1,this.K=void 0,this.H=t&&t.supportsCrossDomainXhr||!1,this.J="",this.i=new bn(t&&t.concurrentRequestLimit),this.Ca=new Rn,this.ja=t&&t.fastHandshake||!1,this.Ra=t&&t.Wb||!1,t&&t.Aa&&this.h.Aa(),t&&t.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&t&&t.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!t||!1!==t.Xb}function tr(t){var e,n;nr(t),3==t.G&&(e=t.V++,nn(n=Je(t.F),"SID",t.J),nn(n,"RID",e),nn(n,"TYPE","terminate"),sr(t,n),(e=new Ce(t,t.h,e,void 0)).K=2,e.v=rn(Je(n)),n=!1,!(n=R.navigator&&R.navigator.sendBeacon?R.navigator.sendBeacon(e.v.toString(),""):n)&&R.Image&&((new Image).src=e.v,n=!0),n||(e.g=mr(e.l,null),e.g.ea(e.v)),e.F=Date.now(),Ue(e)),gr(t)}function er(t){t.g&&(hr(t),t.g.cancel(),t.g=null)}function nr(t){er(t),t.u&&(R.clearTimeout(t.u),t.u=null),fr(t),t.i.cancel(),t.m&&("number"==typeof t.m&&R.clearTimeout(t.m),t.m=null)}function rr(t,e){t.l.push(new wn(t.Za++,e)),3==t.G&&ir(t)}function ir(t){Tn(t.i)||t.m||(t.m=!0,zt(t.Ha,t),t.C=0)}function or(t,e){var n=e?e.m:t.V++,r=Je(t.F);nn(r,"SID",t.J),nn(r,"RID",n),nn(r,"AID",t.U),sr(t,r),t.o&&t.s&&Jn(r,t.o,t.s),n=new Ce(t,t.h,n,t.C+1),null===t.o&&(n.H=t.s),e&&(t.l=e.D.concat(t.l)),e=ar(t,n,1e3),n.setTimeout(Math.round(.5*t.ra)+Math.round(.5*t.ra*Math.random())),An(t.i,n),Me(n,r,e)}function sr(t,n){t.j&&He({},function(t,e){nn(n,e,t)})}function ar(t,e,n){n=Math.min(t.l.length,n);var r=t.j?V(t.j.Oa,t.j,t):null;t:for(var i=t.l,o=-1;;){var s=["count="+n];-1==o?0<n?(o=i[0].h,s.push("ofs="+o)):o=0:s.push("ofs="+o);for(var a=!0,u=0;u<n;u++){var c=i[u].h,h=i[u].g;if((c-=o)<0)o=Math.max(0,i[u].h-100),a=!1;else try{!function(t,r,e){var i=e||"";try{He(t,function(t,e){var n=t;L(t)&&(n=qt(t)),r.push(i+e+"="+encodeURIComponent(n))})}catch(t){throw r.push(i+"type="+encodeURIComponent("_badmap")),t}}(h,s,"req"+c+"_")}catch(t){r&&r(h)}}if(a){r=s.join("&");break t}}return t=t.l.splice(0,n),e.D=t,r}function ur(t){t.g||t.u||(t.Y=1,zt(t.Ga,t),t.A=0)}function cr(t){return!(t.g||t.u||3<=t.A)&&(t.Y++,t.u=_e(V(t.Ga,t),dr(t,t.A)),t.A++,1)}function hr(t){null!=t.B&&(R.clearTimeout(t.B),t.B=null)}function lr(t){t.g=new Ce(t,t.h,"rpc",t.Y),null===t.o&&(t.g.H=t.s),t.g.O=0;var e=Je(t.oa);nn(e,"RID","rpc"),nn(e,"SID",t.J),nn(e,"CI",t.N?"0":"1"),nn(e,"AID",t.U),sr(t,e),nn(e,"TYPE","xmlhttp"),t.o&&t.s&&Jn(e,t.o,t.s),t.K&&t.g.setTimeout(t.K);var n=t.g;t=t.la,n.K=1,n.v=rn(Je(e)),n.s=null,n.U=!0,Fe(n,t)}function fr(t){null!=t.v&&(R.clearTimeout(t.v),t.v=null)}function pr(t,e){var n,r,i,o=null;if(t.g==e){fr(t),hr(t),t.g=null;var s=2}else{if(!Sn(t.i,e))return;o=e.D,Nn(t.i,e),s=1}if(t.I=e.N,0!=t.G)if(e.i)1==s?(o=e.s?e.s.length:0,e=Date.now()-e.F,n=t.C,Vt(s=ye(),new be(s,o)),ir(t)):ur(t);else if(3==(n=e.o)||0==n&&0<t.I||(1!=s||(i=e,In((r=t).i)>=r.i.j-(r.m?1:0)||(r.m?(r.l=i.D.concat(r.l),0):1==r.G||2==r.G||r.C>=(r.Xa?0:r.Ya)||(r.m=_e(V(r.Ha,r,i),dr(r,r.C)),r.C++,0))))&&(2!=s||!cr(t)))switch(o&&0<o.length&&(e=t.i,e.i=e.i.concat(o)),n){case 1:yr(t,5);break;case 4:yr(t,10);break;case 3:yr(t,6);break;default:yr(t,2)}}function dr(t,e){var n=t.Pa+Math.floor(Math.random()*t.$a);return t.j||(n*=2),n*e}function yr(t,e){var n,r,i,o;t.h.info("Error code "+e),2==e?(r=null,t.j&&(r=null),o=V(t.jb,t),r||(r=new Xe("//www.google.com/images/cleardot.gif"),R.location&&"http"==R.location.protocol||$e(r,"https"),rn(r)),n=r.toString(),r=o,o=new le,R.Image?((i=new Image).onload=U(kn,o,i,"TestLoadImage: loaded",!0,r),i.onerror=U(kn,o,i,"TestLoadImage: error",!1,r),i.onabort=U(kn,o,i,"TestLoadImage: abort",!1,r),i.ontimeout=U(kn,o,i,"TestLoadImage: timeout",!1,r),R.setTimeout(function(){i.ontimeout&&i.ontimeout()},1e4),i.src=n):r(!1)):we(2),t.G=0,t.j&&t.j.va(e),gr(t),nr(t)}function gr(t){t.G=0,t.I=-1,t.j&&(0==Dn(t.i).length&&0==t.l.length||(t.i.i.length=0,H(t.l),t.l.length=0),t.j.ua())}function vr(t,e,n){var r,i,o,s,a,u=(s=n)instanceof Xe?Je(s):new Xe(s,void 0);return""!=u.i?(e&&Ze(u,e+"."+u.i),tn(u,u.m)):(a=R.location,r=a.protocol,i=e?e+"."+a.hostname:a.hostname,o=+a.port,s=n,a=new Xe(null,void 0),r&&$e(a,r),i&&Ze(a,i),o&&tn(a,o),s&&(a.l=s),u=a),t.aa&&$(t.aa,function(t,e){nn(u,e,t)}),e=t.D,n=t.sa,e&&n&&nn(u,e,n),nn(u,"VER",t.ma),sr(t,u),u}function mr(t,e,n){if(e&&!t.H)throw Error("Can't create secondary domain capable XhrIo object.");return(e=n&&t.Ba&&!t.qa?new Un(new On({ib:!0})):new Un(t.qa)).L=t.H,e}function wr(){}function br(){if(ot&&!(10<=Number(yt)))throw Error("Environmental error: no available transport.")}function _r(t,e){xt.call(this),this.g=new Zn(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(t?t["X-WebChannel-Client-Profile"]=e.ya:t={"X-WebChannel-Client-Profile":e.ya}),this.g.P=t,(t=e&&e.httpHeadersOverwriteParam)&&!W(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!W(e)&&(this.g.D=e,null!==(t=this.h)&&e in t&&(e in(t=this.h)&&delete t[e])),this.j=new Ir(this)}function Er(t){Ae.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function Tr(){Ne.call(this),this.status=1}function Ir(t){this.g=t}(N=Un.prototype).ea=function(t,e,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+t);e=e?e.toUpperCase():"GET",this.H=t,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=(this.u||ke).g(),this.C=this.u?Ie(this.u):Ie(ke),this.g.onreadystatechange=V(this.Fa,this);try{this.F=!0,this.g.open(e,String(t),!0),this.F=!1}catch(t){return void Kn(this,t)}t=n||"";var i,o=new We(this.headers);r&&He(r,function(t,e){o.set(e,t)}),r=function(t){t:{for(var e=Gn,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:"string"==typeof t?t.charAt(e):t[e]}(o.T()),n=R.FormData&&t instanceof R.FormData,0<=B(Bn,e)&&!r&&!n&&o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),o.forEach(function(t,e){this.g.setRequestHeader(e,t)},this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{zn(this),0<this.B&&((this.K=(i=this.g,ot&&dt()&&"number"==typeof i.timeout&&void 0!==i.ontimeout))?(this.g.timeout=this.B,this.g.ontimeout=V(this.pa,this)):this.A=te(this.pa,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(t){Kn(this,t)}},N.pa=function(){void 0!==C&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Vt(this,"timeout"),this.abort(8))},N.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,Vt(this,"complete"),Vt(this,"abort"),Qn(this))},N.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Qn(this,!0)),Un.Z.M.call(this)},N.Fa=function(){this.s||(this.F||this.v||this.l?Wn(this):this.cb())},N.cb=function(){Wn(this)},N.ba=function(){try{return 2<Yn(this)?this.g.status:-1}catch(t){return-1}},N.ga=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},N.Qa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Vn(e)}},N.Da=function(){return this.m},N.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(N=Zn.prototype).ma=8,N.G=1,N.hb=function(t){try{this.h.info("Origin Trials invoked: "+t)}catch(t){}},N.Ha=function(t){if(this.m)if(this.m=null,1==this.G){if(!t){this.V=Math.floor(1e5*Math.random()),t=this.V++;var e=new Ce(this,this.h,t,void 0),n=this.s;if(this.P&&(n?et(n=Z(n),this.P):n=this.P),null===this.o&&(e.H=n),this.ja)t:{for(var r=0,i=0;i<this.l.length;i++){var o=this.l[i];if("__data__"in o.g&&"string"==typeof(o=o.g.__data__)?o=o.length:o=void 0,void 0===o)break;if(4096<(r+=o)){r=i;break t}if(4096===r||i===this.l.length-1){r=i+1;break t}}r=1e3}else r=1e3;r=ar(this,e,r),nn(i=Je(this.F),"RID",t),nn(i,"CVER",22),this.D&&nn(i,"X-HTTP-Session-Id",this.D),sr(this,i),this.o&&n&&Jn(i,this.o,n),An(this.i,e),this.Ra&&nn(i,"TYPE","init"),this.ja?(nn(i,"$req",r),nn(i,"SID","null"),e.$=!0,Me(e,i,null)):Me(e,i,r),this.G=2}}else 3==this.G&&(t?or(this,t):0==this.l.length||Tn(this.i)||or(this))},N.Ga=function(){var t;this.u=null,lr(this),this.$&&!(this.L||null==this.g||this.O<=0)&&(t=2*this.O,this.h.info("BP detection timer enabled: "+t),this.B=_e(V(this.bb,this),t))},N.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,we(10),er(this),lr(this))},N.ab=function(){null!=this.v&&(this.v=null,er(this),cr(this),we(19))},N.jb=function(t){t?(this.h.info("Successfully pinged google.com"),we(2)):(this.h.info("Failed to ping google.com"),we(1))},(N=wr.prototype).xa=function(){},N.wa=function(){},N.va=function(){},N.ua=function(){},N.Oa=function(){},br.prototype.g=function(t,e){return new _r(t,e)},q(_r,xt),_r.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var t=this.g,e=this.l,n=this.h||void 0;t.Wa&&(t.h.info("Origin Trials enabled."),zt(V(t.hb,t,e))),we(0),t.W=e,t.aa=n||{},t.N=t.X,t.F=vr(t,null,t.W),ir(t)},_r.prototype.close=function(){tr(this.g)},_r.prototype.u=function(t){var e;"string"==typeof t?((e={}).__data__=t,rr(this.g,e)):this.v?((e={}).__data__=qt(t),rr(this.g,e)):rr(this.g,t)},_r.prototype.M=function(){this.g.j=null,delete this.j,tr(this.g),delete this.g,_r.Z.M.call(this)},q(Er,Ae),q(Tr,Ne),q(Ir,wr),Ir.prototype.xa=function(){Vt(this.g,"a")},Ir.prototype.wa=function(t){Vt(this.g,new Er(t))},Ir.prototype.va=function(t){Vt(this.g,new Tr)},Ir.prototype.ua=function(){Vt(this.g,"b")},br.prototype.createWebChannel=br.prototype.g,_r.prototype.send=_r.prototype.u,_r.prototype.open=_r.prototype.m,Ee.NO_ERROR=0,Ee.TIMEOUT=8,Ee.HTTP_ERROR=6,D.COMPLETE="complete",(Se.EventType=jt).OPEN="a",jt.CLOSE="b",jt.ERROR="c",jt.MESSAGE="d",xt.prototype.listen=xt.prototype.N,Un.prototype.listenOnce=Un.prototype.O,Un.prototype.getLastError=Un.prototype.La,Un.prototype.getLastErrorCode=Un.prototype.Da,Un.prototype.getStatus=Un.prototype.ba,Un.prototype.getResponseJson=Un.prototype.Qa,Un.prototype.getResponseText=Un.prototype.ga,Un.prototype.send=Un.prototype.ea;var Sr=ye,Ar=Ee,Nr=D,Dr=pe,Cr=10,Rr=11,kr=On,Or=Se,Lr=Un,Pr=(Mr.prototype.t=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},Mr.prototype.next=function(){var t=++this.previousValue;return this.i&&this.i(t),t},Mr);function Mr(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.t(t)},this.i=function(t){return e.writeSequenceNumber(t)})}Pr.o=-1;var Fr,xr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Vr=(n(qr,Fr=Error),qr),Ur=new T("@firebase/firestore");function qr(t,e){var n=this;return(n=Fr.call(this,e)||this).code=t,n.message=e,n.name="FirebaseError",n.toString=function(){return n.name+": [code="+n.code+"]: "+n.message},n}function jr(){return Ur.logLevel}function Br(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Ur.logLevel<=d.DEBUG&&(e=n.map(Hr),Ur.debug.apply(Ur,s(["Firestore (8.6.8): "+t],e)))}function Gr(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Ur.logLevel<=d.ERROR&&(e=n.map(Hr),Ur.error.apply(Ur,s(["Firestore (8.6.8): "+t],e)))}function Kr(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Ur.logLevel<=d.WARN&&(e=n.map(Hr),Ur.warn.apply(Ur,s(["Firestore (8.6.8): "+t],e)))}function Hr(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function Wr(t){t="FIRESTORE (8.6.8) INTERNAL ASSERTION FAILED: "+(t=void 0===t?"Unexpected state":t);throw Gr(t),new Error(t)}function Qr(t){t||Wr()}var zr=(Yr.u=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=function(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},Yr);function Yr(){}function Xr(t,e){return t<e?-1:e<t?1:0}function Jr(t,n,r){return t.length===n.length&&t.every(function(t,e){return r(t,n[e])})}var $r=(ei.now=function(){return ei.fromMillis(Date.now())},ei.fromDate=function(t){return ei.fromMillis(t.getTime())},ei.fromMillis=function(t){var e=Math.floor(t/1e3);return new ei(e,Math.floor(1e6*(t-1e3*e)))},ei.prototype.toDate=function(){return new Date(this.toMillis())},ei.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},ei.prototype._compareTo=function(t){return this.seconds===t.seconds?Xr(this.nanoseconds,t.nanoseconds):Xr(this.seconds,t.seconds)},ei.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},ei.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},ei.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},ei.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},ei),Zr=(ti.fromTimestamp=function(t){return new ti(t)},ti.min=function(){return new ti(new $r(0,0))},ti.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},ti.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},ti.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},ti.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},ti.prototype.toTimestamp=function(){return this.timestamp},ti);function ti(t){this.timestamp=t}function ei(t,e){if(this.seconds=t,(this.nanoseconds=e)<0)throw new Vr(xr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(1e9<=e)throw new Vr(xr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Vr(xr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(253402300800<=t)throw new Vr(xr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}function ni(t){var e,n=0;for(e in t)Object.prototype.hasOwnProperty.call(t,e)&&n++;return n}function ri(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function ii(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var oi,si,D=(Object.defineProperty(gi.prototype,"length",{get:function(){return this.len},enumerable:!1,configurable:!0}),gi.prototype.isEqual=function(t){return 0===gi.comparator(this,t)},gi.prototype.child=function(t){var e=this.segments.slice(this.offset,this.limit());return t instanceof gi?t.forEach(function(t){e.push(t)}):e.push(t),this.construct(e)},gi.prototype.limit=function(){return this.offset+this.length},gi.prototype.popFirst=function(t){return this.construct(this.segments,this.offset+(t=void 0===t?1:t),this.length-t)},gi.prototype.popLast=function(){return this.construct(this.segments,this.offset,this.length-1)},gi.prototype.firstSegment=function(){return this.segments[this.offset]},gi.prototype.lastSegment=function(){return this.get(this.length-1)},gi.prototype.get=function(t){return this.segments[this.offset+t]},gi.prototype.isEmpty=function(){return 0===this.length},gi.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},gi.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},gi.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},gi.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},gi.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(o<i)return 1}return t.length<e.length?-1:t.length>e.length?1:0},gi),ai=(n(yi,si=D),yi.prototype.construct=function(t,e,n){return new yi(t,e,n)},yi.prototype.canonicalString=function(){return this.toArray().join("/")},yi.prototype.toString=function(){return this.canonicalString()},yi.fromString=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=[],r=0,i=t;r<i.length;r++){var o=i[r];if(0<=o.indexOf("//"))throw new Vr(xr.INVALID_ARGUMENT,"Invalid segment ("+o+"). Paths must not contain // in them.");n.push.apply(n,o.split("/").filter(function(t){return 0<t.length}))}return new yi(n)},yi.emptyPath=function(){return new yi([])},yi),ui=/^[_a-zA-Z][_a-zA-Z0-9]*$/,ci=(n(di,oi=D),di.prototype.construct=function(t,e,n){return new di(t,e,n)},di.isValidIdentifier=function(t){return ui.test(t)},di.prototype.canonicalString=function(){return this.toArray().map(function(t){return t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),t=!di.isValidIdentifier(t)?"`"+t+"`":t}).join(".")},di.prototype.toString=function(){return this.canonicalString()},di.prototype.isKeyField=function(){return 1===this.length&&"__name__"===this.get(0)},di.keyField=function(){return new di(["__name__"])},di.fromServerFormat=function(t){for(var e=[],n="",r=0,i=function(){if(0===n.length)throw new Vr(xr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(n),n=""},o=!1;r<t.length;){var s=t[r];if("\\"===s){if(r+1===t.length)throw new Vr(xr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var a=t[r+1];if("\\"!==a&&"."!==a&&"`"!==a)throw new Vr(xr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=a,r+=2}else"`"===s?o=!o:"."!==s||o?n+=s:i(),r++}if(i(),o)throw new Vr(xr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new di(e)},di.emptyPath=function(){return new di([])},di),hi=(pi.prototype.covers=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].isPrefixOf(t))return!0;return!1},pi.prototype.isEqual=function(t){return Jr(this.fields,t.fields,function(t,e){return t.isEqual(e)})},pi),li=(fi.fromBase64String=function(t){return new fi(atob(t))},fi.fromUint8Array=function(t){return new fi(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t))},fi.prototype.toBase64=function(){return t=this.binaryString,btoa(t);var t},fi.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)},fi.prototype.approximateByteSize=function(){return 2*this.binaryString.length},fi.prototype.compareTo=function(t){return Xr(this.binaryString,t.binaryString)},fi.prototype.isEqual=function(t){return this.binaryString===t.binaryString},fi);function fi(t){this.binaryString=t}function pi(t){(this.fields=t).sort(ci.comparator)}function di(){return null!==oi&&oi.apply(this,arguments)||this}function yi(){return null!==si&&si.apply(this,arguments)||this}function gi(t,e,n){void 0===e?e=0:e>t.length&&Wr(),void 0===n?n=t.length-e:n>t.length-e&&Wr(),this.segments=t,this.offset=e,this.len=n}li.EMPTY_BYTE_STRING=new li("");var vi=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function mi(t){if(Qr(!!t),"string"!=typeof t)return{seconds:wi(t.seconds),nanos:wi(t.nanos)};var e=0,n=vi.exec(t);Qr(!!n),n[1]&&(n=((n=n[1])+"000000000").substr(0,9),e=Number(n));t=new Date(t);return{seconds:Math.floor(t.getTime()/1e3),nanos:e}}function wi(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function bi(t){return"string"==typeof t?li.fromBase64String(t):li.fromUint8Array(t)}function _i(t){return"server_timestamp"===(null===(t=((null===(t=null==t?void 0:t.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function Ei(t){t=mi(t.mapValue.fields.__local_write_time__.timestampValue);return new $r(t.seconds,t.nanos)}function Ti(t){return null==t}function Ii(t){return 0===t&&1/t==-1/0}var Si=(Ai.fromPath=function(t){return new Ai(ai.fromString(t))},Ai.fromName=function(t){return new Ai(ai.fromString(t).popFirst(5))},Ai.prototype.hasCollectionId=function(t){return 2<=this.path.length&&this.path.get(this.path.length-2)===t},Ai.prototype.isEqual=function(t){return null!==t&&0===ai.comparator(this.path,t.path)},Ai.prototype.toString=function(){return this.path.toString()},Ai.comparator=function(t,e){return ai.comparator(t.path,e.path)},Ai.isDocumentKey=function(t){return t.length%2==0},Ai.fromSegments=function(t){return new Ai(new ai(t.slice()))},Ai);function Ai(t){this.path=t}function Ni(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?_i(t)?4:10:Wr()}function Di(r,i){var t,e,n=Ni(r);if(n!==Ni(i))return!1;switch(n){case 0:return!0;case 1:return r.booleanValue===i.booleanValue;case 4:return Ei(r).isEqual(Ei(i));case 3:return function(t){if("string"==typeof r.timestampValue&&"string"==typeof t.timestampValue&&r.timestampValue.length===t.timestampValue.length)return r.timestampValue===t.timestampValue;var e=mi(r.timestampValue),t=mi(t.timestampValue);return e.seconds===t.seconds&&e.nanos===t.nanos}(i);case 5:return r.stringValue===i.stringValue;case 6:return e=i,bi(r.bytesValue).isEqual(bi(e.bytesValue));case 7:return r.referenceValue===i.referenceValue;case 8:return t=i,wi((e=r).geoPointValue.latitude)===wi(t.geoPointValue.latitude)&&wi(e.geoPointValue.longitude)===wi(t.geoPointValue.longitude);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return wi(t.integerValue)===wi(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){t=wi(t.doubleValue),e=wi(e.doubleValue);return t===e?Ii(t)===Ii(e):isNaN(t)&&isNaN(e)}return!1}(r,i);case 9:return Jr(r.arrayValue.values||[],i.arrayValue.values||[],Di);case 10:return function(){var t,e=r.mapValue.fields||{},n=i.mapValue.fields||{};if(ni(e)!==ni(n))return!1;for(t in e)if(e.hasOwnProperty(t)&&(void 0===n[t]||!Di(e[t],n[t])))return!1;return!0}();default:return Wr()}}function Ci(t,e){return void 0!==(t.values||[]).find(function(t){return Di(t,e)})}function Ri(t,e){var n,r,i,o=Ni(t),s=Ni(e);if(o!==s)return Xr(o,s);switch(o){case 0:return 0;case 1:return Xr(t.booleanValue,e.booleanValue);case 2:return r=e,i=wi(t.integerValue||t.doubleValue),r=wi(r.integerValue||r.doubleValue),i<r?-1:r<i?1:i===r?0:isNaN(i)?isNaN(r)?0:-1:1;case 3:return ki(t.timestampValue,e.timestampValue);case 4:return ki(Ei(t),Ei(e));case 5:return Xr(t.stringValue,e.stringValue);case 6:return function(t,e){t=bi(t),e=bi(e);return t.compareTo(e)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=Xr(n[i],r[i]);if(0!==o)return o}return Xr(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return n=t.geoPointValue,i=e.geoPointValue,0!==(r=Xr(wi(n.latitude),wi(i.latitude)))?r:Xr(wi(n.longitude),wi(i.longitude));case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=Ri(n[i],r[i]);if(o)return o}return Xr(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var a=Xr(r[s],o[s]);if(0!==a)return a;a=Ri(n[r[s]],i[o[s]]);if(0!==a)return a}return Xr(r.length,o.length)}(t.mapValue,e.mapValue);default:throw Wr()}}function ki(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Xr(t,e);var n=mi(t),t=mi(e),e=Xr(n.seconds,t.seconds);return 0!==e?e:Xr(n.nanos,t.nanos)}function Oi(t){return function s(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){t=mi(t);return"time("+t.seconds+","+t.nanos+")"}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?bi(t.bytesValue).toBase64():"referenceValue"in t?(e=t.referenceValue,Si.fromName(e).toString()):"geoPointValue"in t?"geo("+(e=t.geoPointValue).latitude+","+e.longitude+")":"arrayValue"in t?function(t){for(var e="[",n=!0,r=0,i=t.values||[];r<i.length;r++)n?n=!1:e+=",",e+=s(i[r]);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+s(t.fields[o])}return e+"}"}(t.mapValue):Wr();var e}(t)}function Li(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.canonicalString()}}function Pi(t){return t&&"integerValue"in t}function Mi(t){return!!t&&"arrayValue"in t}function Fi(t){return t&&"nullValue"in t}function xi(t){return t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Vi(t){return t&&"mapValue"in t}function Ui(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue)return{timestampValue:Object.assign({},mi(t.timestampValue))};if(t.mapValue){var n={mapValue:{fields:{}}};return ri(t.mapValue.fields,function(t,e){return n.mapValue.fields[t]=Ui(e)}),n}if(t.arrayValue){for(var e={arrayValue:{values:[]}},r=0;r<(t.arrayValue.values||[]).length;++r)e.arrayValue.values[r]=Ui(t.arrayValue.values[r]);return e}return Object.assign({},t)}var qi=(ji.empty=function(){return new ji({mapValue:{}})},ji.prototype.field=function(t){if(t.isEmpty())return this.value;for(var e=this.value,n=0;n<t.length-1;++n)if(!Vi(e=(e.mapValue.fields||{})[t.get(n)]))return null;return(e=(e.mapValue.fields||{})[t.lastSegment()])||null},ji.prototype.set=function(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Ui(e)},ji.prototype.setAll=function(t){var r=this,i=ci.emptyPath(),o={},s=[];t.forEach(function(t,e){var n;i.isImmediateParentOf(e)||(n=r.getFieldsMap(i),r.applyChanges(n,o,s),o={},s=[],i=e.popLast()),t?o[e.lastSegment()]=Ui(t):s.push(e.lastSegment())});t=this.getFieldsMap(i);this.applyChanges(t,o,s)},ji.prototype.delete=function(t){var e=this.field(t.popLast());Vi(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]},ji.prototype.isEqual=function(t){return Di(this.value,t.value)},ji.prototype.getFieldsMap=function(t){var e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(var n=0;n<t.length;++n){var r=e.mapValue.fields[t.get(n)];Vi(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=r),e=r}return e.mapValue.fields},ji.prototype.applyChanges=function(n,t,e){ri(t,function(t,e){return n[t]=e});for(var r=0,i=e;r<i.length;r++){var o=i[r];delete n[o]}},ji.prototype.clone=function(){return new ji(Ui(this.value))},ji);function ji(t){this.value=t}var Bi=(Ki.newInvalidDocument=function(t){return new Ki(t,0,Zr.min(),qi.empty(),0)},Ki.newFoundDocument=function(t,e,n){return new Ki(t,1,e,n,0)},Ki.newNoDocument=function(t,e){return new Ki(t,2,e,qi.empty(),0)},Ki.newUnknownDocument=function(t,e){return new Ki(t,3,e,qi.empty(),2)},Ki.prototype.convertToFoundDocument=function(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this},Ki.prototype.convertToNoDocument=function(t){return this.version=t,this.documentType=2,this.data=qi.empty(),this.documentState=0,this},Ki.prototype.convertToUnknownDocument=function(t){return this.version=t,this.documentType=3,this.data=qi.empty(),this.documentState=2,this},Ki.prototype.setHasCommittedMutations=function(){return this.documentState=2,this},Ki.prototype.setHasLocalMutations=function(){return this.documentState=1,this},Object.defineProperty(Ki.prototype,"hasLocalMutations",{get:function(){return 1===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(Ki.prototype,"hasCommittedMutations",{get:function(){return 2===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(Ki.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!1,configurable:!0}),Ki.prototype.isValidDocument=function(){return 0!==this.documentType},Ki.prototype.isFoundDocument=function(){return 1===this.documentType},Ki.prototype.isNoDocument=function(){return 2===this.documentType},Ki.prototype.isUnknownDocument=function(){return 3===this.documentType},Ki.prototype.isEqual=function(t){return t instanceof Ki&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)},Ki.prototype.clone=function(){return new Ki(this.key,this.documentType,this.version,this.data.clone(),this.documentState)},Ki.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+JSON.stringify(this.data.value)+", {documentType: "+this.documentType+"}), {documentState: "+this.documentState+"})"},Ki),Gi=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.h=null};function Ki(t,e,n,r,i){this.key=t,this.documentType=e,this.version=n,this.data=r,this.documentState=i}function Hi(t,e,n,r,i,o,s){return new Gi(t,e=void 0===e?null:e,n=void 0===n?[]:n,r=void 0===r?[]:r,i=void 0===i?null:i,o=void 0===o?null:o,s=void 0===s?null:s)}function Wi(t){var e=t;return null===e.h&&(t=e.path.canonicalString(),null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(function(t){return(t=t).field.canonicalString()+t.op.toString()+Oi(t.value)}).join(","),t+="|ob:",t+=e.orderBy.map(function(t){return(t=t).field.canonicalString()+t.dir}).join(","),Ti(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=Eo(e.startAt)),e.endAt&&(t+="|ub:",t+=Eo(e.endAt)),e.h=t),e.h}function Qi(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n,r,i=0;i<t.orderBy.length;i++)if(n=t.orderBy[i],r=e.orderBy[i],n.dir!==r.dir||!n.field.isEqual(r.field))return!1;if(t.filters.length!==e.filters.length)return!1;for(var o,s,a=0;a<t.filters.length;a++)if(o=t.filters[a],s=e.filters[a],o.op!==s.op||!o.field.isEqual(s.field)||!Di(o.value,s.value))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!So(t.startAt,e.startAt)&&So(t.endAt,e.endAt)}function zi(t){return Si.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}var Yi,Xi=(n(Ji,Yi=function(){}),Ji.create=function(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.l(t,e,n):new eo(t,e,n):"array-contains"===e?new fo(t,n):"in"===e?new po(t,n):"not-in"===e?new yo(t,n):"array-contains-any"===e?new go(t,n):new Ji(t,e,n)},Ji.l=function(t,e,n){return new("in"===e?no:ro)(t,n)},Ji.prototype.matches=function(t){t=t.data.field(this.field);return"!="===this.op?null!==t&&this.m(Ri(t,this.value)):null!==t&&Ni(this.value)===Ni(t)&&this.m(Ri(t,this.value))},Ji.prototype.m=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return 0<t;case">=":return 0<=t;default:return Wr()}},Ji.prototype.g=function(){return 0<=["<","<=",">",">=","!=","not-in"].indexOf(this.op)},Ji);function Ji(t,e,n){var r=this;return(r=Yi.call(this)||this).field=t,r.op=e,r.value=n,r}var $i,Zi,to,eo=(n(so,to=Xi),so.prototype.matches=function(t){t=Si.comparator(t.key,this.key);return this.m(t)},so),no=(n(oo,Zi=Xi),oo.prototype.matches=function(e){return this.keys.some(function(t){return t.isEqual(e.key)})},oo),ro=(n(io,$i=Xi),io.prototype.matches=function(e){return!this.keys.some(function(t){return t.isEqual(e.key)})},io);function io(t,e){var n=this;return(n=$i.call(this,t,"not-in",e)||this).keys=ao(0,e),n}function oo(t,e){var n=this;return(n=Zi.call(this,t,"in",e)||this).keys=ao(0,e),n}function so(t,e,n){var r=this;return(r=to.call(this,t,e,n)||this).key=Si.fromName(n.referenceValue),r}function ao(t,e){return((null===(e=e.arrayValue)||void 0===e?void 0:e.values)||[]).map(function(t){return Si.fromName(t.referenceValue)})}var uo,co,ho,lo,fo=(n(_o,lo=Xi),_o.prototype.matches=function(t){t=t.data.field(this.field);return Mi(t)&&Ci(t.arrayValue,this.value)},_o),po=(n(bo,ho=Xi),bo.prototype.matches=function(t){t=t.data.field(this.field);return null!==t&&Ci(this.value.arrayValue,t)},bo),yo=(n(wo,co=Xi),wo.prototype.matches=function(t){if(Ci(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;t=t.data.field(this.field);return null!==t&&!Ci(this.value.arrayValue,t)},wo),go=(n(mo,uo=Xi),mo.prototype.matches=function(t){var e=this,t=t.data.field(this.field);return!(!Mi(t)||!t.arrayValue.values)&&t.arrayValue.values.some(function(t){return Ci(e.value.arrayValue,t)})},mo),vo=function(t,e){this.position=t,this.before=e};function mo(t,e){return uo.call(this,t,"array-contains-any",e)||this}function wo(t,e){return co.call(this,t,"not-in",e)||this}function bo(t,e){return ho.call(this,t,"in",e)||this}function _o(t,e){return lo.call(this,t,"array-contains",e)||this}function Eo(t){return(t.before?"b":"a")+":"+t.position.map(Oi).join(",")}var To=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function Io(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i],r=o.field.isKeyField()?Si.comparator(Si.fromName(s.referenceValue),n.key):Ri(s,n.data.field(o.field));if("desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function So(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!Di(t.position[n],e.position[n]))return!1;return!0}var Ao=function(t,e,n,r,i,o,s,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=s,this.endAt=a,this.p=null,this.T=null,this.startAt,this.endAt};function No(t){return new Ao(t)}function Do(t){return!Ti(t.limit)&&"F"===t.limitType}function Co(t){return!Ti(t.limit)&&"L"===t.limitType}function Ro(t){return 0<t.explicitOrderBy.length?t.explicitOrderBy[0].field:null}function ko(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.g())return r.field}return null}function Oo(t){return null!==t.collectionGroup}function Lo(t){var e=t;if(null===e.p){e.p=[];var n=ko(e),t=Ro(e);if(null!==n&&null===t)n.isKeyField()||e.p.push(new To(n)),e.p.push(new To(ci.keyField(),"asc"));else{for(var r=!1,i=0,o=e.explicitOrderBy;i<o.length;i++){var s=o[i];e.p.push(s),s.field.isKeyField()&&(r=!0)}r||(n=0<e.explicitOrderBy.length?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc",e.p.push(new To(ci.keyField(),n)))}}return e.p}function Po(t){var e=t;if(!e.T)if("F"===e.limitType)e.T=Hi(e.path,e.collectionGroup,Lo(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=Lo(e);r<i.length;r++){var o=i[r],s="desc"===o.dir?"asc":"desc";n.push(new To(o.field,s))}var a=e.endAt?new vo(e.endAt.position,!e.endAt.before):null,t=e.startAt?new vo(e.startAt.position,!e.startAt.before):null;e.T=Hi(e.path,e.collectionGroup,n,e.filters,e.limit,a,t)}return e.T}function Mo(t,e,n){return new Ao(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Fo(t,e){return Qi(Po(t),Po(e))&&t.limitType===e.limitType}function xo(t){return Wi(Po(t))+"|lt:"+t.limitType}function Vo(t){return"Query(target="+(e=Po(t),n=e.path.canonicalString(),null!==e.collectionGroup&&(n+=" collectionGroup="+e.collectionGroup),0<e.filters.length&&(n+=", filters: ["+e.filters.map(function(t){return(t=t).field.canonicalString()+" "+t.op+" "+Oi(t.value)}).join(", ")+"]"),Ti(e.limit)||(n+=", limit: "+e.limit),0<e.orderBy.length&&(n+=", orderBy: ["+e.orderBy.map(function(t){return(t=t).field.canonicalString()+" ("+t.dir+")"}).join(", ")+"]"),e.startAt&&(n+=", startAt: "+Eo(e.startAt)),e.endAt&&(n+=", endAt: "+Eo(e.endAt)),"Target("+n+")")+"; limitType="+t.limitType+")";var e,n}function Uo(i,t){return t.isFoundDocument()&&(e=i,n=t.key.path,null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):Si.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n))&&function(t){for(var e=0,n=i.explicitOrderBy;e<n.length;e++){var r=n[e];if(!r.field.isKeyField()&&null===t.data.field(r.field))return}return 1}(t)&&function(t){for(var e=0,n=i.filters;e<n.length;e++)if(!n[e].matches(t))return;return 1}(t)&&(n=t,(!(t=i).startAt||Io(t.startAt,Lo(t),n))&&(!t.endAt||!Io(t.endAt,Lo(t),n)));var e,n}function qo(a){return function(t,e){for(var n=!1,r=0,i=Lo(a);r<i.length;r++){var o=i[r],s=function(t,r,e){var n=t.field.isKeyField()?Si.comparator(r.key,e.key):function(t,e){var n=r.data.field(t),t=e.data.field(t);return null!==n&&null!==t?Ri(n,t):Wr()}(t.field,e);switch(t.dir){case"asc":return n;case"desc":return-1*n;default:return Wr()}}(o,t,e);if(0!==s)return s;n=n||o.field.isKeyField()}return 0}}function jo(t,e){if(t.I){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ii(e)?"-0":e}}function Bo(t){return{integerValue:""+t}}function Go(t,e){return"number"==typeof(n=e)&&Number.isInteger(n)&&!Ii(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER?Bo(e):jo(t,e);var n}T=function(){this._=void 0};function Ko(t,e){return t instanceof rs?Pi(t=e)||t&&"doubleValue"in t?e:{integerValue:0}:null}var Ho,Wo,Qo=(n(Xo,Wo=T),Xo),zo=(n(Yo,Ho=T),Yo);function Yo(t){var e=this;return(e=Ho.call(this)||this).elements=t,e}function Xo(){return null!==Wo&&Wo.apply(this,arguments)||this}function Jo(t,e){for(var n=ss(e),r=0,i=t.elements;r<i.length;r++)!function(e){n.some(function(t){return Di(t,e)})||n.push(e)}(i[r]);return{arrayValue:{values:n}}}var $o,Zo=(n(ts,$o=T),ts);function ts(t){var e=this;return(e=$o.call(this)||this).elements=t,e}function es(t,e){for(var n=ss(e),r=0,i=t.elements;r<i.length;r++)!function(e){n=n.filter(function(t){return!Di(t,e)})}(i[r]);return{arrayValue:{values:n}}}var ns,rs=(n(is,ns=T),is);function is(t,e){var n=this;return(n=ns.call(this)||this).R=t,n.A=e,n}function os(t){return wi(t.integerValue||t.doubleValue)}function ss(t){return Mi(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}function as(t,e){this.field=t,this.transform=e}function us(t,e){this.version=t,this.transformResults=e}var cs=(hs.none=function(){return new hs},hs.exists=function(t){return new hs(void 0,t)},hs.updateTime=function(t){return new hs(t)},Object.defineProperty(hs.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),hs.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},hs);function hs(t,e){this.updateTime=t,this.exists=e}function ls(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}D=function(){};function fs(t,e,n){var r,i,o,s;t instanceof vs?(i=e,o=n,ls((r=t).precondition,i)&&(s=r.value.clone(),o=Ts(r.fieldTransforms,o,i),s.setAll(o),i.convertToFoundDocument(ds(i),s).setHasLocalMutations())):t instanceof ms?(o=e,i=n,ls((s=t).precondition,o)&&(n=Ts(s.fieldTransforms,i,o),(i=o.data).setAll(_s(s)),i.setAll(n),o.convertToFoundDocument(ds(o),i).setHasLocalMutations())):(e=e,ls(t.precondition,e)&&e.convertToNoDocument(Zr.min()))}function ps(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&(n=t.fieldTransforms,r=e.fieldTransforms,!!(void 0===n&&void 0===r||n&&r&&Jr(n,r,function(t,e){return e=e,(t=t).field.isEqual(e.field)&&(t=t.transform,e=e.transform,t instanceof zo&&e instanceof zo||t instanceof Zo&&e instanceof Zo?Jr(t.elements,e.elements,Di):t instanceof rs&&e instanceof rs?Di(t.A,e.A):t instanceof Qo&&e instanceof Qo)})))&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask));var n,r}function ds(t){return t.isFoundDocument()?t.version:Zr.min()}var ys,gs,vs=(n(bs,gs=D),bs),ms=(n(ws,ys=D),ws);function ws(t,e,n,r,i){void 0===i&&(i=[]);var o=this;return(o=ys.call(this)||this).key=t,o.data=e,o.fieldMask=n,o.precondition=r,o.fieldTransforms=i,o.type=1,o}function bs(t,e,n,r){void 0===r&&(r=[]);var i=this;return(i=gs.call(this)||this).key=t,i.value=e,i.precondition=n,i.fieldTransforms=r,i.type=0,i}function _s(n){var r=new Map;return n.fieldMask.fields.forEach(function(t){var e;t.isEmpty()||(e=n.data.field(t),r.set(t,e))}),r}function Es(t,e,n){var r=new Map;Qr(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],s=o.transform,a=e.data.field(o.field);r.set(o.field,(o=s,s=a,a=n[i],o instanceof zo?Jo(o,s):o instanceof Zo?es(o,s):a))}return r}function Ts(t,e,n){for(var r,i=new Map,o=0,s=t;o<s.length;o++){var a=s[o],u=a.transform,c=n.data.field(a.field);i.set(a.field,(r=c,a=e,c=void 0,(u=u)instanceof Qo?(c={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:a.seconds,nanos:a.nanoseconds}}}},r&&(c.fields.__previous_value__=r),{mapValue:c}):u instanceof zo?Jo(u,r):u instanceof Zo?es(u,r):(u=Ko(c=u,r),r=os(u)+os(c.A),Pi(u)&&Pi(c.A)?Bo(r):jo(c.R,r))))}return i}function Is(t){this.count=t}var Ss,As,Ns,Ds=(n(ks,Ns=D),ks),Cs=(n(Rs,As=D),Rs);function Rs(t,e){var n=this;return(n=As.call(this)||this).key=t,n.precondition=e,n.type=3,n.fieldTransforms=[],n}function ks(t,e){var n=this;return(n=Ns.call(this)||this).key=t,n.precondition=e,n.type=2,n.fieldTransforms=[],n}function Os(t){switch(t){case xr.OK:return Wr(),0;case xr.CANCELLED:case xr.UNKNOWN:case xr.DEADLINE_EXCEEDED:case xr.RESOURCE_EXHAUSTED:case xr.INTERNAL:case xr.UNAVAILABLE:case xr.UNAUTHENTICATED:return;case xr.INVALID_ARGUMENT:case xr.NOT_FOUND:case xr.ALREADY_EXISTS:case xr.PERMISSION_DENIED:case xr.FAILED_PRECONDITION:case xr.ABORTED:case xr.OUT_OF_RANGE:case xr.UNIMPLEMENTED:case xr.DATA_LOSS:return 1;default:return Wr(),0}}function Ls(t){if(void 0===t)return Gr("GRPC error has no .code"),xr.UNKNOWN;switch(t){case Ss.OK:return xr.OK;case Ss.CANCELLED:return xr.CANCELLED;case Ss.UNKNOWN:return xr.UNKNOWN;case Ss.DEADLINE_EXCEEDED:return xr.DEADLINE_EXCEEDED;case Ss.RESOURCE_EXHAUSTED:return xr.RESOURCE_EXHAUSTED;case Ss.INTERNAL:return xr.INTERNAL;case Ss.UNAVAILABLE:return xr.UNAVAILABLE;case Ss.UNAUTHENTICATED:return xr.UNAUTHENTICATED;case Ss.INVALID_ARGUMENT:return xr.INVALID_ARGUMENT;case Ss.NOT_FOUND:return xr.NOT_FOUND;case Ss.ALREADY_EXISTS:return xr.ALREADY_EXISTS;case Ss.PERMISSION_DENIED:return xr.PERMISSION_DENIED;case Ss.FAILED_PRECONDITION:return xr.FAILED_PRECONDITION;case Ss.ABORTED:return xr.ABORTED;case Ss.OUT_OF_RANGE:return xr.OUT_OF_RANGE;case Ss.UNIMPLEMENTED:return xr.UNIMPLEMENTED;case Ss.DATA_LOSS:return xr.DATA_LOSS;default:return Wr()}}(T=Ss=Ss||{})[T.OK=0]="OK",T[T.CANCELLED=1]="CANCELLED",T[T.UNKNOWN=2]="UNKNOWN",T[T.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",T[T.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",T[T.NOT_FOUND=5]="NOT_FOUND",T[T.ALREADY_EXISTS=6]="ALREADY_EXISTS",T[T.PERMISSION_DENIED=7]="PERMISSION_DENIED",T[T.UNAUTHENTICATED=16]="UNAUTHENTICATED",T[T.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",T[T.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",T[T.ABORTED=10]="ABORTED",T[T.OUT_OF_RANGE=11]="OUT_OF_RANGE",T[T.UNIMPLEMENTED=12]="UNIMPLEMENTED",T[T.INTERNAL=13]="INTERNAL",T[T.UNAVAILABLE=14]="UNAVAILABLE",T[T.DATA_LOSS=15]="DATA_LOSS";var Ps=(Us.prototype.insert=function(t,e){return new Us(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,Fs.BLACK,null,null))},Us.prototype.remove=function(t){return new Us(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Fs.BLACK,null,null))},Us.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:0<n&&(e=e.right)}return null},Us.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;n=r<0?n.left:(e+=n.left.size+1,n.right)}return-1},Us.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(Us.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),Us.prototype.minKey=function(){return this.root.minKey()},Us.prototype.maxKey=function(){return this.root.maxKey()},Us.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},Us.prototype.forEach=function(n){this.inorderTraversal(function(t,e){return n(t,e),!1})},Us.prototype.toString=function(){var n=[];return this.inorderTraversal(function(t,e){return n.push(t+":"+e),!1}),"{"+n.join(", ")+"}"},Us.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},Us.prototype.getIterator=function(){return new Ms(this.root,null,this.comparator,!1)},Us.prototype.getIteratorFrom=function(t){return new Ms(this.root,t,this.comparator,!1)},Us.prototype.getReverseIterator=function(){return new Ms(this.root,null,this.comparator,!0)},Us.prototype.getReverseIteratorFrom=function(t){return new Ms(this.root,t,this.comparator,!0)},Us),Ms=(Vs.prototype.getNext=function(){var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},Vs.prototype.hasNext=function(){return 0<this.nodeStack.length},Vs.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},Vs),Fs=(xs.prototype.copy=function(t,e,n,r,i){return new xs(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},xs.prototype.isEmpty=function(){return!1},xs.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},xs.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},xs.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},xs.prototype.minKey=function(){return this.min().key},xs.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},xs.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},xs.prototype.removeMin=function(){if(this.left.isEmpty())return xs.EMPTY;var t=this;return(t=(t=!t.left.isRed()&&!t.left.left.isRed()?t.moveRedLeft():t).copy(null,null,null,t.left.removeMin(),null)).fixUp()},xs.prototype.remove=function(t,e){var n,r=this;if(e(t,r.key)<0)r=(r=!(r.left.isEmpty()||r.left.isRed()||r.left.left.isRed())?r.moveRedLeft():r).copy(null,null,null,r.left.remove(t,e),null);else{if(0===e(t,(r=!((r=r.left.isRed()?r.rotateRight():r).right.isEmpty()||r.right.isRed()||r.right.left.isRed())?r.moveRedRight():r).key)){if(r.right.isEmpty())return xs.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp()},xs.prototype.isRed=function(){return this.color},xs.prototype.fixUp=function(){var t=this;return t=(t=(t=t.right.isRed()&&!t.left.isRed()?t.rotateLeft():t).left.isRed()&&t.left.left.isRed()?t.rotateRight():t).left.isRed()&&t.right.isRed()?t.colorFlip():t},xs.prototype.moveRedLeft=function(){var t=this.colorFlip();return t=t.right.left.isRed()?(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip():t},xs.prototype.moveRedRight=function(){var t=this.colorFlip();return t=t.left.left.isRed()?(t=t.rotateRight()).colorFlip():t},xs.prototype.rotateLeft=function(){var t=this.copy(null,null,xs.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},xs.prototype.rotateRight=function(){var t=this.copy(null,null,xs.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},xs.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},xs.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},xs.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw Wr();if(this.right.isRed())throw Wr();var t=this.left.check();if(t!==this.right.check())throw Wr();return t+(this.isRed()?0:1)},xs);function xs(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:xs.RED,this.left=null!=r?r:xs.EMPTY,this.right=null!=i?i:xs.EMPTY,this.size=this.left.size+1+this.right.size}function Vs(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}function Us(t,e){this.comparator=t,this.root=e||Fs.EMPTY}function qs(){this.size=0}Fs.EMPTY=null,Fs.RED=!0,Fs.BLACK=!1,Fs.EMPTY=(Object.defineProperty(qs.prototype,"key",{get:function(){throw Wr()},enumerable:!1,configurable:!0}),Object.defineProperty(qs.prototype,"value",{get:function(){throw Wr()},enumerable:!1,configurable:!0}),Object.defineProperty(qs.prototype,"color",{get:function(){throw Wr()},enumerable:!1,configurable:!0}),Object.defineProperty(qs.prototype,"left",{get:function(){throw Wr()},enumerable:!1,configurable:!0}),Object.defineProperty(qs.prototype,"right",{get:function(){throw Wr()},enumerable:!1,configurable:!0}),qs.prototype.copy=function(t,e,n,r,i){return this},qs.prototype.insert=function(t,e,n){return new Fs(t,e)},qs.prototype.remove=function(t,e){return this},qs.prototype.isEmpty=function(){return!0},qs.prototype.inorderTraversal=function(t){return!1},qs.prototype.reverseTraversal=function(t){return!1},qs.prototype.minKey=function(){return null},qs.prototype.maxKey=function(){return null},qs.prototype.isRed=function(){return!1},qs.prototype.checkMaxDepth=function(){return!0},qs.prototype.check=function(){return 0},new qs);var js=(Hs.prototype.has=function(t){return null!==this.data.get(t)},Hs.prototype.first=function(){return this.data.minKey()},Hs.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(Hs.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),Hs.prototype.indexOf=function(t){return this.data.indexOf(t)},Hs.prototype.forEach=function(n){this.data.inorderTraversal(function(t,e){return n(t),!1})},Hs.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(0<=this.comparator(r.key,t[1]))return;e(r.key)}},Hs.prototype.forEachWhile=function(t,e){for(var n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return},Hs.prototype.firstAfterOrEqual=function(t){t=this.data.getIteratorFrom(t);return t.hasNext()?t.getNext().key:null},Hs.prototype.getIterator=function(){return new Bs(this.data.getIterator())},Hs.prototype.getIteratorFrom=function(t){return new Bs(this.data.getIteratorFrom(t))},Hs.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},Hs.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},Hs.prototype.isEmpty=function(){return this.data.isEmpty()},Hs.prototype.unionWith=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach(function(t){e=e.add(t)}),e},Hs.prototype.isEqual=function(t){if(!(t instanceof Hs))return!1;if(this.size!==t.size)return!1;for(var e=this.data.getIterator(),n=t.data.getIterator();e.hasNext();){var r=e.getNext().key,i=n.getNext().key;if(0!==this.comparator(r,i))return!1}return!0},Hs.prototype.toArray=function(){var e=[];return this.forEach(function(t){e.push(t)}),e},Hs.prototype.toString=function(){var e=[];return this.forEach(function(t){return e.push(t)}),"SortedSet("+e.toString()+")"},Hs.prototype.copy=function(t){var e=new Hs(this.comparator);return e.data=t,e},Hs),Bs=(Ks.prototype.getNext=function(){return this.iter.getNext().key},Ks.prototype.hasNext=function(){return this.iter.hasNext()},Ks),Gs=new Ps(Si.comparator);function Ks(t){this.iter=t}function Hs(t){this.comparator=t,this.data=new Ps(this.comparator)}var Ws=new Ps(Si.comparator);var Qs=new Ps(Si.comparator);var zs=new js(Si.comparator);function Ys(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=zs,r=0,i=t;r<i.length;r++)var o=i[r],n=n.add(o);return n}var Xs=new js(Xr);var Js=(aa.createSynthesizedRemoteEventForCurrentChange=function(t,e){var n=new Map;return n.set(t,$s.createSynthesizedTargetChangeForCurrentChange(t,e)),new aa(Zr.min(),n,Xs,Gs,Ys())},aa),$s=(sa.createSynthesizedTargetChangeForCurrentChange=function(t,e){return new sa(li.EMPTY_BYTE_STRING,e,Ys(),Ys(),Ys())},sa),Zs=function(t,e,n,r){this.v=t,this.removedTargetIds=e,this.key=n,this.P=r},ta=function(t,e){this.targetId=t,this.V=e},ea=function(t,e,n,r){void 0===n&&(n=li.EMPTY_BYTE_STRING),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},na=(Object.defineProperty(oa.prototype,"current",{get:function(){return this.N},enumerable:!1,configurable:!0}),Object.defineProperty(oa.prototype,"resumeToken",{get:function(){return this.C},enumerable:!1,configurable:!0}),Object.defineProperty(oa.prototype,"k",{get:function(){return 0!==this.S},enumerable:!1,configurable:!0}),Object.defineProperty(oa.prototype,"$",{get:function(){return this.F},enumerable:!1,configurable:!0}),oa.prototype.O=function(t){0<t.approximateByteSize()&&(this.F=!0,this.C=t)},oa.prototype.M=function(){var n=Ys(),r=Ys(),i=Ys();return this.D.forEach(function(t,e){switch(e){case 0:n=n.add(t);break;case 2:r=r.add(t);break;case 1:i=i.add(t);break;default:Wr()}}),new $s(this.C,this.N,n,r,i)},oa.prototype.L=function(){this.F=!1,this.D=ca()},oa.prototype.B=function(t,e){this.F=!0,this.D=this.D.insert(t,e)},oa.prototype.q=function(t){this.F=!0,this.D=this.D.remove(t)},oa.prototype.U=function(){this.S+=1},oa.prototype.K=function(){--this.S},oa.prototype.j=function(){this.F=!0,this.N=!0},oa),ra=(ia.prototype.X=function(t){for(var e=0,n=t.v;e<n.length;e++){var r=n[e];t.P&&t.P.isFoundDocument()?this.Z(r,t.P):this.tt(r,t.key,t.P)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)r=o[i],this.tt(r,t.key,t.P)},ia.prototype.et=function(n){var r=this;this.forEachTarget(n,function(t){var e=r.nt(t);switch(n.state){case 0:r.st(t)&&e.O(n.resumeToken);break;case 1:e.K(),e.k||e.L(),e.O(n.resumeToken);break;case 2:e.K(),e.k||r.removeTarget(t);break;case 3:r.st(t)&&(e.j(),e.O(n.resumeToken));break;case 4:r.st(t)&&(r.it(t),e.O(n.resumeToken));break;default:Wr()}})},ia.prototype.forEachTarget=function(t,n){var r=this;0<t.targetIds.length?t.targetIds.forEach(n):this.G.forEach(function(t,e){r.st(e)&&n(e)})},ia.prototype.rt=function(t){var e=t.targetId,n=t.V.count,t=this.ot(e);t&&(zi(t=t.target)?0===n?(t=new Si(t.path),this.tt(e,t,Bi.newNoDocument(t,Zr.min()))):Qr(1===n):this.ct(e)!==n&&(this.it(e),this.Y=this.Y.add(e)))},ia.prototype.ut=function(r){var i=this,o=new Map;this.G.forEach(function(t,e){var n=i.ot(e);n&&(t.current&&zi(n.target)&&(n=new Si(n.target.path),null!==i.H.get(n)||i.at(e,n)||i.tt(e,n,Bi.newNoDocument(n,r))),t.$&&(o.set(e,t.M()),t.L()))});var s=Ys();this.J.forEach(function(t,e){var n=!0;e.forEachWhile(function(t){t=i.ot(t);return!t||2===t.purpose||(n=!1)}),n&&(s=s.add(t))});var t=new Js(r,o,this.Y,this.H,s);return this.H=Gs,this.J=ua(),this.Y=new js(Xr),t},ia.prototype.Z=function(t,e){var n;this.st(t)&&(n=this.at(t,e.key)?2:0,this.nt(t).B(e.key,n),this.H=this.H.insert(e.key,e),this.J=this.J.insert(e.key,this.ht(e.key).add(t)))},ia.prototype.tt=function(t,e,n){var r;this.st(t)&&(r=this.nt(t),this.at(t,e)?r.B(e,1):r.q(e),this.J=this.J.insert(e,this.ht(e).delete(t)),n&&(this.H=this.H.insert(e,n)))},ia.prototype.removeTarget=function(t){this.G.delete(t)},ia.prototype.ct=function(t){var e=this.nt(t).M();return this.W.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},ia.prototype.U=function(t){this.nt(t).U()},ia.prototype.nt=function(t){var e=this.G.get(t);return e||(e=new na,this.G.set(t,e)),e},ia.prototype.ht=function(t){var e=this.J.get(t);return e||(e=new js(Xr),this.J=this.J.insert(t,e)),e},ia.prototype.st=function(t){var e=null!==this.ot(t);return e||Br("WatchChangeAggregator","Detected inactive target",t),e},ia.prototype.ot=function(t){var e=this.G.get(t);return e&&e.k?null:this.W.lt(t)},ia.prototype.it=function(e){var n=this;this.G.set(e,new na),this.W.getRemoteKeysForTarget(e).forEach(function(t){n.tt(e,t,null)})},ia.prototype.at=function(t,e){return this.W.getRemoteKeysForTarget(t).has(e)},ia);function ia(t){this.W=t,this.G=new Map,this.H=Gs,this.J=ua(),this.Y=new js(Xr)}function oa(){this.S=0,this.D=ca(),this.C=li.EMPTY_BYTE_STRING,this.N=!1,this.F=!0}function sa(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}function aa(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}function ua(){return new Ps(Si.comparator)}function ca(){return new Ps(Si.comparator)}var ha={asc:"ASCENDING",desc:"DESCENDING"},la={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},fa=function(t,e){this.databaseId=t,this.I=e};function pa(t,e){return t.I?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function da(t,e){return t.I?e.toBase64():e.toUint8Array()}function ya(t){return Qr(!!t),Zr.fromTimestamp((t=mi(t),new $r(t.seconds,t.nanos)))}function ga(t,e){return new ai(["projects",t.projectId,"databases",t.database]).child("documents").child(e).canonicalString()}function va(t){t=ai.fromString(t);return Qr(La(t)),t}function ma(t,e){return ga(t.databaseId,e.path)}function wa(t,e){e=va(e);if(e.get(1)!==t.databaseId.projectId)throw new Vr(xr.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+t.databaseId.projectId);if(e.get(3)!==t.databaseId.database)throw new Vr(xr.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+t.databaseId.database);return new Si(Ea(e))}function ba(t,e){return ga(t.databaseId,e)}function _a(t){return new ai(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Ea(t){return Qr(4<t.length&&"documents"===t.get(4)),t.popFirst(5)}function Ta(t,e,n){return{name:ma(t,e),fields:n.value.mapValue.fields}}function Ia(t,e){var n,r,i;if(e instanceof vs)n={update:Ta(t,e.key,e.value)};else if(e instanceof Ds)n={delete:ma(t,e.key)};else if(e instanceof ms)n={update:Ta(t,e.key,e.data),updateMask:(r=e.fieldMask,i=[],r.fields.forEach(function(t){return i.push(t.canonicalString())}),{fieldPaths:i})};else{if(!(e instanceof Cs))return Wr();n={verify:ma(t,e.key)}}return 0<e.fieldTransforms.length&&(n.updateTransforms=e.fieldTransforms.map(function(t){var e=t.transform;if(e instanceof Qo)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(e instanceof zo)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:e.elements}};if(e instanceof Zo)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:e.elements}};if(e instanceof rs)return{fieldPath:t.field.canonicalString(),increment:e.A};throw Wr()})),e.precondition.isNone||(n.currentDocument=void 0!==(e=e.precondition).updateTime?{updateTime:pa(t,e.updateTime.toTimestamp())}:void 0!==e.exists?{exists:e.exists}:Wr()),n}function Sa(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=ba(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=ba(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);r=function(t){if(0!==t.length){t=t.map(function(t){if("=="===t.op){if(xi(t.value))return{unaryFilter:{field:Ca(t.field),op:"IS_NAN"}};if(Fi(t.value))return{unaryFilter:{field:Ca(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(xi(t.value))return{unaryFilter:{field:Ca(t.field),op:"IS_NOT_NAN"}};if(Fi(t.value))return{unaryFilter:{field:Ca(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ca(t.field),op:(e=t.op,la[e]),value:t.value}};var e});return 1===t.length?t[0]:{compositeFilter:{op:"AND",filters:t}}}}(e.filters);r&&(n.structuredQuery.where=r);r=function(t){if(0!==t.length)return t.map(function(t){return{field:Ca((t=t).field),direction:(t=t.dir,ha[t])}})}(e.orderBy);r&&(n.structuredQuery.orderBy=r);r=e.limit,r=t.I||Ti(r)?r:{value:r};return null!==r&&(n.structuredQuery.limit=r),e.startAt&&(n.structuredQuery.startAt=Na(e.startAt)),e.endAt&&(n.structuredQuery.endAt=Na(e.endAt)),n}function Aa(t){var e=4===(o=va(t.parent)).length?ai.emptyPath():Ea(o),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;0<r&&(Qr(1===r),(s=n.from[0]).allDescendants?i=s.collectionId:e=e.child(s.collectionId));var o=[];n.where&&(o=function e(t){return t?void 0!==t.unaryFilter?[Oa(t)]:void 0!==t.fieldFilter?[ka(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return e(t)}).reduce(function(t,e){return t.concat(e)}):Wr():[]}(n.where));t=[];n.orderBy&&(t=n.orderBy.map(function(t){return new To(Ra((e=t).field),function(){switch(e.direction){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}());var e}));r=null;n.limit&&(r=Ti(a="object"==typeof(a=n.limit)?a.value:a)?null:a);var s=null;n.startAt&&(s=Da(n.startAt));var a=null;return n.endAt&&(a=Da(n.endAt)),new Ao(e,i,t,o,r,"F",s,a)}function Na(t){return{before:t.before,values:t.position}}function Da(t){var e=!!t.before,t=t.values||[];return new vo(t,e)}function Ca(t){return{fieldPath:t.canonicalString()}}function Ra(t){return ci.fromServerFormat(t.fieldPath)}function ka(t){return Xi.create(Ra(t.fieldFilter.field),function(){switch(t.fieldFilter.op){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return Wr()}}(),t.fieldFilter.value)}function Oa(t){switch(t.unaryFilter.op){case"IS_NAN":var e=Ra(t.unaryFilter.field);return Xi.create(e,"==",{doubleValue:NaN});case"IS_NULL":e=Ra(t.unaryFilter.field);return Xi.create(e,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var n=Ra(t.unaryFilter.field);return Xi.create(n,"!=",{doubleValue:NaN});case"IS_NOT_NULL":n=Ra(t.unaryFilter.field);return Xi.create(n,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return Wr()}}function La(t){return 4<=t.length&&"projects"===t.get(0)&&"databases"===t.get(2)}var D=(xa.prototype.addOnCommittedListener=function(t){this.onCommittedListeners.push(t)},xa.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach(function(t){return t()})},xa),Pa=function(){var n=this;this.promise=new Promise(function(t,e){n.resolve=t,n.reject=e})},Ma=(Fa.prototype.catch=function(t){return this.next(void 0,t)},Fa.prototype.next=function(r,i){var o=this;return this.callbackAttached&&Wr(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(r,this.result):new Fa(function(e,n){o.nextCallback=function(t){o.wrapSuccess(r,t).next(e,n)},o.catchCallback=function(t){o.wrapFailure(i,t).next(e,n)}})},Fa.prototype.toPromise=function(){var n=this;return new Promise(function(t,e){n.next(t,e)})},Fa.prototype.wrapUserFunction=function(t){try{var e=t();return e instanceof Fa?e:Fa.resolve(e)}catch(t){return Fa.reject(t)}},Fa.prototype.wrapSuccess=function(t,e){return t?this.wrapUserFunction(function(){return t(e)}):Fa.resolve(e)},Fa.prototype.wrapFailure=function(t,e){return t?this.wrapUserFunction(function(){return t(e)}):Fa.reject(e)},Fa.resolve=function(n){return new Fa(function(t,e){t(n)})},Fa.reject=function(n){return new Fa(function(t,e){e(n)})},Fa.waitFor=function(t){return new Fa(function(e,n){var r=0,i=0,o=!1;t.forEach(function(t){++r,t.next(function(){++i,o&&i===r&&e()},function(t){return n(t)})}),o=!0,i===r&&e()})},Fa.or=function(t){for(var n=Fa.resolve(!1),e=0,r=t;e<r.length;e++)!function(e){n=n.next(function(t){return t?Fa.resolve(t):e()})}(r[e]);return n},Fa.forEach=function(t,n){var r=this,i=[];return t.forEach(function(t,e){i.push(n.call(r,t,e))}),this.waitFor(i)},Fa);function Fa(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)},function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)})}function xa(){this.onCommittedListeners=[]}function Va(t){return"IndexedDbTransactionError"===t.name}function Ua(t){this.Lt=t}var qa=(Ha.prototype.applyToRemoteDocument=function(t,e){for(var n,r,i,o,s,a,u=e.mutationResults,c=0;c<this.mutations.length;c++){var h=this.mutations[c];h.key.isEqual(t.key)&&(n=h,r=t,i=u[c],h=a=s=o=void 0,n instanceof vs?(s=r,a=i,h=(o=n).value.clone(),o=Es(o.fieldTransforms,s,a.transformResults),h.setAll(o),s.convertToFoundDocument(a.version,h).setHasCommittedMutations()):n instanceof ms?(o=r,s=i,ls((a=n).precondition,o)?(h=Es(a.fieldTransforms,o,s.transformResults),(n=o.data).setAll(_s(a)),n.setAll(h),o.convertToFoundDocument(s.version,n).setHasCommittedMutations()):o.convertToUnknownDocument(s.version)):r.convertToNoDocument(i.version).setHasCommittedMutations())}},Ha.prototype.applyToLocalView=function(t){for(var e=0,n=this.baseMutations;e<n.length;e++)(r=n[e]).key.isEqual(t.key)&&fs(r,t,this.localWriteTime);for(var r,i=0,o=this.mutations;i<o.length;i++)(r=o[i]).key.isEqual(t.key)&&fs(r,t,this.localWriteTime)},Ha.prototype.applyToLocalDocumentSet=function(n){var r=this;this.mutations.forEach(function(t){var e=n.get(t.key),t=e;r.applyToLocalView(t),e.isValidDocument()||t.convertToNoDocument(Zr.min())})},Ha.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},Ys())},Ha.prototype.isEqual=function(t){return this.batchId===t.batchId&&Jr(this.mutations,t.mutations,ps)&&Jr(this.baseMutations,t.baseMutations,ps)},Ha),ja=(Ka.from=function(t,e,n){Qr(t.mutations.length===n.length);for(var r=Qs,i=t.mutations,o=0;o<i.length;o++)r=r.insert(i[o].key,n[o].version);return new Ka(t,e,n,r)},Ka),Ba=(Ga.prototype.withSequenceNumber=function(t){return new Ga(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},Ga.prototype.withResumeToken=function(t,e){return new Ga(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)},Ga.prototype.withLastLimboFreeSnapshotVersion=function(t){return new Ga(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken)},Ga);function Ga(t,e,n,r,i,o,s){void 0===i&&(i=Zr.min()),void 0===o&&(o=Zr.min()),void 0===s&&(s=li.EMPTY_BYTE_STRING),this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}function Ka(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}function Ha(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}function Wa(t){var e=Aa({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?Mo(e,e.limit,"L"):e}var Qa=($a.prototype.addToCollectionParentIndex=function(t,e){return this.Bt.add(e),Ma.resolve()},$a.prototype.getCollectionParents=function(t,e){return Ma.resolve(this.Bt.getEntries(e))},$a),za=(Ja.prototype.add=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new js(ai.comparator),t=!r.has(n);return this.index[e]=r.add(n),t},Ja.prototype.has=function(t){var e=t.lastSegment(),t=t.popLast(),e=this.index[e];return e&&e.has(t)},Ja.prototype.getEntries=function(t){return(this.index[t]||new js(ai.comparator)).toArray()},Ja),Ya=(Xa.prototype.next=function(){return this.Ht+=2,this.Ht},Xa.Jt=function(){return new Xa(0)},Xa.Yt=function(){return new Xa(-1)},Xa);function Xa(t){this.Ht=t}function Ja(){this.index={}}function $a(){this.Bt=new za}function Za(e){return y(this,void 0,void 0,function(){return g(this,function(t){if(e.code!==xr.FAILED_PRECONDITION||"The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab."!==e.message)throw e;return Br("LocalStore","Unexpectedly lost primary lease"),[2]})})}function tu(t,e){this.progress=t,this.wn=e}var eu=(lu.prototype.get=function(t){var e=this.mapKeyFn(t),e=this.inner[e];if(void 0!==e)for(var n=0,r=e;n<r.length;n++){var i=r[n],o=i[0],i=i[1];if(this.equalsFn(o,t))return i}},lu.prototype.has=function(t){return void 0!==this.get(t)},lu.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},lu.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},lu.prototype.forEach=function(s){ri(this.inner,function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n],o=i[0],i=i[1];s(o,i)}})},lu.prototype.isEmpty=function(){return ii(this.inner)},lu),T=(hu.prototype.getReadTime=function(t){t=this.changes.get(t);return t?t.readTime:Zr.min()},hu.prototype.addEntry=function(t,e){this.assertNotApplied(),this.changes.set(t.key,{document:t,readTime:e})},hu.prototype.removeEntry=function(t,e){void 0===e&&(e=null),this.assertNotApplied(),this.changes.set(t,{document:Bi.newInvalidDocument(t),readTime:e})},hu.prototype.getEntry=function(t,e){this.assertNotApplied();var n=this.changes.get(e);return void 0!==n?Ma.resolve(n.document):this.getFromCache(t,e)},hu.prototype.getEntries=function(t,e){return this.getAllFromCache(t,e)},hu.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},hu.prototype.assertNotApplied=function(){},hu),nu=(cu.prototype.mn=function(e,n){var r=this;return this._n.getAllMutationBatchesAffectingDocumentKey(e,n).next(function(t){return r.yn(e,n,t)})},cu.prototype.yn=function(t,e,r){return this.Ue.getEntry(t,e).next(function(t){for(var e=0,n=r;e<n.length;e++)n[e].applyToLocalView(t);return t})},cu.prototype.gn=function(t,i){t.forEach(function(t,e){for(var n=0,r=i;n<r.length;n++)r[n].applyToLocalView(e)})},cu.prototype.pn=function(e,t){var n=this;return this.Ue.getEntries(e,t).next(function(t){return n.En(e,t).next(function(){return t})})},cu.prototype.En=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKeys(t,e).next(function(t){return n.gn(e,t)})},cu.prototype.getDocumentsMatchingQuery=function(t,e,n){return r=e,Si.isDocumentKey(r.path)&&null===r.collectionGroup&&0===r.filters.length?this.Tn(t,e.path):Oo(e)?this.In(t,e,n):this.An(t,e,n);var r},cu.prototype.Tn=function(t,e){return this.mn(t,new Si(e)).next(function(t){var e=Ws;return e=t.isFoundDocument()?e.insert(t.key,t):e})},cu.prototype.In=function(n,r,i){var o=this,s=r.collectionGroup,a=Ws;return this.Ut.getCollectionParents(n,s).next(function(t){return Ma.forEach(t,function(t){var e,e=(e=r,t=t.child(s),new Ao(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt));return o.An(n,e,i).next(function(t){t.forEach(function(t,e){a=a.insert(t,e)})})}).next(function(){return a})})},cu.prototype.An=function(e,n,t){var c,h,r=this;return this.Ue.getDocumentsMatchingQuery(e,n,t).next(function(t){return c=t,r._n.getAllMutationBatchesAffectingQuery(e,n)}).next(function(t){return h=t,r.Rn(e,h,c).next(function(t){c=t;for(var e=0,n=h;e<n.length;e++)for(var r=n[e],i=0,o=r.mutations;i<o.length;i++){var s=o[i],a=s.key,u=c.get(a);null==u&&(u=Bi.newInvalidDocument(a),c=c.insert(a,u)),fs(s,u,r.localWriteTime),u.isFoundDocument()||(c=c.remove(a))}})}).next(function(){return c.forEach(function(t,e){Uo(n,e)||(c=c.remove(t))}),c})},cu.prototype.Rn=function(t,e,n){for(var r=Ys(),i=0,o=e;i<o.length;i++)for(var s=0,a=o[i].mutations;s<a.length;s++){var u=a[s];u instanceof ms&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.Ue.getEntries(t,r).next(function(t){return t.forEach(function(t,e){e.isFoundDocument()&&(c=c.insert(t,e))}),c})},cu),ru=(uu.Pn=function(t,e){for(var n=Ys(),r=Ys(),i=0,o=e.docChanges;i<o.length;i++){var s=o[i];switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}}return new uu(t,e.fromCache,n,r)},uu),iu=(au.prototype.Vn=function(t){this.Sn=t},au.prototype.getDocumentsMatchingQuery=function(e,r,i,o){var s=this;return 0===r.filters.length&&null===r.limit&&null==r.startAt&&null==r.endAt&&(0===r.explicitOrderBy.length||1===r.explicitOrderBy.length&&r.explicitOrderBy[0].field.isKeyField())||i.isEqual(Zr.min())?this.Dn(e,r):this.Sn.pn(e,o).next(function(t){var n=s.Cn(r,t);return(Do(r)||Co(r))&&s.Nn(r.limitType,n,o,i)?s.Dn(e,r):(jr()<=d.DEBUG&&Br("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Vo(r)),s.Sn.getDocumentsMatchingQuery(e,r,i).next(function(e){return n.forEach(function(t){e=e.insert(t.key,t)}),e}))})},au.prototype.Cn=function(n,t){var r=new js(qo(n));return t.forEach(function(t,e){Uo(n,e)&&(r=r.add(e))}),r},au.prototype.Nn=function(t,e,n,r){if(n.size!==e.size)return!0;e="F"===t?e.last():e.first();return!!e&&(e.hasPendingWrites||0<e.version.compareTo(r))},au.prototype.Dn=function(t,e){return jr()<=d.DEBUG&&Br("QueryEngine","Using full collection scan to execute query:",Vo(e)),this.Sn.getDocumentsMatchingQuery(t,e,Zr.min())},au),ou=(su.prototype.collectGarbage=function(e){var n=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(t){return e.collect(t,n.Fn)})},su);function su(t,e,n,r){this.persistence=t,this.xn=e,this.R=r,this.Fn=new Ps(Xr),this.kn=new eu(Wi,Qi),this.$n=Zr.min(),this._n=t.getMutationQueue(n),this.On=t.getRemoteDocumentCache(),this.qe=t.getTargetCache(),this.Mn=new nu(this.On,this._n,this.persistence.getIndexManager()),this.Qe=t.getBundleCache(),this.xn.Vn(this.Mn)}function au(){}function uu(t,e,n,r){this.targetId=t,this.fromCache=e,this.bn=n,this.vn=r}function cu(t,e,n){this.Ue=t,this._n=e,this.Ut=n}function hu(){this.changes=new eu(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),this.changesApplied=!1}function lu(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={}}function fu(i,o){return y(this,void 0,void 0,function(){var e,n,m,r;return g(this,function(t){switch(t.label){case 0:return n=(e=i)._n,m=e.Mn,[4,e.persistence.runTransaction("Handle user change","readonly",function(g){var v;return e._n.getAllMutationBatches(g).next(function(t){return v=t,n=e.persistence.getMutationQueue(o),m=new nu(e.On,n,e.persistence.getIndexManager()),n.getAllMutationBatches(g)}).next(function(t){for(var e=[],n=[],r=Ys(),i=0,o=v;i<o.length;i++){var s=o[i];e.push(s.batchId);for(var a=0,u=s.mutations;a<u.length;a++)var c=u[a],r=r.add(c.key)}for(var h=0,l=t;h<l.length;h++){var f=l[h];n.push(f.batchId);for(var p=0,d=f.mutations;p<d.length;p++){var y=d[p];r=r.add(y.key)}}return m.pn(g,r).next(function(t){return{Ln:t,removedBatchIds:e,addedBatchIds:n}})})})];case 1:return r=t.sent(),[2,(e._n=n,e.Mn=m,e.xn.Vn(e.Mn),r)]}})})}function pu(t,h){var l=t;return l.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(t){var e,r,i,o,s,n,a,u=h.batch.keys(),c=l.On.newChangeBuffer({trackRemovals:!0});return e=l,r=t,o=c,s=(i=h).batch,n=s.keys(),a=Ma.resolve(),n.forEach(function(n){a=a.next(function(){return o.getEntry(r,n)}).next(function(t){var e=i.docVersions.get(n);Qr(null!==e),t.version.compareTo(e)<0&&(s.applyToRemoteDocument(t,i),t.isValidDocument()&&o.addEntry(t,i.commitVersion))})}),a.next(function(){return e._n.removeMutationBatch(r,s)}).next(function(){return c.apply(t)}).next(function(){return l._n.performConsistencyCheck(t)}).next(function(){return l.Mn.pn(t,u)})})}function du(t){var e=t;return e.persistence.runTransaction("Get last remote snapshot version","readonly",function(t){return e.qe.getLastRemoteSnapshotVersion(t)})}function yu(t,r){var u=t,c=r.snapshotVersion,h=u.Fn;return u.persistence.runTransaction("Apply remote event","readwrite-primary",function(s){var t=u.On.newChangeBuffer({trackRemovals:!0});h=u.Fn;var a=[];r.targetChanges.forEach(function(t,e){var n,r,i,o=h.get(e);o&&(a.push(u.qe.removeMatchingKeys(s,t.removedDocuments,e).next(function(){return u.qe.addMatchingKeys(s,t.addedDocuments,e)})),0<(i=t.resumeToken).approximateByteSize()&&(n=o.withResumeToken(i,c).withSequenceNumber(s.currentSequenceNumber),h=h.insert(e,n),r=o,i=t,Qr(0<(o=n).resumeToken.approximateByteSize()),(0===r.resumeToken.approximateByteSize()||3e8<=o.snapshotVersion.toMicroseconds()-r.snapshotVersion.toMicroseconds()||0<i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size)&&a.push(u.qe.updateTargetData(s,n))))});var e,n=Gs;return r.documentUpdates.forEach(function(t,e){r.resolvedLimboDocuments.has(t)&&a.push(u.persistence.referenceDelegate.updateLimboDocument(s,t))}),a.push(gu(s,t,r.documentUpdates,c,void 0).next(function(t){n=t})),c.isEqual(Zr.min())||(e=u.qe.getLastRemoteSnapshotVersion(s).next(function(t){return u.qe.setTargetsMetadata(s,s.currentSequenceNumber,c)}),a.push(e)),Ma.waitFor(a).next(function(){return t.apply(s)}).next(function(){return u.Mn.En(s,n)}).next(function(){return n})}).then(function(t){return u.Fn=h,t})}function gu(t,s,e,a,u){var n=Ys();return e.forEach(function(t){return n=n.add(t)}),s.getEntries(t,n).next(function(i){var o=Gs;return e.forEach(function(t,e){var n=i.get(t),r=(null==u?void 0:u.get(t))||a;e.isNoDocument()&&e.version.isEqual(Zr.min())?(s.removeEntry(t,r),o=o.insert(t,e)):!n.isValidDocument()||0<e.version.compareTo(n.version)||0===e.version.compareTo(n.version)&&n.hasPendingWrites?(s.addEntry(e,r),o=o.insert(t,e)):Br("LocalStore","Ignoring outdated watch update for ",t,". Current version:",n.version," Watch version:",e.version)}),o})}function vu(t,r){var i=t;return i.persistence.runTransaction("Allocate target","readwrite",function(e){var n;return i.qe.getTargetData(e,r).next(function(t){return t?(n=t,Ma.resolve(n)):i.qe.allocateTargetId(e).next(function(t){return n=new Ba(r,t,0,e.currentSequenceNumber),i.qe.addTargetData(e,n).next(function(){return n})})})}).then(function(t){var e=i.Fn.get(t.targetId);return(null===e||0<t.snapshotVersion.compareTo(e.snapshotVersion))&&(i.Fn=i.Fn.insert(t.targetId,t),i.kn.set(r,t.targetId)),t})}function mu(i,o,s){return y(this,void 0,void 0,function(){var e,n,r;return g(this,function(t){switch(t.label){case 0:n=(e=i).Fn.get(o),r=s?"readwrite":"readwrite-primary",t.label=1;case 1:return t.trys.push([1,4,,5]),s?[3,3]:[4,e.persistence.runTransaction("Release target",r,function(t){return e.persistence.referenceDelegate.removeTarget(t,n)})];case 2:t.sent(),t.label=3;case 3:return[3,5];case 4:if(!Va(r=t.sent()))throw r;return Br("LocalStore","Failed to update sequence numbers for target "+o+": "+r),[3,5];case 5:return e.Fn=e.Fn.remove(o),e.kn.delete(n.target),[2]}})})}function wu(t,o,s){var a=t,u=Zr.min(),c=Ys();return a.persistence.runTransaction("Execute query","readonly",function(e){return t=a,n=e,r=Po(o),(void 0!==(t=(i=t).kn.get(r))?Ma.resolve(i.Fn.get(t)):i.qe.getTargetData(n,r)).next(function(t){if(t)return u=t.lastLimboFreeSnapshotVersion,a.qe.getMatchingKeysForTargetId(e,t.targetId).next(function(t){c=t})}).next(function(){return a.xn.getDocumentsMatchingQuery(e,o,s?u:Zr.min(),s?c:Ys())}).next(function(t){return{documents:t,Bn:c}});var t,n,r,i})}var bu,_u,Eu=(Gu.prototype.getBundleMetadata=function(t,e){return Ma.resolve(this.Kn.get(e))},Gu.prototype.saveBundleMetadata=function(t,e){return this.Kn.set(e.id,{id:e.id,version:e.version,createTime:ya(e.createTime)}),Ma.resolve()},Gu.prototype.getNamedQuery=function(t,e){return Ma.resolve(this.jn.get(e))},Gu.prototype.saveNamedQuery=function(t,e){return this.jn.set(e.name,{name:(e=e).name,query:Wa(e.bundledQuery),readTime:ya(e.readTime)}),Ma.resolve()},Gu),Tu=(Bu.prototype.isEmpty=function(){return this.Wn.isEmpty()},Bu.prototype.addReference=function(t,e){e=new Iu(t,e);this.Wn=this.Wn.add(e),this.zn=this.zn.add(e)},Bu.prototype.Jn=function(t,e){var n=this;t.forEach(function(t){return n.addReference(t,e)})},Bu.prototype.removeReference=function(t,e){this.Yn(new Iu(t,e))},Bu.prototype.Xn=function(t,e){var n=this;t.forEach(function(t){return n.removeReference(t,e)})},Bu.prototype.Zn=function(t){var e=this,n=new Si(new ai([])),r=new Iu(n,t),t=new Iu(n,t+1),i=[];return this.zn.forEachInRange([r,t],function(t){e.Yn(t),i.push(t.key)}),i},Bu.prototype.ts=function(){var e=this;this.Wn.forEach(function(t){return e.Yn(t)})},Bu.prototype.Yn=function(t){this.Wn=this.Wn.delete(t),this.zn=this.zn.delete(t)},Bu.prototype.es=function(t){var e=new Si(new ai([])),n=new Iu(e,t),t=new Iu(e,t+1),r=Ys();return this.zn.forEachInRange([n,t],function(t){r=r.add(t.key)}),r},Bu.prototype.containsKey=function(t){var e=new Iu(t,0),e=this.Wn.firstAfterOrEqual(e);return null!==e&&t.isEqual(e.key)},Bu),Iu=(ju.Gn=function(t,e){return Si.comparator(t.key,e.key)||Xr(t.ns,e.ns)},ju.Hn=function(t,e){return Xr(t.ns,e.ns)||Si.comparator(t.key,e.key)},ju),Su=(qu.prototype.checkEmpty=function(t){return Ma.resolve(0===this._n.length)},qu.prototype.addMutationBatch=function(t,e,n,r){var i=this.ss;this.ss++,0<this._n.length&&this._n[this._n.length-1];n=new qa(i,e,n,r);this._n.push(n);for(var o=0,s=r;o<s.length;o++){var a=s[o];this.rs=this.rs.add(new Iu(a.key,i)),this.Ut.addToCollectionParentIndex(t,a.key.path.popLast())}return Ma.resolve(n)},qu.prototype.lookupMutationBatch=function(t,e){return Ma.resolve(this.os(e))},qu.prototype.getNextMutationBatchAfterBatchId=function(t,e){e=this.cs(e+1),e=e<0?0:e;return Ma.resolve(this._n.length>e?this._n[e]:null)},qu.prototype.getHighestUnacknowledgedBatchId=function(){return Ma.resolve(0===this._n.length?-1:this.ss-1)},qu.prototype.getAllMutationBatches=function(t){return Ma.resolve(this._n.slice())},qu.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=new Iu(e,0),e=new Iu(e,Number.POSITIVE_INFINITY),i=[];return this.rs.forEachInRange([r,e],function(t){t=n.os(t.ns);i.push(t)}),Ma.resolve(i)},qu.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new js(Xr);return e.forEach(function(t){var e=new Iu(t,0),t=new Iu(t,Number.POSITIVE_INFINITY);n.rs.forEachInRange([e,t],function(t){r=r.add(t.ns)})}),Ma.resolve(this.us(r))},qu.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=e.path,r=n.length+1,e=n;Si.isDocumentKey(e)||(e=e.child(""));var e=new Iu(new Si(e),0),i=new js(Xr);return this.rs.forEachWhile(function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(i=i.add(t.ns)),!0)},e),Ma.resolve(this.us(i))},qu.prototype.us=function(t){var e=this,n=[];return t.forEach(function(t){t=e.os(t);null!==t&&n.push(t)}),n},qu.prototype.removeMutationBatch=function(n,r){var i=this;Qr(0===this.hs(r.batchId,"removed")),this._n.shift();var o=this.rs;return Ma.forEach(r.mutations,function(t){var e=new Iu(t.key,r.batchId);return o=o.delete(e),i.referenceDelegate.markPotentiallyOrphaned(n,t.key)}).next(function(){i.rs=o})},qu.prototype.Gt=function(t){},qu.prototype.containsKey=function(t,e){var n=new Iu(e,0),n=this.rs.firstAfterOrEqual(n);return Ma.resolve(e.isEqual(n&&n.key))},qu.prototype.performConsistencyCheck=function(t){return this._n.length,Ma.resolve()},qu.prototype.hs=function(t,e){return this.cs(t)},qu.prototype.cs=function(t){return 0===this._n.length?0:t-this._n[0].batchId},qu.prototype.os=function(t){t=this.cs(t);return t<0||t>=this._n.length?null:this._n[t]},qu),Au=(Uu.prototype.addEntry=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,i=this.ls(e);return this.docs=this.docs.insert(r,{document:e.clone(),size:i,readTime:n}),this.size+=i-o,this.Ut.addToCollectionParentIndex(t,r.path.popLast())},Uu.prototype.removeEntry=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},Uu.prototype.getEntry=function(t,e){var n=this.docs.get(e);return Ma.resolve(n?n.document.clone():Bi.newInvalidDocument(e))},Uu.prototype.getEntries=function(t,e){var n=this,r=Gs;return e.forEach(function(t){var e=n.docs.get(t);r=r.insert(t,e?e.document.clone():Bi.newInvalidDocument(t))}),Ma.resolve(r)},Uu.prototype.getDocumentsMatchingQuery=function(t,e,n){for(var r=Gs,i=new Si(e.path.child("")),o=this.docs.getIteratorFrom(i);o.hasNext();){var s=o.getNext(),a=s.key,u=s.value,s=u.document,u=u.readTime;if(!e.path.isPrefixOf(a.path))break;u.compareTo(n)<=0||Uo(e,s)&&(r=r.insert(s.key,s.clone()))}return Ma.resolve(r)},Uu.prototype.fs=function(t,e){return Ma.forEach(this.docs,function(t){return e(t)})},Uu.prototype.newChangeBuffer=function(t){return new Nu(this)},Uu.prototype.getSize=function(t){return Ma.resolve(this.size)},Uu),Nu=(n(Vu,_u=T),Vu.prototype.applyChanges=function(n){var r=this,i=[];return this.changes.forEach(function(t,e){e.document.isValidDocument()?i.push(r.Ie.addEntry(n,e.document,r.getReadTime(t))):r.Ie.removeEntry(t)}),Ma.waitFor(i)},Vu.prototype.getFromCache=function(t,e){return this.Ie.getEntry(t,e)},Vu.prototype.getAllFromCache=function(t,e){return this.Ie.getEntries(t,e)},Vu),Du=(xu.prototype.forEachTarget=function(t,n){return this.ds.forEach(function(t,e){return n(e)}),Ma.resolve()},xu.prototype.getLastRemoteSnapshotVersion=function(t){return Ma.resolve(this.lastRemoteSnapshotVersion)},xu.prototype.getHighestSequenceNumber=function(t){return Ma.resolve(this.ws)},xu.prototype.allocateTargetId=function(t){return this.highestTargetId=this.ys.next(),Ma.resolve(this.highestTargetId)},xu.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.ws&&(this.ws=e),Ma.resolve()},xu.prototype.te=function(t){this.ds.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.ys=new Ya(e),this.highestTargetId=e),t.sequenceNumber>this.ws&&(this.ws=t.sequenceNumber)},xu.prototype.addTargetData=function(t,e){return this.te(e),this.targetCount+=1,Ma.resolve()},xu.prototype.updateTargetData=function(t,e){return this.te(e),Ma.resolve()},xu.prototype.removeTargetData=function(t,e){return this.ds.delete(e.target),this._s.Zn(e.targetId),--this.targetCount,Ma.resolve()},xu.prototype.removeTargets=function(n,r,i){var o=this,s=0,a=[];return this.ds.forEach(function(t,e){e.sequenceNumber<=r&&null===i.get(e.targetId)&&(o.ds.delete(t),a.push(o.removeMatchingKeysForTargetId(n,e.targetId)),s++)}),Ma.waitFor(a).next(function(){return s})},xu.prototype.getTargetCount=function(t){return Ma.resolve(this.targetCount)},xu.prototype.getTargetData=function(t,e){e=this.ds.get(e)||null;return Ma.resolve(e)},xu.prototype.addMatchingKeys=function(t,e,n){return this._s.Jn(e,n),Ma.resolve()},xu.prototype.removeMatchingKeys=function(e,t,n){this._s.Xn(t,n);var r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(function(t){i.push(r.markPotentiallyOrphaned(e,t))}),Ma.waitFor(i)},xu.prototype.removeMatchingKeysForTargetId=function(t,e){return this._s.Zn(e),Ma.resolve()},xu.prototype.getMatchingKeysForTargetId=function(t,e){e=this._s.es(e);return Ma.resolve(e)},xu.prototype.containsKey=function(t,e){return Ma.resolve(this._s.containsKey(e))},xu),Cu=(Fu.prototype.start=function(){return Promise.resolve()},Fu.prototype.shutdown=function(){return this.xe=!1,Promise.resolve()},Object.defineProperty(Fu.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),Fu.prototype.setDatabaseDeletedListener=function(){},Fu.prototype.setNetworkEnabled=function(){},Fu.prototype.getIndexManager=function(){return this.Ut},Fu.prototype.getMutationQueue=function(t){var e=this.gs[t.toKey()];return e||(e=new Su(this.Ut,this.referenceDelegate),this.gs[t.toKey()]=e),e},Fu.prototype.getTargetCache=function(){return this.qe},Fu.prototype.getRemoteDocumentCache=function(){return this.Ue},Fu.prototype.getBundleCache=function(){return this.Qe},Fu.prototype.runTransaction=function(t,e,n){var r=this;Br("MemoryPersistence","Starting transaction:",t);var i=new Ru(this.Ne.next());return this.referenceDelegate.Es(),n(i).next(function(t){return r.referenceDelegate.Ts(i).next(function(){return t})}).toPromise().then(function(t){return i.raiseOnCommittedEvent(),t})},Fu.prototype.Is=function(e,n){return Ma.or(Object.values(this.gs).map(function(t){return function(){return t.containsKey(e,n)}}))},Fu),Ru=(n(Mu,bu=D),Mu),ku=(Pu.bs=function(t){return new Pu(t)},Object.defineProperty(Pu.prototype,"vs",{get:function(){if(this.Rs)return this.Rs;throw Wr()},enumerable:!1,configurable:!0}),Pu.prototype.addReference=function(t,e,n){return this.As.addReference(n,e),this.vs.delete(n.toString()),Ma.resolve()},Pu.prototype.removeReference=function(t,e,n){return this.As.removeReference(n,e),this.vs.add(n.toString()),Ma.resolve()},Pu.prototype.markPotentiallyOrphaned=function(t,e){return this.vs.add(e.toString()),Ma.resolve()},Pu.prototype.removeTarget=function(t,e){var n=this;this.As.Zn(e.targetId).forEach(function(t){return n.vs.add(t.toString())});var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(function(t){t.forEach(function(t){return n.vs.add(t.toString())})}).next(function(){return r.removeTargetData(t,e)})},Pu.prototype.Es=function(){this.Rs=new Set},Pu.prototype.Ts=function(n){var r=this,i=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Ma.forEach(this.vs,function(t){var e=Si.fromPath(t);return r.Ps(n,e).next(function(t){t||i.removeEntry(e)})}).next(function(){return r.Rs=null,i.apply(n)})},Pu.prototype.updateLimboDocument=function(t,e){var n=this;return this.Ps(t,e).next(function(t){t?n.vs.delete(e.toString()):n.vs.add(e.toString())})},Pu.prototype.ps=function(t){return 0},Pu.prototype.Ps=function(t,e){var n=this;return Ma.or([function(){return Ma.resolve(n.As.containsKey(e))},function(){return n.persistence.getTargetCache().containsKey(t,e)},function(){return n.persistence.Is(t,e)}])},Pu),Ou=(Lu.prototype.isAuthenticated=function(){return null!=this.uid},Lu.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},Lu.prototype.isEqual=function(t){return t.uid===this.uid},Lu);function Lu(t){this.uid=t}function Pu(t){this.persistence=t,this.As=new Tu,this.Rs=null}function Mu(t){var e=this;return(e=bu.call(this)||this).currentSequenceNumber=t,e}function Fu(t,e){var n=this;this.gs={},this.Ne=new Pr(0),this.xe=!1,this.xe=!0,this.referenceDelegate=t(this),this.qe=new Du(this),this.Ut=new Qa,this.Ue=(t=this.Ut,new Au(t,function(t){return n.referenceDelegate.ps(t)})),this.R=new Ua(e),this.Qe=new Eu(this.R)}function xu(t){this.persistence=t,this.ds=new eu(Wi,Qi),this.lastRemoteSnapshotVersion=Zr.min(),this.highestTargetId=0,this.ws=0,this._s=new Tu,this.targetCount=0,this.ys=Ya.Jt()}function Vu(t){var e=this;return(e=_u.call(this)||this).Ie=t,e}function Uu(t,e){this.Ut=t,this.ls=e,this.docs=new Ps(Si.comparator),this.size=0}function qu(t,e){this.Ut=t,this.referenceDelegate=e,this._n=[],this.ss=1,this.rs=new js(Iu.Gn)}function ju(t,e){this.key=t,this.ns=e}function Bu(){this.Wn=new js(Iu.Gn),this.zn=new js(Iu.Hn)}function Gu(t){this.R=t,this.Kn=new Map,this.jn=new Map}Ou.UNAUTHENTICATED=new Ou(null),Ou.GOOGLE_CREDENTIALS=new Ou("google-credentials-uid"),Ou.FIRST_PARTY=new Ou("first-party-uid");var Ku,Hu=(ic.prototype.Ds=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},ic.prototype.Cs=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},ic.prototype.Ss=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},ic),Wu=(rc.prototype.addPendingMutation=function(t){},rc.prototype.updateMutationState=function(t,e,n){},rc.prototype.addLocalQueryTarget=function(t){return this.li.Ds(t),this.fi[t]||"not-current"},rc.prototype.updateQueryState=function(t,e,n){this.fi[t]=e},rc.prototype.removeLocalQueryTarget=function(t){this.li.Cs(t)},rc.prototype.isLocalQueryTarget=function(t){return this.li.activeTargetIds.has(t)},rc.prototype.clearQueryState=function(t){delete this.fi[t]},rc.prototype.getAllActiveQueryTargets=function(){return this.li.activeTargetIds},rc.prototype.isActiveQueryTarget=function(t){return this.li.activeTargetIds.has(t)},rc.prototype.start=function(){return this.li=new Hu,Promise.resolve()},rc.prototype.handleUserChange=function(t,e,n){},rc.prototype.setOnlineState=function(t){},rc.prototype.shutdown=function(){},rc.prototype.writeSequenceNumber=function(t){},rc.prototype.notifyBundleLoaded=function(){},rc),Qu=(nc.prototype.di=function(t){},nc.prototype.shutdown=function(){},nc),zu=(ec.prototype.di=function(t){this.gi.push(t)},ec.prototype.shutdown=function(){window.removeEventListener("online",this.wi),window.removeEventListener("offline",this.mi)},ec.prototype.pi=function(){window.addEventListener("online",this.wi),window.addEventListener("offline",this.mi)},ec.prototype._i=function(){Br("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(0)},ec.prototype.yi=function(){Br("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(1)},ec.yt=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},ec),Yu={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},Xu=(tc.prototype.Ii=function(t){this.Ai=t},tc.prototype.Ri=function(t){this.bi=t},tc.prototype.onMessage=function(t){this.vi=t},tc.prototype.close=function(){this.Ti()},tc.prototype.send=function(t){this.Ei(t)},tc.prototype.Pi=function(){this.Ai()},tc.prototype.Vi=function(t){this.bi(t)},tc.prototype.Si=function(t){this.vi(t)},tc),Ju=(Zu.prototype.Ni=function(e,t,n,r){var i=this.xi(e,t);Br("RestConnection","Sending: ",i,n);t={};return this.Fi(t,r),this.ki(e,i,t,n).then(function(t){return Br("RestConnection","Received: ",t),t},function(t){throw Kr("RestConnection",e+" failed with error: ",t,"url: ",i,"request:",n),t})},Zu.prototype.$i=function(t,e,n,r){return this.Ni(t,e,n,r)},Zu.prototype.Fi=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.6.8",t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n])},Zu.prototype.xi=function(t,e){return this.Di+"/v1/"+e+":"+Yu[t]},n($u,Ku=Zu),$u.prototype.ki=function(u,e,n,r){return new Promise(function(o,s){var a=new Lr;a.listenOnce(Nr.COMPLETE,function(){try{switch(a.getLastErrorCode()){case Ar.NO_ERROR:var t=a.getResponseJson();Br("Connection","XHR received:",JSON.stringify(t)),o(t);break;case Ar.TIMEOUT:Br("Connection",'RPC "'+u+'" timed out'),s(new Vr(xr.DEADLINE_EXCEEDED,"Request time out"));break;case Ar.HTTP_ERROR:var e,n,r=a.getStatus();Br("Connection",'RPC "'+u+'" failed with status:',r,"response text:",a.getResponseText()),0<r?(e=a.getResponseJson().error)&&e.status&&e.message?(i=e.status.toLowerCase().replace(/_/g,"-"),n=0<=Object.values(xr).indexOf(i)?i:xr.UNKNOWN,s(new Vr(n,e.message))):s(new Vr(xr.UNKNOWN,"Server responded with status "+a.getStatus())):s(new Vr(xr.UNAVAILABLE,"Connection failed."));break;default:Wr()}}finally{Br("Connection",'RPC "'+u+'" completed.')}var i});var t=JSON.stringify(r);a.send(e,"POST",t,n,15)})},$u.prototype.Oi=function(t,e){var n,r=[this.Di,"/","google.firestore.v1.Firestore","/",t,"/channel"],i=new br,o=Sr(),t={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(t.xmlHttpFactory=new kr({})),this.Fi(t.initMessageHeaders,e),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(h())||"object"==typeof navigator&&"ReactNative"===navigator.product||0<=h().indexOf("Electron/")||(0<=(n=h()).indexOf("MSIE ")||0<=n.indexOf("Trident/"))||0<=h().indexOf("MSAppHost/")||"object"==typeof(n="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==n.id||(t.httpHeadersOverwriteParam="$httpHeaders");r=r.join("");Br("Connection","Creating WebChannel: "+r,t);var s=i.createWebChannel(r,t),a=!1,u=!1,c=new Xu({Ei:function(t){u?Br("Connection","Not sending because WebChannel is closed:",t):(a||(Br("Connection","Opening WebChannel transport."),s.open(),a=!0),Br("Connection","WebChannel sending:",t),s.send(t))},Ti:function(){return s.close()}}),t=function(t,e,n){t.listen(e,function(t){try{n(t)}catch(t){setTimeout(function(){throw t},0)}})};return t(s,Or.EventType.OPEN,function(){u||Br("Connection","WebChannel transport opened.")}),t(s,Or.EventType.CLOSE,function(){u||(u=!0,Br("Connection","WebChannel transport closed"),c.Vi())}),t(s,Or.EventType.ERROR,function(t){u||(u=!0,Kr("Connection","WebChannel transport errored:",t),c.Vi(new Vr(xr.UNAVAILABLE,"The operation could not be completed")))}),t(s,Or.EventType.MESSAGE,function(t){var e,n,r,i;u||(Qr(!!(e=t.data[0])),(n=e.error||(null===(i=e[0])||void 0===i?void 0:i.error))?(Br("Connection","WebChannel received error:",n),r=n.status,t=function(){var t=Ss[r];if(void 0!==t)return Ls(t)}(),i=n.message,void 0===t&&(t=xr.INTERNAL,i="Unknown error status: "+r+" with message "+n.message),u=!0,c.Vi(new Vr(t,i)),s.close()):(Br("Connection","WebChannel received:",e),c.Si(e)))}),t(o,Dr.STAT_EVENT,function(t){t.stat===Cr?Br("Connection","Detected buffering proxy"):t.stat===Rr&&Br("Connection","Detected no buffering proxy")}),setTimeout(function(){c.Pi()},0),c},$u);function $u(t){var e=this;return(e=Ku.call(this,t)||this).forceLongPolling=t.forceLongPolling,e.autoDetectLongPolling=t.autoDetectLongPolling,e.useFetchStreams=t.useFetchStreams,e}function Zu(t){this.databaseInfo=t,this.databaseId=t.databaseId;var e=t.ssl?"https":"http";this.Di=e+"://"+t.host,this.Ci="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}function tc(t){this.Ei=t.Ei,this.Ti=t.Ti}function ec(){var t=this;this.wi=function(){return t._i()},this.mi=function(){return t.yi()},this.gi=[],this.pi()}function nc(){}function rc(){this.li=new Hu,this.fi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}function ic(){this.activeTargetIds=Xs}function oc(){return"undefined"!=typeof document?document:null}function sc(t){return new fa(t,!0)}function ac(t,e,n,r,i){var o=this;this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.kr=[],this.$r=new Map,this.Or=new Set,this.Mr=[],this.Lr=i,this.Lr.di(function(t){n.enqueueAndForget(function(){return y(o,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return Rc(this)?(Br("RemoteStore","Restarting streams for network reachability change."),[4,function(n){return y(this,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return(e=n).Or.add(4),[4,Tc(e)];case 1:return t.sent(),e.Br.set("Unknown"),e.Or.delete(4),[4,Ec(e)];case 2:return t.sent(),[2]}})})}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.Br=new yc(n,r)}var uc,cc,hc,lc=(_c.prototype.reset=function(){this.qi=0},_c.prototype.Ki=function(){this.qi=this.Bi},_c.prototype.ji=function(t){var e=this;this.cancel();var n=Math.floor(this.qi+this.Wi()),r=Math.max(0,Date.now()-this.Qi),i=Math.max(0,n-r);0<i&&Br("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.qi+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Ui=this.Se.enqueueAfterDelay(this.timerId,i,function(){return e.Qi=Date.now(),t()}),this.qi*=this.Li,this.qi<this.Mi&&(this.qi=this.Mi),this.qi>this.Bi&&(this.qi=this.Bi)},_c.prototype.Gi=function(){null!==this.Ui&&(this.Ui.skipDelay(),this.Ui=null)},_c.prototype.cancel=function(){null!==this.Ui&&(this.Ui.cancel(),this.Ui=null)},_c.prototype.Wi=function(){return(Math.random()-.5)*this.qi},_c),T=(bc.prototype.tr=function(){return 1===this.state||2===this.state||4===this.state},bc.prototype.er=function(){return 2===this.state},bc.prototype.start=function(){3!==this.state?this.auth():this.nr()},bc.prototype.stop=function(){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return this.tr()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},bc.prototype.sr=function(){this.state=0,this.Zi.reset()},bc.prototype.ir=function(){var t=this;this.er()&&null===this.Xi&&(this.Xi=this.Se.enqueueAfterDelay(this.zi,6e4,function(){return t.rr()}))},bc.prototype.cr=function(t){this.ur(),this.stream.send(t)},bc.prototype.rr=function(){return y(this,void 0,void 0,function(){return g(this,function(t){return this.er()?[2,this.close(0)]:[2]})})},bc.prototype.ur=function(){this.Xi&&(this.Xi.cancel(),this.Xi=null)},bc.prototype.close=function(e,n){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return this.ur(),this.Zi.cancel(),this.Yi++,3!==e?this.Zi.reset():n&&n.code===xr.RESOURCE_EXHAUSTED?(Gr(n.toString()),Gr("Using maximum backoff delay to prevent overloading the backend."),this.Zi.Ki()):n&&n.code===xr.UNAUTHENTICATED&&this.Ji.invalidateToken(),null!==this.stream&&(this.ar(),this.stream.close(),this.stream=null),this.state=e,[4,this.listener.Ri(n)];case 1:return t.sent(),[2]}})})},bc.prototype.ar=function(){},bc.prototype.auth=function(){var n=this;this.state=1;var t=this.hr(this.Yi),e=this.Yi;this.Ji.getToken().then(function(t){n.Yi===e&&n.lr(t)},function(e){t(function(){var t=new Vr(xr.UNKNOWN,"Fetching auth token failed: "+e.message);return n.dr(t)})})},bc.prototype.lr=function(t){var e=this,n=this.hr(this.Yi);this.stream=this.wr(t),this.stream.Ii(function(){n(function(){return e.state=2,e.listener.Ii()})}),this.stream.Ri(function(t){n(function(){return e.dr(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},bc.prototype.nr=function(){var t=this;this.state=4,this.Zi.ji(function(){return y(t,void 0,void 0,function(){return g(this,function(t){return this.state=0,this.start(),[2]})})})},bc.prototype.dr=function(t){return Br("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},bc.prototype.hr=function(e){var n=this;return function(t){n.Se.enqueueAndForget(function(){return n.Yi===e?t():(Br("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},bc),fc=(n(wc,hc=T),wc.prototype.wr=function(t){return this.Hi.Oi("Listen",t)},wc.prototype.onMessage=function(t){this.Zi.reset();var e=function(t,e){if("targetChange"in e){e.targetChange;var n="NO_CHANGE"===(o=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===o?1:"REMOVE"===o?2:"CURRENT"===o?3:"RESET"===o?4:Wr(),r=e.targetChange.targetIds||[],i=(s=e.targetChange.resumeToken,t.I?(Qr(void 0===s||"string"==typeof s),li.fromBase64String(s||"")):(Qr(void 0===s||s instanceof Uint8Array),li.fromUint8Array(s||new Uint8Array))),o=(a=e.targetChange.cause)&&(u=void 0===(c=a).code?xr.UNKNOWN:Ls(c.code),new Vr(u,c.message||"")),s=new ea(n,r,i,o||null)}else if("documentChange"in e){e.documentChange,(n=e.documentChange).document,n.document.name,n.document.updateTime;var r=wa(t,n.document.name),i=ya(n.document.updateTime),a=new qi({mapValue:{fields:n.document.fields}}),u=(o=Bi.newFoundDocument(r,i,a),n.targetIds||[]),c=n.removedTargetIds||[];s=new Zs(u,c,o.key,o)}else if("documentDelete"in e)e.documentDelete,(n=e.documentDelete).document,r=wa(t,n.document),i=n.readTime?ya(n.readTime):Zr.min(),a=Bi.newNoDocument(r,i),o=n.removedTargetIds||[],s=new Zs([],o,a.key,a);else if("documentRemove"in e)e.documentRemove,(n=e.documentRemove).document,r=wa(t,n.document),i=n.removedTargetIds||[],s=new Zs([],i,r,null);else{if(!("filter"in e))return Wr();e.filter;e=e.filter;e.targetId,n=e.count||0,r=new Is(n),i=e.targetId,s=new ta(i,r)}return s}(this.R,t),t=function(t){if(!("targetChange"in t))return Zr.min();t=t.targetChange;return(!t.targetIds||!t.targetIds.length)&&t.readTime?ya(t.readTime):Zr.min()}(t);return this.listener._r(e,t)},wc.prototype.mr=function(t){var e,n,r,i={};i.database=_a(this.R),i.addTarget=(e=this.R,(r=zi(r=(n=t).target)?{documents:{documents:[ba(e,r.path)]}}:{query:Sa(e,r)}).targetId=n.targetId,0<n.resumeToken.approximateByteSize()?r.resumeToken=da(e,n.resumeToken):0<n.snapshotVersion.compareTo(Zr.min())&&(r.readTime=pa(e,n.snapshotVersion.toTimestamp())),r);var o,t=(this.R,o=t,null==(t=function(){switch(o.purpose){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Wr()}}())?null:{"goog-listen-tags":t});t&&(i.labels=t),this.cr(i)},wc.prototype.yr=function(t){var e={};e.database=_a(this.R),e.removeTarget=t,this.cr(e)},wc),pc=(n(mc,cc=T),Object.defineProperty(mc.prototype,"pr",{get:function(){return this.gr},enumerable:!1,configurable:!0}),mc.prototype.start=function(){this.gr=!1,this.lastStreamToken=void 0,cc.prototype.start.call(this)},mc.prototype.ar=function(){this.gr&&this.Er([])},mc.prototype.wr=function(t){return this.Hi.Oi("Write",t)},mc.prototype.onMessage=function(t){if(Qr(!!t.streamToken),this.lastStreamToken=t.streamToken,this.gr){this.Zi.reset();var e=(n=t.writeResults,r=t.commitTime,n&&0<n.length?(Qr(void 0!==r),n.map(function(t){return n=r,(t=(e=t).updateTime?ya(e.updateTime):ya(n)).isEqual(Zr.min())&&(t=ya(n)),new us(t,e.transformResults||[]);var e,n})):[]),n=ya(t.commitTime);return this.listener.Tr(n,e)}var n,r;return Qr(!t.writeResults||0===t.writeResults.length),this.gr=!0,this.listener.Ir()},mc.prototype.Ar=function(){var t={};t.database=_a(this.R),this.cr(t)},mc.prototype.Er=function(t){var e=this,t={streamToken:this.lastStreamToken,writes:t.map(function(t){return Ia(e.R,t)})};this.cr(t)},mc),dc=(n(vc,uc=function(){}),vc.prototype.br=function(){if(this.Rr)throw new Vr(xr.FAILED_PRECONDITION,"The client has already been terminated.")},vc.prototype.Ni=function(e,n,r){var i=this;return this.br(),this.credentials.getToken().then(function(t){return i.Hi.Ni(e,n,r,t)}).catch(function(t){throw"FirebaseError"===t.name?(t.code===xr.UNAUTHENTICATED&&i.credentials.invalidateToken(),t):new Vr(xr.UNKNOWN,t.toString())})},vc.prototype.$i=function(e,n,r){var i=this;return this.br(),this.credentials.getToken().then(function(t){return i.Hi.$i(e,n,r,t)}).catch(function(t){throw"FirebaseError"===t.name?(t.code===xr.UNAUTHENTICATED&&i.credentials.invalidateToken(),t):new Vr(xr.UNKNOWN,t.toString())})},vc.prototype.terminate=function(){this.Rr=!0},vc),yc=(gc.prototype.Sr=function(){var t=this;0===this.vr&&(this.Dr("Unknown"),this.Pr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,function(){return t.Pr=null,t.Cr("Backend didn't respond within 10 seconds."),t.Dr("Offline"),Promise.resolve()}))},gc.prototype.Nr=function(t){"Online"===this.state?this.Dr("Unknown"):(this.vr++,1<=this.vr&&(this.Fr(),this.Cr("Connection failed 1 times. Most recent error: "+t.toString()),this.Dr("Offline")))},gc.prototype.set=function(t){this.Fr(),this.vr=0,"Online"===t&&(this.Vr=!1),this.Dr(t)},gc.prototype.Dr=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},gc.prototype.Cr=function(t){t="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Vr?(Gr(t),this.Vr=!1):Br("OnlineStateTracker",t)},gc.prototype.Fr=function(){null!==this.Pr&&(this.Pr.cancel(),this.Pr=null)},gc);function gc(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.vr=0,this.Pr=null,this.Vr=!0}function vc(t,e,n){var r=this;return(r=uc.call(this)||this).credentials=t,r.Hi=e,r.R=n,r.Rr=!1,r}function mc(t,e,n,r,i){var o=this;return(o=cc.call(this,t,"write_stream_connection_backoff","write_stream_idle",e,n,i)||this).R=r,o.gr=!1,o}function wc(t,e,n,r,i){var o=this;return(o=hc.call(this,t,"listen_stream_connection_backoff","listen_stream_idle",e,n,i)||this).R=r,o}function bc(t,e,n,r,i,o){this.Se=t,this.zi=n,this.Hi=r,this.Ji=i,this.listener=o,this.state=0,this.Yi=0,this.Xi=null,this.stream=null,this.Zi=new lc(t,e)}function _c(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Se=t,this.timerId=e,this.Mi=n,this.Li=r,this.Bi=i,this.qi=0,this.Ui=null,this.Qi=Date.now(),this.reset()}function Ec(r){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:if(!Rc(r))return[3,4];e=0,n=r.Mr,t.label=1;case 1:return e<n.length?[4,(0,n[e])(!0)]:[3,4];case 2:t.sent(),t.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function Tc(r){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:e=0,n=r.Mr,t.label=1;case 1:return e<n.length?[4,(0,n[e])(!1)]:[3,4];case 2:t.sent(),t.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function Ic(t,e){t.$r.has(e.targetId)||(t.$r.set(e.targetId,e),Cc(t)?Dc(t):Vc(t).er()&&Ac(t,e))}function Sc(t,e){var n=t,t=Vc(n);n.$r.delete(e),t.er()&&Nc(n,e),0===n.$r.size&&(t.er()?t.ir():Rc(n)&&n.Br.set("Unknown"))}function Ac(t,e){t.qr.U(e.targetId),Vc(t).mr(e)}function Nc(t,e){t.qr.U(e),Vc(t).yr(e)}function Dc(e){e.qr=new ra({getRemoteKeysForTarget:function(t){return e.remoteSyncer.getRemoteKeysForTarget(t)},lt:function(t){return e.$r.get(t)||null}}),Vc(e).start(),e.Br.Sr()}function Cc(t){return Rc(t)&&!Vc(t).tr()&&0<t.$r.size}function Rc(t){return 0===t.Or.size}function kc(t){t.qr=void 0}function Oc(s,a,u){return y(this,void 0,void 0,function(){var n,o;return g(this,function(t){switch(t.label){case 0:if(s.Br.set("Online"),!(a instanceof ea&&2===a.state&&a.cause))return[3,6];t.label=1;case 1:return t.trys.push([1,3,,5]),[4,function(o,s){return y(this,void 0,void 0,function(){var e,n,r,i;return g(this,function(t){switch(t.label){case 0:e=s.cause,n=0,r=s.targetIds,t.label=1;case 1:return n<r.length?(i=r[n],o.$r.has(i)?[4,o.remoteSyncer.rejectListen(i,e)]:[3,3]):[3,5];case 2:t.sent(),o.$r.delete(i),o.qr.removeTarget(i),t.label=3;case 3:t.label=4;case 4:return n++,[3,1];case 5:return[2]}})})}(s,a)];case 2:return t.sent(),[3,5];case 3:return n=t.sent(),Br("RemoteStore","Failed to remove targets %s: %s ",a.targetIds.join(","),n),[4,Lc(s,n)];case 4:return t.sent(),[3,5];case 5:return[3,13];case 6:if(a instanceof Zs?s.qr.X(a):a instanceof ta?s.qr.rt(a):s.qr.et(a),u.isEqual(Zr.min()))return[3,13];t.label=7;case 7:return t.trys.push([7,11,,13]),[4,du(s.localStore)];case 8:return o=t.sent(),0<=u.compareTo(o)?[4,(i=u,(e=(r=s).qr.ut(i)).targetChanges.forEach(function(t,e){var n;0<t.resumeToken.approximateByteSize()&&((n=r.$r.get(e))&&r.$r.set(e,n.withResumeToken(t.resumeToken,i)))}),e.targetMismatches.forEach(function(t){var e=r.$r.get(t);e&&(r.$r.set(t,e.withResumeToken(li.EMPTY_BYTE_STRING,e.snapshotVersion)),Nc(r,t),e=new Ba(e.target,t,1,e.sequenceNumber),Ac(r,e))}),r.remoteSyncer.applyRemoteEvent(e))]:[3,10];case 9:t.sent(),t.label=10;case 10:return[3,13];case 11:return Br("RemoteStore","Failed to raise snapshot:",o=t.sent()),[4,Lc(s,o)];case 12:return t.sent(),[3,13];case 13:return[2]}var r,i,e})})}function Lc(n,r,i){return y(this,void 0,void 0,function(){var e=this;return g(this,function(t){switch(t.label){case 0:if(!Va(r))throw r;return n.Or.add(1),[4,Tc(n)];case 1:return t.sent(),n.Br.set("Offline"),i=i||function(){return du(n.localStore)},n.asyncQueue.enqueueRetryable(function(){return y(e,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return Br("RemoteStore","Retrying IndexedDB access"),[4,i()];case 1:return t.sent(),n.Or.delete(1),[4,Ec(n)];case 2:return t.sent(),[2]}})})}),[2]}})})}function Pc(e,n){return n().catch(function(t){return Lc(e,t,n)})}function Mc(u){return y(this,void 0,void 0,function(){var i,o,s,a;return g(this,function(t){switch(t.label){case 0:o=Uc(i=u),s=0<i.kr.length?i.kr[i.kr.length-1].batchId:-1,t.label=1;case 1:if(!(Rc(i)&&i.kr.length<10))return[3,7];t.label=2;case 2:return t.trys.push([2,4,,6]),[4,(e=i.localStore,n=s,(r=e).persistence.runTransaction("Get next mutation batch","readonly",function(t){return void 0===n&&(n=-1),r._n.getNextMutationBatchAfterBatchId(t,n)}))];case 3:return null===(a=t.sent())?(0===i.kr.length&&o.ir(),[3,7]):(s=a.batchId,function(t,e){t.kr.push(e);t=Uc(t);t.er()&&t.pr&&t.Er(e.mutations)}(i,a),[3,6]);case 4:return a=t.sent(),[4,Lc(i,a)];case 5:return t.sent(),[3,6];case 6:return[3,1];case 7:return Fc(i)&&xc(i),[2]}var e,n,r})})}function Fc(t){return Rc(t)&&!Uc(t).tr()&&0<t.kr.length}function xc(t){Uc(t).start()}function Vc(n){var t,e,r,i=this;return n.Ur||(n.Ur=(t=n.datastore,e=n.asyncQueue,r={Ii:function(n){return y(this,void 0,void 0,function(){return g(this,function(t){return n.$r.forEach(function(t,e){Ac(n,t)}),[2]})})}.bind(null,n),Ri:function(e,n){return y(this,void 0,void 0,function(){return g(this,function(t){return kc(e),Cc(e)?(e.Br.Nr(n),Dc(e)):e.Br.set("Unknown"),[2]})})}.bind(null,n),_r:Oc.bind(null,n)},t.br(),new fc(e,t.Hi,t.credentials,t.R,r)),n.Mr.push(function(e){return y(i,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return e?(n.Ur.sr(),Cc(n)?Dc(n):n.Br.set("Unknown"),[3,3]):[3,1];case 1:return[4,n.Ur.stop()];case 2:t.sent(),kc(n),t.label=3;case 3:return[2]}})})})),n.Ur}function Uc(n){var t,e,r,i=this;return n.Qr||(n.Qr=(t=n.datastore,e=n.asyncQueue,r={Ii:function(e){return y(this,void 0,void 0,function(){return g(this,function(t){return Uc(e).Ar(),[2]})})}.bind(null,n),Ri:function(e,n){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return n&&Uc(e).pr?[4,function(r,i){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return Os(n=i.code)&&n!==xr.ABORTED?(e=r.kr.shift(),Uc(r).sr(),[4,Pc(r,function(){return r.remoteSyncer.rejectFailedWrite(e.batchId,i)})]):[3,3];case 1:return t.sent(),[4,Mc(r)];case 2:t.sent(),t.label=3;case 3:return[2]}})})}(e,n)]:[3,2];case 1:t.sent(),t.label=2;case 2:return Fc(e)&&xc(e),[2]}})})}.bind(null,n),Ir:function(o){return y(this,void 0,void 0,function(){var e,n,r,i;return g(this,function(t){for(e=Uc(o),n=0,r=o.kr;n<r.length;n++)i=r[n],e.Er(i.mutations);return[2]})})}.bind(null,n),Tr:function(r,i,o){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return e=r.kr.shift(),n=ja.from(e,i,o),[4,Pc(r,function(){return r.remoteSyncer.applySuccessfulWrite(n)})];case 1:return t.sent(),[4,Mc(r)];case 2:return t.sent(),[2]}})})}.bind(null,n)},t.br(),new pc(e,t.Hi,t.credentials,t.R,r)),n.Mr.push(function(e){return y(i,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return e?(n.Qr.sr(),[4,Mc(n)]):[3,2];case 1:return t.sent(),[3,4];case 2:return[4,n.Qr.stop()];case 3:t.sent(),0<n.kr.length&&(Br("RemoteStore","Stopping write stream with "+n.kr.length+" pending writes"),n.kr=[]),t.label=4;case 4:return[2]}})})})),n.Qr}var qc=(jc.createAndSchedule=function(t,e,n,r,i){i=new jc(t,e,Date.now()+n,r,i);return i.start(n),i},jc.prototype.start=function(t){var e=this;this.timerHandle=setTimeout(function(){return e.handleDelayElapsed()},t)},jc.prototype.skipDelay=function(){return this.handleDelayElapsed()},jc.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Vr(xr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},jc.prototype.handleDelayElapsed=function(){var e=this;this.asyncQueue.enqueueAndForget(function(){return null!==e.timerHandle?(e.clearTimeout(),e.op().then(function(t){return e.deferred.resolve(t)})):Promise.resolve()})},jc.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},jc);function jc(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Pa,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(function(t){})}function Bc(t,e){if(Gr("AsyncQueue",e+": "+t),Va(t))return new Vr(xr.UNAVAILABLE,e+": "+t);throw t}function Gc(){this.queries=new eu(xo,Fo),this.onlineState="Unknown",this.Gr=new Set}var Kc=(Xc.emptySet=function(t){return new Xc(t.comparator)},Xc.prototype.has=function(t){return null!=this.keyedMap.get(t)},Xc.prototype.get=function(t){return this.keyedMap.get(t)},Xc.prototype.first=function(){return this.sortedSet.minKey()},Xc.prototype.last=function(){return this.sortedSet.maxKey()},Xc.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},Xc.prototype.indexOf=function(t){t=this.keyedMap.get(t);return t?this.sortedSet.indexOf(t):-1},Object.defineProperty(Xc.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!1,configurable:!0}),Xc.prototype.forEach=function(n){this.sortedSet.inorderTraversal(function(t,e){return n(t),!1})},Xc.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},Xc.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},Xc.prototype.isEqual=function(t){if(!(t instanceof Xc))return!1;if(this.size!==t.size)return!1;for(var e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();e.hasNext();){var r=e.getNext().key,i=n.getNext().key;if(!r.isEqual(i))return!1}return!0},Xc.prototype.toString=function(){var e=[];return this.forEach(function(t){e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"},Xc.prototype.copy=function(t,e){var n=new Xc;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n},Xc),Hc=(Yc.prototype.track=function(t){var e=t.doc.key,n=this.Kr.get(e);!n||0!==t.type&&3===n.type?this.Kr=this.Kr.insert(e,t):3===t.type&&1!==n.type?this.Kr=this.Kr.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Kr=this.Kr.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Kr=this.Kr.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Kr=this.Kr.remove(e):1===t.type&&2===n.type?this.Kr=this.Kr.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Kr=this.Kr.insert(e,{type:2,doc:t.doc}):Wr()},Yc.prototype.jr=function(){var n=[];return this.Kr.inorderTraversal(function(t,e){n.push(e)}),n},Yc),Wc=(zc.fromInitialDocuments=function(t,e,n,r){var i=[];return e.forEach(function(t){i.push({type:0,doc:t})}),new zc(t,e,Kc.emptySet(e),i,n,r,!0,!1)},Object.defineProperty(zc.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!1,configurable:!0}),zc.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Fo(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},zc),Qc=function(){this.Wr=void 0,this.listeners=[]};function zc(t,e,n,r,i,o,s,a){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=s,this.excludesMetadataChanges=a}function Yc(){this.Kr=new Ps(Si.comparator)}function Xc(n){this.comparator=n?function(t,e){return n(t,e)||Si.comparator(t.key,e.key)}:function(t,e){return Si.comparator(t.key,e.key)},this.keyedMap=Ws,this.sortedSet=new Ps(this.comparator)}function Jc(s,a){return y(this,void 0,void 0,function(){var e,n,r,i,o;return g(this,function(t){switch(t.label){case 0:if(e=s,n=a.query,r=!1,(i=e.queries.get(n))||(r=!0,i=new Qc),!r)return[3,4];t.label=1;case 1:return t.trys.push([1,3,,4]),o=i,[4,e.onListen(n)];case 2:return o.Wr=t.sent(),[3,4];case 3:return o=t.sent(),o=Bc(o,"Initialization of query '"+Vo(a.query)+"' failed"),[2,void a.onError(o)];case 4:return e.queries.set(n,i),i.listeners.push(a),a.zr(e.onlineState),i.Wr&&a.Hr(i.Wr)&&Zc(e),[2]}})})}function $c(s,a){return y(this,void 0,void 0,function(){var e,n,r,i,o;return g(this,function(t){return e=s,n=a.query,r=!1,(i=e.queries.get(n))&&0<=(o=i.listeners.indexOf(a))&&(i.listeners.splice(o,1),r=0===i.listeners.length),r?[2,(e.queries.delete(n),e.onUnlisten(n))]:[2]})})}function Zc(t){t.Gr.forEach(function(t){t.next()})}var th=(ah.prototype.Hr=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new Wc(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var o=!1;return this.Yr?this.Zr(t)&&(this.Jr.next(t),o=!0):this.eo(t,this.onlineState)&&(this.no(t),o=!0),this.Xr=t,o},ah.prototype.onError=function(t){this.Jr.error(t)},ah.prototype.zr=function(t){this.onlineState=t;var e=!1;return this.Xr&&!this.Yr&&this.eo(this.Xr,t)&&(this.no(this.Xr),e=!0),e},ah.prototype.eo=function(t,e){return!t.fromCache||!(this.options.so&&"Offline"!==e||t.docs.isEmpty()&&"Offline"!==e)},ah.prototype.Zr=function(t){if(0<t.docChanges.length)return!0;var e=this.Xr&&this.Xr.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges},ah.prototype.no=function(t){t=Wc.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.Yr=!0,this.Jr.next(t)},ah),eh=(sh.prototype.io=function(){return"metadata"in this.payload},sh),nh=(oh.prototype.qn=function(t){return wa(this.R,t)},oh.prototype.Un=function(t){return t.metadata.exists?(e=this.R,n=t.document,r=wa(e,n.name),e=ya(n.updateTime),n=new qi({mapValue:{fields:n.fields}}),n=Bi.newFoundDocument(r,e,n)):Bi.newNoDocument(this.qn(t.metadata.name),this.Qn(t.metadata.readTime));var e,n,r},oh.prototype.Qn=ya,oh),rh=(ih.prototype.oo=function(t){this.progress.bytesLoaded+=t.byteLength;var e=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++e):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++e),e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null},ih.prototype.co=function(t){for(var e=new Map,n=new nh(this.R),r=0,i=t;r<i.length;r++){var o=i[r];if(o.metadata.queries)for(var s=n.qn(o.metadata.name),a=0,u=o.metadata.queries;a<u.length;a++){var c=u[a],h=(e.get(c)||Ys()).add(s);e.set(c,h)}}return e},ih.prototype.complete=function(){return y(this,void 0,void 0,function(){var e,n,r,i;return g(this,function(t){switch(t.label){case 0:return[4,function(l,f,p,d){return y(this,void 0,void 0,function(){var n,r,i,o,e,s,a,u,c,h;return g(this,function(t){switch(t.label){case 0:for(n=l,r=Ys(),i=Gs,o=Qs,e=0,s=p;e<s.length;e++)a=s[e],u=f.qn(a.metadata.name),a.document&&(r=r.add(u)),i=i.insert(u,f.Un(a)),o=o.insert(u,f.Qn(a.metadata.readTime));return c=n.On.newChangeBuffer({trackRemovals:!0}),[4,vu(n,Po(No(ai.fromString("__bundle__/docs/"+d))))];case 1:return h=t.sent(),[2,n.persistence.runTransaction("Apply bundle documents","readwrite",function(e){return gu(e,c,i,Zr.min(),o).next(function(t){return c.apply(e),t}).next(function(t){return n.qe.removeMatchingKeysForTargetId(e,h.targetId).next(function(){return n.qe.addMatchingKeys(e,r,h.targetId)}).next(function(){return n.Mn.En(e,t)}).next(function(){return t})})})]}})})}(this.localStore,new nh(this.R),this.documents,this.ro.id)];case 1:e=t.sent(),n=this.co(this.documents),r=0,i=this.queries,t.label=2;case 2:return r<i.length?(i=i[r],[4,function(e,i,o){return void 0===o&&(o=Ys()),y(this,void 0,void 0,function(){var n,r;return g(this,function(t){switch(t.label){case 0:return[4,vu(e,Po(Wa(i.bundledQuery)))];case 1:return n=t.sent(),[2,(r=e).persistence.runTransaction("Save named query","readwrite",function(t){var e=ya(i.readTime);if(0<=n.snapshotVersion.compareTo(e))return r.Qe.saveNamedQuery(t,i);e=n.withResumeToken(li.EMPTY_BYTE_STRING,e);return r.Fn=r.Fn.insert(e.targetId,e),r.qe.updateTargetData(t,e).next(function(){return r.qe.removeMatchingKeysForTargetId(t,n.targetId)}).next(function(){return r.qe.addMatchingKeys(t,o,n.targetId)}).next(function(){return r.Qe.saveNamedQuery(t,i)})})]}})})}(this.localStore,i,n.get(i.name))]):[3,5];case 3:t.sent(),t.label=4;case 4:return r++,[3,2];case 5:return[2,(this.progress.taskState="Success",new tu(Object.assign({},this.progress),e))]}})})},ih);function ih(t,e,n){this.ro=t,this.localStore=e,this.R=n,this.queries=[],this.documents=[],this.progress=uh(t)}function oh(t){this.R=t}function sh(t,e){this.payload=t,this.byteLength=e}function ah(t,e,n){this.query=t,this.Jr=e,this.Yr=!1,this.Xr=null,this.onlineState="Unknown",this.options=n||{}}function uh(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}var ch=function(t){this.key=t},hh=function(t){this.key=t},lh=(Object.defineProperty(gh.prototype,"wo",{get:function(){return this.uo},enumerable:!1,configurable:!0}),gh.prototype._o=function(t,e){var s=this,a=e?e.mo:new Hc,u=(e||this).fo,c=(e||this).mutatedKeys,h=u,l=!1,f=Do(this.query)&&u.size===this.query.limit?u.last():null,p=Co(this.query)&&u.size===this.query.limit?u.first():null;if(t.inorderTraversal(function(t,e){var n=u.get(t),r=Uo(s.query,e)?e:null,i=!!n&&s.mutatedKeys.has(n.key),o=!!r&&(r.hasLocalMutations||s.mutatedKeys.has(r.key)&&r.hasCommittedMutations),e=!1;n&&r?n.data.isEqual(r.data)?i!==o&&(a.track({type:3,doc:r}),e=!0):s.yo(n,r)||(a.track({type:2,doc:r}),e=!0,(f&&0<s.lo(r,f)||p&&s.lo(r,p)<0)&&(l=!0)):!n&&r?(a.track({type:0,doc:r}),e=!0):n&&!r&&(a.track({type:1,doc:n}),e=!0,(f||p)&&(l=!0)),e&&(c=r?(h=h.add(r),o?c.add(t):c.delete(t)):(h=h.delete(t),c.delete(t)))}),Do(this.query)||Co(this.query))for(;h.size>this.query.limit;){var n=Do(this.query)?h.last():h.first(),h=h.delete(n.key),c=c.delete(n.key);a.track({type:1,doc:n})}return{fo:h,mo:a,Nn:l,mutatedKeys:c}},gh.prototype.yo=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},gh.prototype.applyChanges=function(t,e,n){var o=this,r=this.fo;this.fo=t.fo,this.mutatedKeys=t.mutatedKeys;var i=t.mo.jr();i.sort(function(t,e){return r=t.type,i=e.type,n(r)-n(i)||o.lo(t.doc,e.doc);function n(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Wr()}}var r,i}),this.po(n);var s=e?this.Eo():[],n=0===this.ho.size&&this.current?1:0,e=n!==this.ao;return this.ao=n,0!==i.length||e?{snapshot:new Wc(this.query,t.fo,r,i,t.mutatedKeys,0==n,e,!1),To:s}:{To:s}},gh.prototype.zr=function(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({fo:this.fo,mo:new Hc,mutatedKeys:this.mutatedKeys,Nn:!1},!1)):{To:[]}},gh.prototype.Io=function(t){return!this.uo.has(t)&&!!this.fo.has(t)&&!this.fo.get(t).hasLocalMutations},gh.prototype.po=function(t){var e=this;t&&(t.addedDocuments.forEach(function(t){return e.uo=e.uo.add(t)}),t.modifiedDocuments.forEach(function(t){}),t.removedDocuments.forEach(function(t){return e.uo=e.uo.delete(t)}),this.current=t.current)},gh.prototype.Eo=function(){var e=this;if(!this.current)return[];var n=this.ho;this.ho=Ys(),this.fo.forEach(function(t){e.Io(t.key)&&(e.ho=e.ho.add(t.key))});var r=[];return n.forEach(function(t){e.ho.has(t)||r.push(new hh(t))}),this.ho.forEach(function(t){n.has(t)||r.push(new ch(t))}),r},gh.prototype.Ao=function(t){this.uo=t.Bn,this.ho=Ys();t=this._o(t.documents);return this.applyChanges(t,!0)},gh.prototype.Ro=function(){return Wc.fromInitialDocuments(this.query,this.fo,this.mutatedKeys,0===this.ao)},gh),fh=function(t,e,n){this.query=t,this.targetId=e,this.view=n},ph=function(t){this.key=t,this.bo=!1},dh=(Object.defineProperty(yh.prototype,"isPrimaryClient",{get:function(){return!0===this.$o},enumerable:!1,configurable:!0}),yh);function yh(t,e,n,r,i,o){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.vo={},this.Po=new eu(xo,Fo),this.Vo=new Map,this.So=new Set,this.Do=new Ps(Si.comparator),this.Co=new Map,this.No=new Tu,this.xo={},this.Fo=new Map,this.ko=Ya.Yt(),this.onlineState="Unknown",this.$o=void 0}function gh(t,e){this.query=t,this.uo=e,this.ao=null,this.current=!1,this.ho=Ys(),this.mutatedKeys=Ys(),this.lo=qo(t),this.fo=new Kc(this.lo)}function vh(a,u){return y(this,void 0,void 0,function(){var n,r,i,o,s;return g(this,function(t){switch(t.label){case 0:return(e=a).remoteStore.remoteSyncer.applyRemoteEvent=wh.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=function(t,e){var n=t,t=n.Co.get(e);if(t&&t.bo)return Ys().add(t.key);var r=Ys(),e=n.Vo.get(e);if(!e)return r;for(var i=0,o=e;i<o.length;i++){var s=o[i],s=n.Po.get(s);r=r.unionWith(s.view.wo)}return r}.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=function(o,s,a){return y(this,void 0,void 0,function(){var e,n,r,i;return g(this,function(t){switch(t.label){case 0:return(e=o).sharedClientState.updateQueryState(s,"rejected",a),i=e.Co.get(s),(n=i&&i.key)?(r=(r=new Ps(Si.comparator)).insert(n,Bi.newNoDocument(n,Zr.min())),i=Ys().add(n),i=new Js(Zr.min(),new Map,new js(Xr),r,i),[4,wh(e,i)]):[3,2];case 1:return t.sent(),e.Do=e.Do.remove(n),e.Co.delete(s),Nh(e),[3,4];case 2:return[4,mu(e.localStore,s,!1).then(function(){return Ih(e,s,a)}).catch(Za)];case 3:t.sent(),t.label=4;case 4:return[2]}})})}.bind(null,e),e.vo._r=function(t,e){for(var n=t,r=!1,i=0,o=e;i<o.length;i++){var s=o[i],a=s.query,a=n.queries.get(a);if(a){for(var u=0,c=a.listeners;u<c.length;u++)c[u].Hr(s)&&(r=!0);a.Wr=s}}r&&Zc(n)}.bind(null,e.eventManager),e.vo.Mo=function(t,e,n){var r=t;if(t=r.queries.get(e))for(var i=0,o=t.listeners;i<o.length;i++)o[i].onError(n);r.queries.delete(e)}.bind(null,e.eventManager),(s=(n=e).Po.get(u))?(r=s.targetId,n.sharedClientState.addLocalQueryTarget(r),i=s.view.Ro(),[3,4]):[3,1];case 1:return[4,vu(n.localStore,Po(u))];case 2:return o=t.sent(),s=n.sharedClientState.addLocalQueryTarget(o.targetId),r=o.targetId,[4,function(i,o,s,a){return y(this,void 0,void 0,function(){var e,n,r;return g(this,function(t){switch(t.label){case 0:return i.Oo=function(t,e,n){return function(r,i,o,s){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return(e=i.view._o(o)).Nn?[4,wu(r.localStore,i.query,!1).then(function(t){t=t.documents;return i.view._o(t,e)})]:[3,2];case 1:e=t.sent(),t.label=2;case 2:return n=s&&s.targetChanges.get(i.targetId),n=i.view.applyChanges(e,r.isPrimaryClient,n),[2,(Ah(r,i.targetId,n.To),n.snapshot)]}})})}(i,t,e,n)},[4,wu(i.localStore,o,!0)];case 1:return n=t.sent(),r=new lh(o,n.Bn),e=r._o(n.documents),n=$s.createSynthesizedTargetChangeForCurrentChange(s,a&&"Offline"!==i.onlineState),n=r.applyChanges(e,i.isPrimaryClient,n),Ah(i,s,n.To),r=new fh(o,s,r),[2,(i.Po.set(o,r),i.Vo.has(s)?i.Vo.get(s).push(o):i.Vo.set(s,[o]),n.snapshot)]}})})}(n,u,r,"current"===s)];case 3:i=t.sent(),n.isPrimaryClient&&Ic(n.remoteStore,o),t.label=4;case 4:return[2,i]}var e})})}function mh(f,p,d){return y(this,void 0,void 0,function(){var s,l;return g(this,function(t){switch(t.label){case 0:(o=f).remoteStore.remoteSyncer.applySuccessfulWrite=function(i,o){return y(this,void 0,void 0,function(){var e,n,r;return g(this,function(t){switch(t.label){case 0:e=i,n=o.batch.batchId,t.label=1;case 1:return t.trys.push([1,4,,6]),[4,pu(e.localStore,o)];case 2:return r=t.sent(),Th(e,n,null),Eh(e,n),e.sharedClientState.updateMutationState(n,"acknowledged"),[4,Dh(e,r)];case 3:return t.sent(),[3,6];case 4:return[4,Za(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})}.bind(null,o),o.remoteStore.remoteSyncer.rejectFailedWrite=function(s,a,u){return y(this,void 0,void 0,function(){var n,o;return g(this,function(t){switch(t.label){case 0:n=s,t.label=1;case 1:return t.trys.push([1,4,,6]),[4,(e=n.localStore,r=a,(i=e).persistence.runTransaction("Reject batch","readwrite-primary",function(e){var n;return i._n.lookupMutationBatch(e,r).next(function(t){return Qr(null!==t),n=t.keys(),i._n.removeMutationBatch(e,t)}).next(function(){return i._n.performConsistencyCheck(e)}).next(function(){return i.Mn.pn(e,n)})}))];case 2:return o=t.sent(),Th(n,a,u),Eh(n,a),n.sharedClientState.updateMutationState(a,"rejected",u),[4,Dh(n,o)];case 3:return t.sent(),[3,6];case 4:return[4,Za(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}var e,r,i})})}.bind(null,o),l=o,t.label=1;case 1:return t.trys.push([1,5,,6]),[4,(r=l.localStore,a=p,c=r,h=$r.now(),i=a.reduce(function(t,e){return t.add(e.key)},Ys()),c.persistence.runTransaction("Locally write mutations","readwrite",function(s){return c.Mn.pn(s,i).next(function(t){u=t;for(var e=[],n=0,r=a;n<r.length;n++){var i=r[n],o=function(t,e){for(var n=null,r=0,i=t.fieldTransforms;r<i.length;r++){var o=i[r],s=e.data.field(o.field),s=Ko(o.transform,s||null);null!=s&&(n=null==n?qi.empty():n).set(o.field,s)}return n||null}(i,u.get(i.key));null!=o&&e.push(new ms(i.key,o,function s(t){var a=[];return ri(t.fields,function(t,e){var n=new ci([t]);if(Vi(e))if(0===(e=s(e.mapValue).fields).length)a.push(n);else for(var r=0,i=e;r<i.length;r++){var o=i[r];a.push(n.child(o))}else a.push(n)}),new hi(a)}(o.value.mapValue),cs.exists(!0)))}return c._n.addMutationBatch(s,h,e,a)})}).then(function(t){return t.applyToLocalDocumentSet(u),{batchId:t.batchId,changes:u}}))];case 2:return s=t.sent(),l.sharedClientState.addPendingMutation(s.batchId),e=l,n=s.batchId,o=d,r=(r=(r=e.xo[e.currentUser.toKey()])||new Ps(Xr)).insert(n,o),e.xo[e.currentUser.toKey()]=r,[4,Dh(l,s.changes)];case 3:return t.sent(),[4,Mc(l.remoteStore)];case 4:return t.sent(),[3,6];case 5:return l=t.sent(),l=Bc(l,"Failed to persist write"),d.reject(l),[3,6];case 6:return[2]}var e,n,r,a,u,c,h,i,o})})}function wh(r,i){return y(this,void 0,void 0,function(){var n,e;return g(this,function(t){switch(t.label){case 0:n=r,t.label=1;case 1:return t.trys.push([1,4,,6]),[4,yu(n.localStore,i)];case 2:return e=t.sent(),i.targetChanges.forEach(function(t,e){e=n.Co.get(e);e&&(Qr(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),0<t.addedDocuments.size?e.bo=!0:0<t.modifiedDocuments.size?Qr(e.bo):0<t.removedDocuments.size&&(Qr(e.bo),e.bo=!1))}),[4,Dh(n,e,i)];case 3:return t.sent(),[3,6];case 4:return[4,Za(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})}function bh(t,n,e){var r,t=t;(t.isPrimaryClient&&0===e||!t.isPrimaryClient&&1===e)&&(r=[],t.Po.forEach(function(t,e){e=e.view.zr(n);e.snapshot&&r.push(e.snapshot)}),function(t,i){t.onlineState=i;var o=!1;t.queries.forEach(function(t,e){for(var n=0,r=e.listeners;n<r.length;n++)r[n].zr(i)&&(o=!0)}),o&&Zc(t)}(t.eventManager,n),r.length&&t.vo._r(r),t.onlineState=n,t.isPrimaryClient&&t.sharedClientState.setOnlineState(n))}function _h(o,s){return y(this,void 0,void 0,function(){var n,r,i;return g(this,function(t){switch(t.label){case 0:Rc((n=o).remoteStore)||Br("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,(e=n.localStore).persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(t){return e._n.getHighestUnacknowledgedBatchId(t)})];case 2:return-1===(r=t.sent())?[2,void s.resolve()]:((i=n.Fo.get(r)||[]).push(s),n.Fo.set(r,i),[3,4]);case 3:return i=t.sent(),i=Bc(i,"Initialization of waitForPendingWrites() operation failed"),s.reject(i),[3,4];case 4:return[2]}var e})})}function Eh(t,e){(t.Fo.get(e)||[]).forEach(function(t){t.resolve()}),t.Fo.delete(e)}function Th(t,e,n){var r=t,i=r.xo[r.currentUser.toKey()];i&&((t=i.get(e))&&(n?t.reject(n):t.resolve(),i=i.remove(e)),r.xo[r.currentUser.toKey()]=i)}function Ih(e,t,n){void 0===n&&(n=null),e.sharedClientState.removeLocalQueryTarget(t);for(var r=0,i=e.Vo.get(t);r<i.length;r++){var o=i[r];e.Po.delete(o),n&&e.vo.Mo(o,n)}e.Vo.delete(t),e.isPrimaryClient&&e.No.Zn(t).forEach(function(t){e.No.containsKey(t)||Sh(e,t)})}function Sh(t,e){t.So.delete(e.path.canonicalString());var n=t.Do.get(e);null!==n&&(Sc(t.remoteStore,n),t.Do=t.Do.remove(e),t.Co.delete(n),Nh(t))}function Ah(t,e,n){for(var r,i,o,s=0,a=n;s<a.length;s++){var u=a[s];u instanceof ch?(t.No.addReference(u.key,e),r=t,o=void 0,i=(o=(i=u).key).path.canonicalString(),r.Do.get(o)||r.So.has(i)||(Br("SyncEngine","New document in limbo: "+o),r.So.add(i),Nh(r))):u instanceof hh?(Br("SyncEngine","Document no longer in limbo: "+u.key),t.No.removeReference(u.key,e),t.No.containsKey(u.key)||Sh(t,u.key)):Wr()}}function Nh(t){for(;0<t.So.size&&t.Do.size<t.maxConcurrentLimboResolutions;){var e=t.So.values().next().value;t.So.delete(e);var n=new Si(ai.fromString(e)),e=t.ko.next();t.Co.set(e,new ph(n)),t.Do=t.Do.insert(n,e),Ic(t.remoteStore,new Ba(Po(No(n.path)),e,2,Pr.o))}}function Dh(e,s,a){return y(this,void 0,void 0,function(){var n,r,i,o;return g(this,function(t){switch(t.label){case 0:return r=[],i=[],o=[],(n=e).Po.isEmpty()?[3,3]:(n.Po.forEach(function(t,e){o.push(n.Oo(e,s,a).then(function(t){t&&(n.isPrimaryClient&&n.sharedClientState.updateQueryState(e.targetId,t.fromCache?"not-current":"current"),r.push(t),t=ru.Pn(e.targetId,t),i.push(t))}))}),[4,Promise.all(o)]);case 1:return t.sent(),n.vo._r(r),[4,function(u,c){return y(this,void 0,void 0,function(){var r,e,n,i,o,s,a;return g(this,function(t){switch(t.label){case 0:r=u,t.label=1;case 1:return t.trys.push([1,3,,4]),[4,r.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(n){return Ma.forEach(c,function(e){return Ma.forEach(e.bn,function(t){return r.persistence.referenceDelegate.addReference(n,e.targetId,t)}).next(function(){return Ma.forEach(e.vn,function(t){return r.persistence.referenceDelegate.removeReference(n,e.targetId,t)})})})})];case 2:return t.sent(),[3,4];case 3:if(!Va(e=t.sent()))throw e;return Br("LocalStore","Failed to update sequence numbers: "+e),[3,4];case 4:for(n=0,i=c;n<i.length;n++)a=i[n],o=a.targetId,a.fromCache||(s=r.Fn.get(o),a=s.snapshotVersion,a=s.withLastLimboFreeSnapshotVersion(a),r.Fn=r.Fn.insert(o,a));return[2]}})})}(n.localStore,i)];case 2:t.sent(),t.label=3;case 3:return[2]}})})}function Ch(i,o){return y(this,void 0,void 0,function(){var n,r;return g(this,function(t){switch(t.label){case 0:return(n=i).currentUser.isEqual(o)?[3,3]:(Br("SyncEngine","User change. New user:",o.toKey()),[4,fu(n.localStore,o)]);case 1:return r=t.sent(),n.currentUser=o,(e=n).Fo.forEach(function(t){t.forEach(function(t){t.reject(new Vr(xr.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.Fo.clear(),n.sharedClientState.handleUserChange(o,r.removedBatchIds,r.addedBatchIds),[4,Dh(n,r.Ln)];case 2:t.sent(),t.label=3;case 3:return[2]}var e})})}function Rh(t,e,n){var r=t;!function(f,p,d){return y(this,void 0,void 0,function(){var a,u,c,h,l;return g(this,function(t){switch(t.label){case 0:return t.trys.push([0,14,,15]),[4,p.getMetadata()];case 1:return a=t.sent(),[4,(r=f.localStore,o=r,s=ya((i=a).createTime),o.persistence.runTransaction("hasNewerBundle","readonly",function(t){return o.Qe.getBundleMetadata(t,i.id)}).then(function(t){return!!t&&0<=t.createTime.compareTo(s)}))];case 2:return t.sent()?[4,p.close()]:[3,4];case 3:return[2,(t.sent(),void d._completeWith({taskState:"Success",documentsLoaded:a.totalDocuments,bytesLoaded:a.totalBytes,totalDocuments:a.totalDocuments,totalBytes:a.totalBytes}))];case 4:return d._updateProgress(uh(a)),u=new rh(a,f.localStore,p.R),[4,p.Lo()];case 5:c=t.sent(),t.label=6;case 6:return c?[4,u.oo(c)]:[3,10];case 7:return(h=t.sent())&&d._updateProgress(h),[4,p.Lo()];case 8:c=t.sent(),t.label=9;case 9:return[3,6];case 10:return[4,u.complete()];case 11:return l=t.sent(),[4,Dh(f,l.wn,void 0)];case 12:return t.sent(),[4,(r=f.localStore,e=a,(n=r).persistence.runTransaction("Save bundle","readwrite",function(t){return n.Qe.saveBundleMetadata(t,e)}))];case 13:return t.sent(),d._completeWith(l.progress),[3,15];case 14:return Kr("SyncEngine","Loading bundle failed with "+(l=t.sent())),d._failWith(l),[3,15];case 15:return[2]}var e,n,r,i,o,s})})}(r,e,n).then(function(){r.sharedClientState.notifyBundleLoaded()})}var kh=(Ph.prototype.initialize=function(e){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return this.R=sc(e.databaseInfo.databaseId),this.sharedClientState=this.Bo(e),this.persistence=this.qo(e),[4,this.persistence.start()];case 1:return t.sent(),this.gcScheduler=this.Uo(e),this.localStore=this.Qo(e),[2]}})})},Ph.prototype.Uo=function(t){return null},Ph.prototype.Qo=function(t){return e=this.persistence,n=new iu,r=t.initialUser,t=this.R,new ou(e,n,r,t);var e,n,r},Ph.prototype.qo=function(t){return new Cu(ku.bs,this.R)},Ph.prototype.Bo=function(t){return new Wu},Ph.prototype.terminate=function(){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return this.gcScheduler&&this.gcScheduler.stop(),[4,this.sharedClientState.shutdown()];case 1:return t.sent(),[4,this.persistence.shutdown()];case 2:return t.sent(),[2]}})})},Ph),Oh=(Lh.prototype.initialize=function(n,r){return y(this,void 0,void 0,function(){var e=this;return g(this,function(t){switch(t.label){case 0:return this.localStore?[3,2]:(this.localStore=n.localStore,this.sharedClientState=n.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!n.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(t){return bh(e.syncEngine,t,1)},this.remoteStore.remoteSyncer.handleCredentialChange=Ch.bind(null,this.syncEngine),[4,function(n,r){return y(this,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=n,r?(e.Or.delete(2),[4,Ec(e)]):[3,2];case 1:return t.sent(),[3,5];case 2:return r?[3,4]:(e.Or.add(2),[4,Tc(e)]);case 3:t.sent(),e.Br.set("Unknown"),t.label=4;case 4:t.label=5;case 5:return[2]}})})}(this.remoteStore,this.syncEngine.isPrimaryClient)]);case 1:t.sent(),t.label=2;case 2:return[2]}})})},Lh.prototype.createEventManager=function(t){return new Gc},Lh.prototype.createDatastore=function(t){var e=sc(t.databaseInfo.databaseId),n=(n=t.databaseInfo,new Ju(n));return t=t.credentials,new dc(t,n,e)},Lh.prototype.createRemoteStore=function(t){var e=this,n=this.localStore,r=this.datastore,i=t.asyncQueue,o=function(t){return bh(e.syncEngine,t,0)},t=new(zu.yt()?zu:Qu);return new ac(n,r,i,o,t)},Lh.prototype.createSyncEngine=function(t,e){return function(t,e,n,r,i,o,s){o=new dh(t,e,n,r,i,o);return s&&(o.$o=!0),o}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)},Lh.prototype.terminate=function(){return function(n){return y(this,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=n,Br("RemoteStore","RemoteStore shutting down."),e.Or.add(5),[4,Tc(e)];case 1:return t.sent(),e.Lr.shutdown(),e.Br.set("Unknown"),[2]}})})}(this.remoteStore)},Lh);function Lh(){}function Ph(){this.synchronizeTabs=!1}function Mh(n,r){void 0===r&&(r=10240);var i=0;return{read:function(){return y(this,void 0,void 0,function(){var e;return g(this,function(t){return i<n.byteLength?(e={value:n.slice(i,i+r),done:!1},[2,(i+=r,e)]):[2,{done:!0}]})})},cancel:function(){return y(this,void 0,void 0,function(){return g(this,function(t){return[2]})})},releaseLock:function(){},closed:Promise.reject("unimplemented")}}var Fh=(Hh.prototype.next=function(t){this.observer.next&&this.jo(this.observer.next,t)},Hh.prototype.error=function(t){this.observer.error?this.jo(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},Hh.prototype.Wo=function(){this.muted=!0},Hh.prototype.jo=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},Hh),xh=(Kh.prototype.close=function(){return this.Go.cancel()},Kh.prototype.getMetadata=function(){return y(this,void 0,void 0,function(){return g(this,function(t){return[2,this.metadata.promise]})})},Kh.prototype.Lo=function(){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return[4,this.getMetadata()];case 1:return[2,(t.sent(),this.Ho())]}})})},Kh.prototype.Ho=function(){return y(this,void 0,void 0,function(){var e,n,r;return g(this,function(t){switch(t.label){case 0:return[4,this.Jo()];case 1:return null===(e=t.sent())?[2,null]:(r=this.zo.decode(e),n=Number(r),isNaN(n)&&this.Yo("length string ("+r+") is not valid number"),[4,this.Xo(n)]);case 2:return r=t.sent(),[2,new eh(JSON.parse(r),e.length+n)]}})})},Kh.prototype.Zo=function(){return this.buffer.findIndex(function(t){return t==="{".charCodeAt(0)})},Kh.prototype.Jo=function(){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return this.Zo()<0?[4,this.tc()]:[3,3];case 1:if(t.sent())return[3,3];t.label=2;case 2:return[3,0];case 3:return 0===this.buffer.length?[2,null]:((e=this.Zo())<0&&this.Yo("Reached the end of bundle when a length string is expected."),n=this.buffer.slice(0,e),[2,(this.buffer=this.buffer.slice(e),n)])}})})},Kh.prototype.Xo=function(n){return y(this,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return this.buffer.length<n?[4,this.tc()]:[3,3];case 1:t.sent()&&this.Yo("Reached the end of bundle when more is expected."),t.label=2;case 2:return[3,0];case 3:return e=this.zo.decode(this.buffer.slice(0,n)),[2,(this.buffer=this.buffer.slice(n),e)]}})})},Kh.prototype.Yo=function(t){throw this.Go.cancel(),new Error("Invalid bundle format: "+t)},Kh.prototype.tc=function(){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return[4,this.Go.read()];case 1:return(e=t.sent()).done||((n=new Uint8Array(this.buffer.length+e.value.length)).set(this.buffer),n.set(e.value,this.buffer.length),this.buffer=n),[2,e.done]}})})},Kh),Vh=(Gh.prototype.lookup=function(r){return y(this,void 0,void 0,function(){var e,n=this;return g(this,function(t){switch(t.label){case 0:if(this.ensureCommitNotCalled(),0<this.mutations.length)throw new Vr(xr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(s,a){return y(this,void 0,void 0,function(){var n,e,r,i,o;return g(this,function(t){switch(t.label){case 0:return e=_a((n=s).R)+"/documents",r={documents:a.map(function(t){return ma(n.R,t)})},[4,n.$i("BatchGetDocuments",e,r)];case 1:return r=t.sent(),i=new Map,r.forEach(function(t){var e,t=(e=n.R,"found"in(t=t)?function(t,e){Qr(!!e.found),e.found.name,e.found.updateTime;var n=wa(t,e.found.name),t=ya(e.found.updateTime),e=new qi({mapValue:{fields:e.found.fields}});return Bi.newFoundDocument(n,t,e)}(e,t):"missing"in t?function(t,e){Qr(!!e.missing),Qr(!!e.readTime);t=wa(t,e.missing),e=ya(e.readTime);return Bi.newNoDocument(t,e)}(e,t):Wr());i.set(t.key.toString(),t)}),o=[],[2,(a.forEach(function(t){t=i.get(t.toString());Qr(!!t),o.push(t)}),o)]}})})}(this.datastore,r)];case 1:return[2,((e=t.sent()).forEach(function(t){return n.recordVersion(t)}),e)]}})})},Gh.prototype.set=function(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())},Gh.prototype.update=function(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t.toString())},Gh.prototype.delete=function(t){this.write(new Ds(t,this.precondition(t))),this.writtenDocs.add(t.toString())},Gh.prototype.commit=function(){return y(this,void 0,void 0,function(){var e,n=this;return g(this,function(t){switch(t.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;return e=this.readVersions,this.mutations.forEach(function(t){e.delete(t.key.toString())}),e.forEach(function(t,e){e=Si.fromPath(e);n.mutations.push(new Cs(e,n.precondition(e)))}),[4,function(i,o){return y(this,void 0,void 0,function(){var e,n,r;return g(this,function(t){switch(t.label){case 0:return n=_a((e=i).R)+"/documents",r={writes:o.map(function(t){return Ia(e.R,t)})},[4,e.Ni("Commit",n,r)];case 1:return t.sent(),[2]}})})}(this.datastore,this.mutations)];case 1:return t.sent(),this.committed=!0,[2]}})})},Gh.prototype.recordVersion=function(t){var e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw Wr();e=Zr.min()}var n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new Vr(xr.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)},Gh.prototype.precondition=function(t){var e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?cs.updateTime(e):cs.none()},Gh.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t.toString());if(this.writtenDocs.has(t.toString())||!e)return cs.exists(!0);if(e.isEqual(Zr.min()))throw new Vr(xr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return cs.updateTime(e)},Gh.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations.push(t)},Gh.prototype.ensureCommitNotCalled=function(){},Gh),Uh=(Bh.prototype.run=function(){this.nc()},Bh.prototype.nc=function(){var t=this;this.Zi.ji(function(){return y(t,void 0,void 0,function(){var e,n,r=this;return g(this,function(t){return e=new Vh(this.datastore),(n=this.sc(e))&&n.then(function(t){r.asyncQueue.enqueueAndForget(function(){return e.commit().then(function(){r.deferred.resolve(t)}).catch(function(t){r.ic(t)})})}).catch(function(t){r.ic(t)}),[2]})})})},Bh.prototype.sc=function(t){try{var e=this.updateFunction(t);return!Ti(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}},Bh.prototype.ic=function(t){var e=this;0<this.ec&&this.rc(t)?(--this.ec,this.asyncQueue.enqueueAndForget(function(){return e.nc(),Promise.resolve()})):this.deferred.reject(t)},Bh.prototype.rc=function(t){if("FirebaseError"!==t.name)return!1;t=t.code;return"aborted"===t||"failed-precondition"===t||!Os(t)},Bh),qh=(jh.prototype.getConfiguration=function(){return y(this,void 0,void 0,function(){return g(this,function(t){return[2,{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100}]})})},jh.prototype.setCredentialChangeListener=function(t){this.credentialListener=t},jh.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new Vr(xr.FAILED_PRECONDITION,"The client has already been terminated.")},jh.prototype.terminate=function(){var t=this;this.asyncQueue.enterRestrictedMode();var n=new Pa;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return t.trys.push([0,5,,6]),this.onlineComponents?[4,this.onlineComponents.terminate()]:[3,2];case 1:t.sent(),t.label=2;case 2:return this.offlineComponents?[4,this.offlineComponents.terminate()]:[3,4];case 3:t.sent(),t.label=4;case 4:return this.credentials.removeChangeListener(),n.resolve(),[3,6];case 5:return e=t.sent(),e=Bc(e,"Failed to shutdown persistence"),n.reject(e),[3,6];case 6:return[2]}})})}),n.promise},jh);function jh(t,e,n){var r=this;this.credentials=t,this.asyncQueue=e,this.databaseInfo=n,this.user=Ou.UNAUTHENTICATED,this.clientId=zr.u(),this.credentialListener=function(){return Promise.resolve()},this.credentials.setChangeListener(e,function(e){return y(r,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return Br("FirestoreClient","Received user=",e.uid),[4,this.credentialListener(e)];case 1:return t.sent(),this.user=e,[2]}})})})}function Bh(t,e,n,r){this.asyncQueue=t,this.datastore=e,this.updateFunction=n,this.deferred=r,this.ec=5,this.Zi=new lc(this.asyncQueue,"transaction_retry")}function Gh(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}function Kh(t,e){var n=this;this.Go=t,this.R=e,this.metadata=new Pa,this.buffer=new Uint8Array,this.zo=new TextDecoder("utf-8"),this.Ho().then(function(t){t&&t.io()?n.metadata.resolve(t.payload.metadata):n.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             "+JSON.stringify(null==t?void 0:t.payload)))},function(t){return n.metadata.reject(t)})}function Hh(t){this.observer=t,this.muted=!1}function Wh(e){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return e.offlineComponents?[3,2]:(Br("FirestoreClient","Using default OfflineComponentProvider"),[4,function(i,o){return y(this,void 0,void 0,function(){var e,n,r=this;return g(this,function(t){switch(t.label){case 0:return i.asyncQueue.verifyOperationInProgress(),Br("FirestoreClient","Initializing OfflineComponentProvider"),[4,i.getConfiguration()];case 1:return e=t.sent(),[4,o.initialize(e)];case 2:return t.sent(),n=e.initialUser,i.setCredentialChangeListener(function(e){return y(r,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return n.isEqual(e)?[3,2]:[4,fu(o.localStore,e)];case 1:t.sent(),n=e,t.label=2;case 2:return[2]}})})}),o.persistence.setDatabaseDeletedListener(function(){return i.terminate()}),i.offlineComponents=o,[2]}})})}(e,new kh)]);case 1:t.sent(),t.label=2;case 2:return[2,e.offlineComponents]}})})}function Qh(e){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return e.onlineComponents?[3,2]:(Br("FirestoreClient","Using default OnlineComponentProvider"),[4,function(r,i){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return r.asyncQueue.verifyOperationInProgress(),[4,Wh(r)];case 1:return e=t.sent(),Br("FirestoreClient","Initializing OnlineComponentProvider"),[4,r.getConfiguration()];case 2:return n=t.sent(),[4,i.initialize(e,n)];case 3:return t.sent(),r.setCredentialChangeListener(function(t){return function(r,i){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return(e=r).asyncQueue.verifyOperationInProgress(),Br("RemoteStore","RemoteStore received new credentials"),n=Rc(e),e.Or.add(3),[4,Tc(e)];case 1:return t.sent(),n&&e.Br.set("Unknown"),[4,e.remoteSyncer.handleCredentialChange(i)];case 2:return t.sent(),e.Or.delete(3),[4,Ec(e)];case 3:return t.sent(),[2]}})})}(i.remoteStore,t)}),r.onlineComponents=i,[2]}})})}(e,new Oh)]);case 1:t.sent(),t.label=2;case 2:return[2,e.onlineComponents]}})})}function zh(t){return Wh(t).then(function(t){return t.persistence})}function Yh(t){return Wh(t).then(function(t){return t.localStore})}function Xh(t){return Qh(t).then(function(t){return t.remoteStore})}function Jh(t){return Qh(t).then(function(t){return t.syncEngine})}function $h(r){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return[4,Qh(r)];case 1:return e=t.sent(),[2,((n=e.eventManager).onListen=vh.bind(null,e.syncEngine),n.onUnlisten=function(i,o){return y(this,void 0,void 0,function(){var e,n,r;return g(this,function(t){switch(t.label){case 0:return n=(e=i).Po.get(o),1<(r=e.Vo.get(n.targetId)).length?[2,(e.Vo.set(n.targetId,r.filter(function(t){return!Fo(t,o)})),void e.Po.delete(o))]:e.isPrimaryClient?(e.sharedClientState.removeLocalQueryTarget(n.targetId),e.sharedClientState.isActiveQueryTarget(n.targetId)?[3,2]:[4,mu(e.localStore,n.targetId,!1).then(function(){e.sharedClientState.clearQueryState(n.targetId),Sc(e.remoteStore,n.targetId),Ih(e,n.targetId)}).catch(Za)]):[3,3];case 1:t.sent(),t.label=2;case 2:return[3,5];case 3:return Ih(e,n.targetId),[4,mu(e.localStore,n.targetId,!0)];case 4:t.sent(),t.label=5;case 5:return[2]}})})}.bind(null,e.syncEngine),n)]}})})}function Zh(n,r,i){var t=this;void 0===i&&(i={});var o=new Pa;return n.asyncQueue.enqueueAndForget(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=function(n,r,i,o,s){var t=new Fh({next:function(t){r.enqueueAndForget(function(){return $c(n,a)});var e=t.docs.has(i);!e&&t.fromCache?s.reject(new Vr(xr.UNAVAILABLE,"Failed to get document because the client is offline.")):e&&t.fromCache&&o&&"server"===o.source?s.reject(new Vr(xr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):s.resolve(t)},error:function(t){return s.reject(t)}}),a=new th(No(i.path),t,{includeMetadataChanges:!0,so:!0});return Jc(n,a)},[4,$h(n)];case 1:return[2,e.apply(void 0,[t.sent(),n.asyncQueue,r,i,o])]}})})}),o.promise}function tl(n,r,i){var t=this;void 0===i&&(i={});var o=new Pa;return n.asyncQueue.enqueueAndForget(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=function(e,n,t,r,i){var o=new Fh({next:function(t){n.enqueueAndForget(function(){return $c(e,s)}),t.fromCache&&"server"===r.source?i.reject(new Vr(xr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(t)},error:function(t){return i.reject(t)}}),s=new th(t,o,{includeMetadataChanges:!0,so:!0});return Jc(e,s)},[4,$h(n)];case 1:return[2,e.apply(void 0,[t.sent(),n.asyncQueue,r,i,o])]}})})}),o.promise}function el(t,e){this.user=e,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+t}var nl=function(t,e,n,r,i,o,s,a){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=s,this.useFetchStreams=a},rl=(Object.defineProperty(yl.prototype,"isDefaultDatabase",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),yl.prototype.isEqual=function(t){return t instanceof yl&&t.projectId===this.projectId&&t.database===this.database},yl),il=new Map,ol=(dl.prototype.getToken=function(){return Promise.resolve(null)},dl.prototype.invalidateToken=function(){},dl.prototype.setChangeListener=function(t,e){this.changeListener=e,t.enqueueRetryable(function(){return e(Ou.UNAUTHENTICATED)})},dl.prototype.removeChangeListener=function(){this.changeListener=null},dl),sl=(pl.prototype.getToken=function(){return Promise.resolve(this.token)},pl.prototype.invalidateToken=function(){},pl.prototype.setChangeListener=function(t,e){var n=this;this.changeListener=e,t.enqueueRetryable(function(){return e(n.token.user)})},pl.prototype.removeChangeListener=function(){this.changeListener=null},pl),al=(fl.prototype.getToken=function(){var e=this,n=this.cc,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(function(t){return e.cc!==n?(Br("FirebaseCredentialsProvider","getToken aborted due to token change."),e.getToken()):t?(Qr("string"==typeof t.accessToken),new el(t.accessToken,e.currentUser)):null}):Promise.resolve(null)},fl.prototype.invalidateToken=function(){this.forceRefresh=!0},fl.prototype.setChangeListener=function(t,e){var n=this;this.asyncQueue=t,this.asyncQueue.enqueueRetryable(function(){return y(n,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return[4,this.oc.promise];case 1:return t.sent(),[4,e(this.currentUser)];case 2:return t.sent(),this.changeListener=e,[2]}})})})},fl.prototype.removeChangeListener=function(){this.auth&&this.auth.removeAuthTokenListener(this.uc),this.changeListener=function(){return Promise.resolve()}},fl.prototype.ac=function(){var t=this.auth&&this.auth.getUid();return Qr(null===t||"string"==typeof t),new Ou(t)},fl),ul=(Object.defineProperty(ll.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.lc},e=this.hc.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),this.fc&&(t["X-Goog-Iam-Authorization-Token"]=this.fc),t},enumerable:!1,configurable:!0}),ll),cl=(hl.prototype.getToken=function(){return Promise.resolve(new ul(this.hc,this.lc,this.fc))},hl.prototype.setChangeListener=function(t,e){t.enqueueRetryable(function(){return e(Ou.FIRST_PARTY)})},hl.prototype.removeChangeListener=function(){},hl.prototype.invalidateToken=function(){},hl);function hl(t,e,n){this.hc=t,this.lc=e,this.fc=n}function ll(t,e,n){this.hc=t,this.lc=e,this.fc=n,this.type="FirstParty",this.user=Ou.FIRST_PARTY}function fl(e){var n=this;this.currentUser=Ou.UNAUTHENTICATED,this.oc=new Pa,this.cc=0,this.forceRefresh=!1,this.auth=null,this.asyncQueue=null,this.uc=function(){n.cc++,n.currentUser=n.ac(),n.oc.resolve(),n.changeListener&&n.asyncQueue.enqueueRetryable(function(){return n.changeListener(n.currentUser)})};function r(t){Br("FirebaseCredentialsProvider","Auth detected"),n.auth=t,n.auth.addAuthTokenListener(n.uc)}e.onInit(r),setTimeout(function(){var t;n.auth||((t=e.getImmediate({optional:!0}))?r(t):(Br("FirebaseCredentialsProvider","Auth not yet detected"),n.oc.resolve()))},0)}function pl(t){this.token=t,this.changeListener=null}function dl(){this.changeListener=null}function yl(t,e){this.projectId=t,this.database=e||"(default)"}function gl(t,e,n){if(!n)throw new Vr(xr.INVALID_ARGUMENT,"Function "+t+"() cannot be called with an empty "+e+".")}function vl(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new Vr(xr.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function ml(t,e,n,r){if(!0===e&&!0===r)throw new Vr(xr.INVALID_ARGUMENT,t+" and "+n+" cannot be used together.")}function wl(t){if(!Si.isDocumentKey(t))throw new Vr(xr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t+" has "+t.length+".")}function bl(t){if(Si.isDocumentKey(t))throw new Vr(xr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t+" has "+t.length+".")}function _l(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return 20<e.length&&(e=e.substring(0,20)+"..."),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"!=typeof e)return"function"==typeof e?"a function":Wr();if(e instanceof Array)return"an array";var t=function(){if(e.constructor){var t=/function\s+([^\s(]+)\s*\(/.exec(e.constructor.toString());if(t&&1<t.length)return t[1]}return null}();return t?"a custom "+t+" object":"an object"}function El(t,e){if((t="_delegate"in t?t._delegate:t)instanceof e)return t;if(e.name===t.constructor.name)throw new Vr(xr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");t=_l(t);throw new Vr(xr.INVALID_ARGUMENT,"Expected type '"+e.name+"', but it was: "+t)}function Tl(t,e){if(e<=0)throw new Vr(xr.INVALID_ARGUMENT,"Function "+t+"() requires a positive number, but it was: "+e+".")}var Il,Sl=(Pl.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams},Pl),Al=(Object.defineProperty(Ll.prototype,"app",{get:function(){if(!this._app)throw new Vr(xr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app},enumerable:!1,configurable:!0}),Object.defineProperty(Ll.prototype,"_initialized",{get:function(){return this._settingsFrozen},enumerable:!1,configurable:!0}),Object.defineProperty(Ll.prototype,"_terminated",{get:function(){return void 0!==this._terminateTask},enumerable:!1,configurable:!0}),Ll.prototype._setSettings=function(t){if(this._settingsFrozen)throw new Vr(xr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Sl(t),void 0!==t.credentials&&(this._credentials=function(t){if(!t)return new ol;switch(t.type){case"gapi":var e=t.client;return Qr(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new cl(e,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new Vr(xr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},Ll.prototype._getSettings=function(){return this._settings},Ll.prototype._freezeSettings=function(){return this._settingsFrozen=!0,this._settings},Ll.prototype._delete=function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask},Ll.prototype.toJSON=function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}},Ll.prototype._terminate=function(){return(t=il.get(this))&&(Br("ComponentProvider","Removing Datastore"),il.delete(this),t.terminate()),Promise.resolve();var t},Ll),Nl=(Object.defineProperty(Ol.prototype,"_path",{get:function(){return this._key.path},enumerable:!1,configurable:!0}),Object.defineProperty(Ol.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(Ol.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(Ol.prototype,"parent",{get:function(){return new Cl(this.firestore,this.converter,this._key.path.popLast())},enumerable:!1,configurable:!0}),Ol.prototype.withConverter=function(t){return new Ol(this.firestore,t,this._key)},Ol),Dl=(kl.prototype.withConverter=function(t){return new kl(this.firestore,t,this._query)},kl),Cl=(n(Rl,Il=Dl),Object.defineProperty(Rl.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(Rl.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(Rl.prototype,"parent",{get:function(){var t=this._path.popLast();return t.isEmpty()?null:new Nl(this.firestore,null,new Si(t))},enumerable:!1,configurable:!0}),Rl.prototype.withConverter=function(t){return new Rl(this.firestore,t,this._path)},Rl);function Rl(t,e,n){var r=this;return(r=Il.call(this,t,e,No(n))||this)._path=n,r.type="collection",r}function kl(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}function Ol(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}function Ll(t,e){this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Sl({}),this._settingsFrozen=!1,t instanceof rl?(this._databaseId=t,this._credentials=new ol):(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Vr(xr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new rl(t.options.projectId)}(t),this._credentials=new al(e))}function Pl(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new Vr(xr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Vr(xr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,ml("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}function Ml(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t=m(t),gl("collection","path",e),t instanceof Al)return bl(n=ai.fromString.apply(ai,s([e],r))),new Cl(t,null,n);if(!(t instanceof Nl||t instanceof Cl))throw new Vr(xr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return bl(n=ai.fromString.apply(ai,s([t.path],r)).child(ai.fromString(e))),new Cl(t.firestore,null,n)}function Fl(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t=m(t),gl("doc","path",e=1===arguments.length?zr.u():e),t instanceof Al)return wl(n=ai.fromString.apply(ai,s([e],r))),new Nl(t,null,new Si(n));if(!(t instanceof Nl||t instanceof Cl))throw new Vr(xr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return wl(n=t._path.child(ai.fromString.apply(ai,s([e],r)))),new Nl(t.firestore,t instanceof Cl?t.converter:null,new Si(n))}function xl(t,e){return t=m(t),e=m(e),(t instanceof Nl||t instanceof Cl)&&(e instanceof Nl||e instanceof Cl)&&t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter}function Vl(t,e){return t=m(t),e=m(e),t instanceof Dl&&e instanceof Dl&&t.firestore===e.firestore&&Fo(t._query,e._query)&&t.converter===e.converter}var Ul=(Object.defineProperty(ql.prototype,"isShuttingDown",{get:function(){return this._c},enumerable:!1,configurable:!0}),ql.prototype.enqueueAndForget=function(t){this.enqueue(t)},ql.prototype.enqueueAndForgetEvenWhileRestricted=function(t){this.Ic(),this.Ac(t)},ql.prototype.enterRestrictedMode=function(){var t;this._c||(this._c=!0,(t=oc())&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Tc))},ql.prototype.enqueue=function(t){return this.Ic(),this._c?new Promise(function(t){}):this.Ac(t)},ql.prototype.enqueueRetryable=function(t){var e=this;this.enqueueAndForget(function(){return e.wc.push(t),e.Rc()})},ql.prototype.Rc=function(){return y(this,void 0,void 0,function(){var e,n=this;return g(this,function(t){switch(t.label){case 0:if(0===this.wc.length)return[3,5];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.wc[0]()];case 2:return t.sent(),this.wc.shift(),this.Zi.reset(),[3,4];case 3:if(!Va(e=t.sent()))throw e;return Br("AsyncQueue","Operation failed with retryable error: "+e),[3,4];case 4:0<this.wc.length&&this.Zi.ji(function(){return n.Rc()}),t.label=5;case 5:return[2]}})})},ql.prototype.Ac=function(t){var r=this,e=this.dc.then(function(){return r.gc=!0,t().catch(function(t){throw r.yc=t,r.gc=!1,Gr("INTERNAL UNHANDLED ERROR: ",(n=(e=t).message||"",n=e.stack?e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack:n)),t;var e,n}).then(function(t){return r.gc=!1,t})});return this.dc=e},ql.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.Ic(),-1<this.Ec.indexOf(t)&&(e=0);n=qc.createAndSchedule(this,t,e,n,function(t){return r.bc(t)});return this.mc.push(n),n},ql.prototype.Ic=function(){this.yc&&Wr()},ql.prototype.verifyOperationInProgress=function(){},ql.prototype.vc=function(){return y(this,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return[4,e=this.dc];case 1:t.sent(),t.label=2;case 2:if(e!==this.dc)return[3,0];t.label=3;case 3:return[2]}})})},ql.prototype.Pc=function(t){for(var e=0,n=this.mc;e<n.length;e++)if(n[e].timerId===t)return!0;return!1},ql.prototype.Vc=function(r){var i=this;return this.vc().then(function(){i.mc.sort(function(t,e){return t.targetTimeMs-e.targetTimeMs});for(var t=0,e=i.mc;t<e.length;t++){var n=e[t];if(n.skipDelay(),"all"!==r&&n.timerId===r)break}return i.vc()})},ql.prototype.Sc=function(t){this.Ec.push(t)},ql.prototype.bc=function(t){t=this.mc.indexOf(t);this.mc.splice(t,1)},ql);function ql(){var e=this;this.dc=Promise.resolve(),this.wc=[],this._c=!1,this.mc=[],this.yc=null,this.gc=!1,this.Ec=[],this.Zi=new lc(this,"async_queue_retry"),this.Tc=function(){var t=oc();t&&Br("AsyncQueue","Visibility state changed to "+t.visibilityState),e.Zi.Gi()};var t=oc();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.Tc)}function jl(i){return function(){if("object"==typeof i&&null!==i)for(var t=i,e=0,n=["next","error","complete"];e<n.length;e++){var r=n[e];if(r in t&&"function"==typeof t[r])return 1}}()}var Bl,Gl=(Wl.prototype.onProgress=function(t,e,n){this._progressObserver={next:t,error:e,complete:n}},Wl.prototype.catch=function(t){return this._taskCompletionResolver.promise.catch(t)},Wl.prototype.then=function(t,e){return this._taskCompletionResolver.promise.then(t,e)},Wl.prototype._completeWith=function(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)},Wl.prototype._failWith=function(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)},Wl.prototype._updateProgress=function(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)},Wl),Kl=(n(Hl,Bl=Al),Hl.prototype._terminate=function(){return this._firestoreClient||zl(this),this._firestoreClient.terminate()},Hl);function Hl(t,e){var n=this;return(n=Bl.call(this,t,e)||this).type="firestore",n._queue=new Ul,n._persistenceKey="name"in t?t.name:"[DEFAULT]",n}function Wl(){this._progressObserver={},this._taskCompletionResolver=new Pa,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}function Ql(t){return t._firestoreClient||zl(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function zl(t){var e,n,r,i=t._freezeSettings(),i=(e=t._databaseId,n=(null===(r=t._app)||void 0===r?void 0:r.options.appId)||"",r=t._persistenceKey,new nl(e,n,r,i.host,i.ssl,i.experimentalForceLongPolling,i.experimentalAutoDetectLongPolling,i.useFetchStreams));t._firestoreClient=new qh(t._credentials,t._queue,i)}var Yl=(af.prototype.isEqual=function(t){return this._internalPath.isEqual(t._internalPath)},af),Xl=(sf.fromBase64String=function(t){try{return new sf(li.fromBase64String(t))}catch(t){throw new Vr(xr.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}},sf.fromUint8Array=function(t){return new sf(li.fromUint8Array(t))},sf.prototype.toBase64=function(){return this._byteString.toBase64()},sf.prototype.toUint8Array=function(){return this._byteString.toUint8Array()},sf.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},sf.prototype.isEqual=function(t){return this._byteString.isEqual(t._byteString)},sf),Jl=function(t){this._methodName=t},$l=(Object.defineProperty(of.prototype,"latitude",{get:function(){return this._lat},enumerable:!1,configurable:!0}),Object.defineProperty(of.prototype,"longitude",{get:function(){return this._long},enumerable:!1,configurable:!0}),of.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},of.prototype.toJSON=function(){return{latitude:this._lat,longitude:this._long}},of.prototype._compareTo=function(t){return Xr(this._lat,t._lat)||Xr(this._long,t._long)},of),Zl=/^__.*__$/,tf=(rf.prototype.toMutation=function(t,e){return null!==this.fieldMask?new ms(t,this.data,this.fieldMask,e,this.fieldTransforms):new vs(t,this.data,e,this.fieldTransforms)},rf),ef=(nf.prototype.toMutation=function(t,e){return new ms(t,this.data,this.fieldMask,e,this.fieldTransforms)},nf);function nf(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}function rf(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}function of(t,e){if(!isFinite(t)||t<-90||90<t)throw new Vr(xr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||180<e)throw new Vr(xr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}function sf(t){this._byteString=t}function af(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0;n<t.length;++n)if(0===t[n].length)throw new Vr(xr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ci(t)}function uf(t){switch(t){case 0:case 2:case 1:return 1;case 3:case 4:return;default:throw Wr()}}var cf=(Object.defineProperty(ff.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(ff.prototype,"Cc",{get:function(){return this.settings.Cc},enumerable:!1,configurable:!0}),ff.prototype.Nc=function(t){return new ff(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.R,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)},ff.prototype.xc=function(t){var e=null===(e=this.path)||void 0===e?void 0:e.child(t),e=this.Nc({path:e,Fc:!1});return e.kc(t),e},ff.prototype.$c=function(t){var e,t=null===(e=this.path)||void 0===e?void 0:e.child(t),t=this.Nc({path:t,Fc:!1});return t.Dc(),t},ff.prototype.Oc=function(t){return this.Nc({path:void 0,Fc:!0})},ff.prototype.Mc=function(t){return jf(t,this.settings.methodName,this.settings.Lc||!1,this.path,this.settings.Bc)},ff.prototype.contains=function(e){return void 0!==this.fieldMask.find(function(t){return e.isPrefixOf(t)})||void 0!==this.fieldTransforms.find(function(t){return e.isPrefixOf(t.field)})},ff.prototype.Dc=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.kc(this.path.get(t))},ff.prototype.kc=function(t){if(0===t.length)throw this.Mc("Document fields must not be empty");if(uf(this.Cc)&&Zl.test(t))throw this.Mc('Document fields cannot begin and end with "__"')},ff),hf=(lf.prototype.qc=function(t,e,n,r){return void 0===r&&(r=!1),new cf({Cc:t,methodName:e,Bc:n,path:ci.emptyPath(),Fc:!1,Lc:r},this.databaseId,this.R,this.ignoreUndefinedProperties)},lf);function lf(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.R=n||sc(t)}function ff(t,e,n,r,i,o){this.settings=t,this.databaseId=e,this.R=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Dc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}function pf(t){var e=t._freezeSettings(),n=sc(t._databaseId);return new hf(t._databaseId,!!e.ignoreUndefinedProperties,n)}function df(t,e,n,r,i,o){var s=t.qc((o=void 0===o?{}:o).merge||o.mergeFields?2:0,e,n,i);xf("Data must be an object, but it was:",s,r);var a,u,r=Mf(r,s);if(o.merge)a=new hi(s.fieldMask),u=s.fieldTransforms;else if(o.mergeFields){for(var c=[],h=0,l=o.mergeFields;h<l.length;h++){var f=Vf(e,l[h],n);if(!s.contains(f))throw new Vr(xr.INVALID_ARGUMENT,"Field '"+f+"' is specified in your field mask but missing from your input data.");Bf(c,f)||c.push(f)}a=new hi(c),u=s.fieldTransforms.filter(function(t){return a.covers(t.field)})}else a=null,u=s.fieldTransforms;return new tf(new qi(r),a,u)}var yf,gf=(n(vf,yf=Jl),vf.prototype._toFieldTransform=function(t){if(2!==t.Cc)throw 1===t.Cc?t.Mc(this._methodName+"() can only appear at the top level of your update data"):t.Mc(this._methodName+"() cannot be used with set() unless you pass {merge:true}");return t.fieldMask.push(t.path),null},vf.prototype.isEqual=function(t){return t instanceof vf},vf);function vf(){return null!==yf&&yf.apply(this,arguments)||this}function mf(t,e,n){return new cf({Cc:3,Bc:e.settings.Bc,methodName:t._methodName,Fc:n},e.databaseId,e.R,e.ignoreUndefinedProperties)}var wf,bf,_f,Ef,Tf=(n(Rf,Ef=Jl),Rf.prototype._toFieldTransform=function(t){return new as(t.path,new Qo)},Rf.prototype.isEqual=function(t){return t instanceof Rf},Rf),If=(n(Cf,_f=Jl),Cf.prototype._toFieldTransform=function(t){var e=mf(this,t,!0),n=this.Uc.map(function(t){return Pf(t,e)}),n=new zo(n);return new as(t.path,n)},Cf.prototype.isEqual=function(t){return this===t},Cf),Sf=(n(Df,bf=Jl),Df.prototype._toFieldTransform=function(t){var e=mf(this,t,!0),n=this.Uc.map(function(t){return Pf(t,e)}),n=new Zo(n);return new as(t.path,n)},Df.prototype.isEqual=function(t){return this===t},Df),Af=(n(Nf,wf=Jl),Nf.prototype._toFieldTransform=function(t){var e=new rs(t.R,Go(t.R,this.Qc));return new as(t.path,e)},Nf.prototype.isEqual=function(t){return this===t},Nf);function Nf(t,e){var n=this;return(n=wf.call(this,t)||this).Qc=e,n}function Df(t,e){var n=this;return(n=bf.call(this,t)||this).Uc=e,n}function Cf(t,e){var n=this;return(n=_f.call(this,t)||this).Uc=e,n}function Rf(){return null!==Ef&&Ef.apply(this,arguments)||this}function kf(t,r,i,e){var o=t.qc(1,r,i);xf("Data must be an object, but it was:",o,e);var s=[],a=qi.empty();ri(e,function(t,e){var n=qf(r,t,i);e=m(e);t=o.$c(n);e instanceof gf?s.push(n):null!=(t=Pf(e,t))&&(s.push(n),a.set(n,t))});e=new hi(s);return new ef(a,e,o.fieldTransforms)}function Of(t,e,n,r,i,o){var s=t.qc(1,e,n),a=[Vf(e,r,n)],u=[i];if(o.length%2!=0)throw new Vr(xr.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)a.push(Vf(e,o[c])),u.push(o[c+1]);for(var h,l,f,p=[],d=qi.empty(),y=a.length-1;0<=y;--y)Bf(p,a[y])||(h=a[y],l=m(l=u[y]),f=s.$c(h),l instanceof gf?p.push(h):null!=(f=Pf(l,f))&&(p.push(h),d.set(h,f)));i=new hi(p);return new ef(d,i,s.fieldTransforms)}function Lf(t,e,n,r){return Pf(n,t.qc((r=void 0===r?!1:r)?4:3,e))}function Pf(s,t){if(Ff(s=m(s)))return xf("Unsupported field value:",t,s),Mf(s,t);if(s instanceof Jl)return function(t,e){if(!uf(e.Cc))throw e.Mc(t._methodName+"() can only be used with update() and set()");if(!e.path)throw e.Mc(t._methodName+"() is not currently supported inside arrays");t=t._toFieldTransform(e);t&&e.fieldTransforms.push(t)}(s,t),null;if(void 0===s&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),s instanceof Array){if(t.settings.Fc&&4!==t.Cc)throw t.Mc("Nested arrays are not supported");return function(t){for(var e=[],n=0,r=0,i=s;r<i.length;r++){var o=Pf(i[r],t.Oc(n));null==o&&(o={nullValue:"NULL_VALUE"}),e.push(o),n++}return{arrayValue:{values:e}}}(t)}return function(t,e){if(null===(t=m(s)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Go(e.R,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=$r.fromDate(t);return{timestampValue:pa(e.R,n)}}if(t instanceof $r)return n=new $r(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)),{timestampValue:pa(e.R,n)};if(t instanceof $l)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Xl)return{bytesValue:da(e.R,t._byteString)};if(t instanceof Nl){var n=e.databaseId,r=t.firestore._databaseId;if(!r.isEqual(n))throw e.Mc("Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return{referenceValue:ga(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.Mc("Unsupported field value: "+_l(t))}(0,t)}function Mf(t,n){var r={};return ii(t)?n.path&&0<n.path.length&&n.fieldMask.push(n.path):ri(t,function(t,e){e=Pf(e,n.xc(t));null!=e&&(r[t]=e)}),{mapValue:{fields:r}}}function Ff(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof $r||t instanceof $l||t instanceof Xl||t instanceof Nl||t instanceof Jl)}function xf(t,e,n){if(!Ff(n)||("object"!=typeof(r=n)||null===r||Object.getPrototypeOf(r)!==Object.prototype&&null!==Object.getPrototypeOf(r))){n=_l(n);throw"an object"===n?e.Mc(t+" a custom object"):e.Mc(t+" "+n)}var r}function Vf(t,e,n){if((e=m(e))instanceof Yl)return e._internalPath;if("string"==typeof e)return qf(t,e);throw jf("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}var Uf=new RegExp("[~\\*/\\[\\]]");function qf(e,n,r){if(0<=n.search(Uf))throw jf("Invalid field path ("+n+"). Paths must not contain '~', '*', '/', '[', or ']'",e,!1,void 0,r);try{return(new(Yl.bind.apply(Yl,s([void 0],n.split(".")))))._internalPath}catch(t){throw jf("Invalid field path ("+n+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",e,!1,void 0,r)}}function jf(t,e,n,r,i){var o=r&&!r.isEmpty(),s=void 0!==i,e="Function "+e+"() called with invalid data";n&&(e+=" (via `toFirestore()`)");n="";return(o||s)&&(n+=" (found",o&&(n+=" in field "+r),s&&(n+=" in document "+i),n+=")"),new Vr(xr.INVALID_ARGUMENT,(e+=". ")+t+n)}function Bf(t,e){return t.some(function(t){return t.isEqual(e)})}var Gf,Kf=(Object.defineProperty(Qf.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(Qf.prototype,"ref",{get:function(){return new Nl(this._firestore,this._converter,this._key)},enumerable:!1,configurable:!0}),Qf.prototype.exists=function(){return null!==this._document},Qf.prototype.data=function(){if(this._document){if(this._converter){var t=new Hf(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}},Qf.prototype.get=function(t){if(this._document){t=this._document.data.field(zf("DocumentSnapshot.get",t));if(null!==t)return this._userDataWriter.convertValue(t)}},Qf),Hf=(n(Wf,Gf=Kf),Wf.prototype.data=function(){return Gf.prototype.data.call(this)},Wf);function Wf(){return null!==Gf&&Gf.apply(this,arguments)||this}function Qf(t,e,n,r,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=i}function zf(t,e){return"string"==typeof e?qf(t,e):(e instanceof Yl?e:e._delegate)._internalPath}var Yf,Xf,Jf=(ip.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},ip),$f=(n(rp,Xf=Kf),rp.prototype.exists=function(){return Xf.prototype.exists.call(this)},rp.prototype.data=function(t){if(void 0===t&&(t={}),this._document){if(this._converter){var e=new Zf(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}},rp.prototype.get=function(t,e){if(void 0===e&&(e={}),this._document){t=this._document.data.field(zf("DocumentSnapshot.get",t));if(null!==t)return this._userDataWriter.convertValue(t,e.serverTimestamps)}},rp),Zf=(n(np,Yf=$f),np.prototype.data=function(t){return Yf.prototype.data.call(this,t=void 0===t?{}:t)},np),tp=(Object.defineProperty(ep.prototype,"docs",{get:function(){var e=[];return this.forEach(function(t){return e.push(t)}),e},enumerable:!1,configurable:!0}),Object.defineProperty(ep.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(ep.prototype,"empty",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),ep.prototype.forEach=function(e,n){var r=this;this._snapshot.docs.forEach(function(t){e.call(n,new Zf(r._firestore,r._userDataWriter,t.key,t,new Jf(r._snapshot.mutatedKeys.has(t.key),r._snapshot.fromCache),r.query.converter))})},ep.prototype.docChanges=function(t){t=!!(t=void 0===t?{}:t).includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Vr(xr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,e){if(i._snapshot.oldDocs.isEmpty()){var n=0;return i._snapshot.docChanges.map(function(t){var e=new Zf(i._firestore,i._userDataWriter,t.doc.key,t.doc,new Jf(i._snapshot.mutatedKeys.has(t.doc.key),i._snapshot.fromCache),i.query.converter);return t.doc,{type:"added",doc:e,oldIndex:-1,newIndex:n++}})}var o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(function(t){return e||3!==t.type}).map(function(t){var e=new Zf(i._firestore,i._userDataWriter,t.doc.key,t.doc,new Jf(i._snapshot.mutatedKeys.has(t.doc.key),i._snapshot.fromCache),i.query.converter),n=-1,r=-1;return 0!==t.type&&(n=o.indexOf(t.doc.key),o=o.delete(t.doc.key)),1!==t.type&&(r=(o=o.add(t.doc)).indexOf(t.doc.key)),{type:function(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Wr()}}(t.type),doc:e,oldIndex:n,newIndex:r}})}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges},ep);function ep(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new Jf(r.hasPendingWrites,r.fromCache),this.query=n}function np(){return null!==Yf&&Yf.apply(this,arguments)||this}function rp(t,e,n,r,i,o){var s=this;return(s=Xf.call(this,t,e,n,r,o)||this)._firestore=t,s._firestoreImpl=t,s.metadata=i,s}function ip(t,e){this.hasPendingWrites=t,this.fromCache=e}function op(t,e){return t instanceof $f&&e instanceof $f?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof tp&&e instanceof tp&&t._firestore===e._firestore&&Vl(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}function sp(t){if(Co(t)&&0===t.explicitOrderBy.length)throw new Vr(xr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}D=function(){};function ap(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0,i=e;r<i.length;r++)t=i[r]._apply(t);return t}var up,cp,hp,lp,fp,pp=(n(Ep,fp=D),Ep.prototype._apply=function(t){var e=pf(t.firestore),e=function(t,e,n,r,i,o){if(r.isKeyField()){if("array-contains"===i||"array-contains-any"===i)throw new Vr(xr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+i+"' queries on FieldPath.documentId().");if("in"===i||"not-in"===i){Sp(o,i);for(var s=[],a=0,u=o;a<u.length;a++){var c=u[a];s.push(Ip(n,t,c))}h={arrayValue:{values:s}}}else h=Ip(n,t,o)}else"in"!==i&&"not-in"!==i&&"array-contains-any"!==i||Sp(o,i),h=Lf(e,"where",o,"in"===i||"not-in"===i);var h=Xi.create(r,i,h);return function(t,e){if(e.g()){var n=ko(t);if(null!==n&&!n.isEqual(e.field))throw new Vr(xr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");n=Ro(t);null!==n&&Ap(0,e.field,n)}t=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(0<=e.indexOf(i.op))return i.op}return null}(t,function(){switch(e.op){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}());if(null!==t)throw t===e.op?new Vr(xr.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter."):new Vr(xr.INVALID_ARGUMENT,"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+t.toString()+"' filters.")}(t,h),h}(t._query,e,t.firestore._databaseId,this.Kc,this.jc,this.Wc);return new Dl(t.firestore,t.converter,(t=t._query,e=t.filters.concat([e]),new Ao(t.path,t.collectionGroup,t.explicitOrderBy.slice(),e,t.limit,t.limitType,t.startAt,t.endAt)))},Ep),dp=(n(_p,lp=D),_p.prototype._apply=function(t){var e=function(t,e,n){if(null!==t.startAt)throw new Vr(xr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new Vr(xr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new To(e,n);return e=r,null!==Ro(n=t)||null!==(t=ko(n))&&Ap(0,t,e.field),r}(t._query,this.Kc,this.Gc);return new Dl(t.firestore,t.converter,(t=t._query,e=t.explicitOrderBy.concat([e]),new Ao(t.path,t.collectionGroup,e,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)))},_p),yp=(n(bp,hp=D),bp.prototype._apply=function(t){return new Dl(t.firestore,t.converter,Mo(t._query,this.zc,this.Hc))},bp),gp=(n(wp,cp=D),wp.prototype._apply=function(t){var e=Tp(t,this.type,this.Jc,this.Yc);return new Dl(t.firestore,t.converter,(t=t._query,e=e,new Ao(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)))},wp),vp=(n(mp,up=D),mp.prototype._apply=function(t){var e=Tp(t,this.type,this.Jc,this.Yc);return new Dl(t.firestore,t.converter,(t=t._query,e=e,new Ao(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)))},mp);function mp(t,e,n){var r=this;return(r=up.call(this)||this).type=t,r.Jc=e,r.Yc=n,r}function wp(t,e,n){var r=this;return(r=cp.call(this)||this).type=t,r.Jc=e,r.Yc=n,r}function bp(t,e,n){var r=this;return(r=hp.call(this)||this).type=t,r.zc=e,r.Hc=n,r}function _p(t,e){var n=this;return(n=lp.call(this)||this).Kc=t,n.Gc=e,n.type="orderBy",n}function Ep(t,e,n){var r=this;return(r=fp.call(this)||this).Kc=t,r.jc=e,r.Wc=n,r.type="where",r}function Tp(t,c,e,n){if(e[0]=m(e[0]),e[0]instanceof Kf)return function(t,e,n,r){if(!n)throw new Vr(xr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+c+"().");for(var i=[],o=0,s=Lo(t);o<s.length;o++){var a=s[o];if(a.field.isKeyField())i.push(Li(e,n.key));else{var u=n.data.field(a.field);if(_i(u))throw new Vr(xr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+a.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===u){a=a.field.canonicalString();throw new Vr(xr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+a+"' (used as the orderBy) does not exist.")}i.push(u)}}return new vo(i,r)}(t._query,t.firestore._databaseId,e[0]._document,n);var r=pf(t.firestore);return function(t,e,n,r,i,o){var s=t.explicitOrderBy;if(i.length>s.length)throw new Vr(xr.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var a=[],u=0;u<i.length;u++){var c=i[u];if(s[u].field.isKeyField()){if("string"!=typeof c)throw new Vr(xr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!Oo(t)&&-1!==c.indexOf("/"))throw new Vr(xr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var h=t.path.child(ai.fromString(c));if(!Si.isDocumentKey(h))throw new Vr(xr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+h+"' is not because it contains an odd number of segments.");h=new Si(h);a.push(Li(e,h))}else{c=Lf(n,r,c);a.push(c)}}return new vo(a,o)}(t._query,t.firestore._databaseId,r,c,e,n)}function Ip(t,e,n){if("string"==typeof(n=m(n))){if(""===n)throw new Vr(xr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!Oo(e)&&-1!==n.indexOf("/"))throw new Vr(xr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");e=e.path.child(ai.fromString(n));if(!Si.isDocumentKey(e))throw new Vr(xr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+e+"' is not because it has an odd number of segments ("+e.length+").");return Li(t,new Si(e))}if(n instanceof Nl)return Li(t,n._key);throw new Vr(xr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+_l(n)+".")}function Sp(t,e){if(!Array.isArray(t)||0===t.length)throw new Vr(xr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(10<t.length)throw new Vr(xr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.")}function Ap(t,e,n){if(!n.isEqual(e))throw new Vr(xr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}Np.prototype.convertValue=function(t,e){switch(void 0===e&&(e="none"),Ni(t)){case 0:return null;case 1:return t.booleanValue;case 2:return wi(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(bi(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw Wr()}},Np.prototype.convertObject=function(t,n){var r=this,i={};return ri(t.fields,function(t,e){i[t]=r.convertValue(e,n)}),i},Np.prototype.convertGeoPoint=function(t){return new $l(wi(t.latitude),wi(t.longitude))},Np.prototype.convertArray=function(t,e){var n=this;return(t.values||[]).map(function(t){return n.convertValue(t,e)})},Np.prototype.convertServerTimestamp=function(t,e){switch(e){case"previous":var n=function t(e){e=e.mapValue.fields.__previous_value__;return _i(e)?t(e):e}(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(Ei(t));default:return null}},Np.prototype.convertTimestamp=function(t){t=mi(t);return new $r(t.seconds,t.nanos)},Np.prototype.convertDocumentKey=function(t,e){var n=ai.fromString(t);Qr(La(n));t=new rl(n.get(1),n.get(3)),n=new Si(n.popFirst(5));return t.isEqual(e)||Gr("Document "+n+" contains a document reference within a different database ("+t.projectId+"/"+t.database+") which is not supported. It will be treated as a reference in the current database ("+e.projectId+"/"+e.database+") instead."),n},T=Np;function Np(){}function Dp(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var Cp,Rp=(n(Lp,Cp=T),Lp.prototype.convertBytes=function(t){return new Xl(t)},Lp.prototype.convertReference=function(t){t=this.convertDocumentKey(t,this.firestore._databaseId);return new Nl(this.firestore,null,t)},Lp),kp=(Op.prototype.set=function(t,e,n){this._verifyNotCommitted();t=Pp(t,this._firestore),e=Dp(t.converter,e,n),n=df(this._dataReader,"WriteBatch.set",t._key,e,null!==t.converter,n);return this._mutations.push(n.toMutation(t._key,cs.none())),this},Op.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];this._verifyNotCommitted();t=Pp(t,this._firestore),e="string"==typeof(e=m(e))||e instanceof Yl?Of(this._dataReader,"WriteBatch.update",t._key,e,n,r):kf(this._dataReader,"WriteBatch.update",t._key,e);return this._mutations.push(e.toMutation(t._key,cs.exists(!0))),this},Op.prototype.delete=function(t){this._verifyNotCommitted();t=Pp(t,this._firestore);return this._mutations=this._mutations.concat(new Ds(t._key,cs.none())),this},Op.prototype.commit=function(){return this._verifyNotCommitted(),this._committed=!0,0<this._mutations.length?this._commitHandler(this._mutations):Promise.resolve()},Op.prototype._verifyNotCommitted=function(){if(this._committed)throw new Vr(xr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},Op);function Op(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=pf(t)}function Lp(t){var e=this;return(e=Cp.call(this)||this).firestore=t,e}function Pp(t,e){if((t=m(t)).firestore!==e)throw new Vr(xr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}var Mp,Fp=(n(xp,Mp=T),xp.prototype.convertBytes=function(t){return new Xl(t)},xp.prototype.convertReference=function(t){t=this.convertDocumentKey(t,this.firestore._databaseId);return new Nl(this.firestore,null,t)},xp);function xp(t){var e=this;return(e=Mp.call(this)||this).firestore=t,e}function Vp(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];t=El(t,Nl);var o=El(t.firestore,Kl),s=pf(o);return qp(o,[("string"==typeof(e=m(e))||e instanceof Yl?Of(s,"updateDoc",t._key,e,n,r):kf(s,"updateDoc",t._key,e)).toMutation(t._key,cs.exists(!0))])}function Up(e){for(var n=[],t=1;t<arguments.length;t++)n[t-1]=arguments[t];e=m(e);var r={includeMetadataChanges:!1},i=0;"object"!=typeof n[i]||jl(n[i])||(r=n[i],i++);var o,s,a,u,c,h,l={includeMetadataChanges:r.includeMetadataChanges};return jl(n[i])&&(o=n[i],n[i]=null===(r=o.next)||void 0===r?void 0:r.bind(o),n[i+1]=null===(r=o.error)||void 0===r?void 0:r.bind(o),n[i+2]=null===(r=o.complete)||void 0===r?void 0:r.bind(o)),e instanceof Nl?(a=El(e.firestore,Kl),u=No(e._key.path),h={next:function(t){n[i]&&n[i](jp(a,e,t))},error:n[i+1],complete:n[i+2]}):(s=El(e,Dl),a=El(s.firestore,Kl),u=s._query,c=new Fp(a),h={next:function(t){n[i]&&n[i](new tp(a,c,s,t))},error:n[i+1],complete:n[i+2]},sp(e._query)),function(n,t,e){var r=this,i=new Fh(h),o=new th(t,i,e);return n.asyncQueue.enqueueAndForget(function(){return y(r,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=Jc,[4,$h(n)];case 1:return[2,e.apply(void 0,[t.sent(),o])]}})})}),function(){i.Wo(),n.asyncQueue.enqueueAndForget(function(){return y(r,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=$c,[4,$h(n)];case 1:return[2,e.apply(void 0,[t.sent(),o])]}})})})}}(Ql(a),u,l)}function qp(t,e){return function(n,r){var t=this,i=new Pa;return n.asyncQueue.enqueueAndForget(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=mh,[4,Jh(n)];case 1:return[2,e.apply(void 0,[t.sent(),r,i])]}})})}),i.promise}(Ql(t),e)}function jp(t,e,n){var r=n.docs.get(e._key),i=new Fp(t);return new $f(t,i,e._key,r,new Jf(n.hasPendingWrites,n.fromCache),e.converter)}var Bp,Gp=(Hp.prototype.get=function(t){var e=this,n=Pp(t,this._firestore),r=new Rp(this._firestore);return this._transaction.lookup([n._key]).then(function(t){if(!t||1!==t.length)return Wr();t=t[0];if(t.isFoundDocument())return new Kf(e._firestore,r,t.key,t,n.converter);if(t.isNoDocument())return new Kf(e._firestore,r,n._key,null,n.converter);throw Wr()})},Hp.prototype.set=function(t,e,n){t=Pp(t,this._firestore),e=Dp(t.converter,e,n),n=df(this._dataReader,"Transaction.set",t._key,e,null!==t.converter,n);return this._transaction.set(t._key,n),this},Hp.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];t=Pp(t,this._firestore),e="string"==typeof(e=m(e))||e instanceof Yl?Of(this._dataReader,"Transaction.update",t._key,e,n,r):kf(this._dataReader,"Transaction.update",t._key,e);return this._transaction.update(t._key,e),this},Hp.prototype.delete=function(t){t=Pp(t,this._firestore);return this._transaction.delete(t._key),this},n(Kp,Bp=Hp),Kp.prototype.get=function(t){var e=this,n=Pp(t,this._firestore),r=new Fp(this._firestore);return Bp.prototype.get.call(this,t).then(function(t){return new $f(e._firestore,r,n._key,t._document,new Jf(!1,!1),n.converter)})},Kp);function Kp(t,e){var n=this;return(n=Bp.call(this,t,e)||this)._firestore=t,n}function Hp(t,e){this._firestore=t,this._transaction=e,this._dataReader=pf(t)}function Wp(){if("undefined"==typeof Uint8Array)throw new Vr(xr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function Qp(){if("undefined"==typeof atob)throw new Vr(xr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var zp,Yp=(rd.fromBase64String=function(t){return Qp(),new rd(Xl.fromBase64String(t))},rd.fromUint8Array=function(t){return Wp(),new rd(Xl.fromUint8Array(t))},rd.prototype.toBase64=function(){return Qp(),this._delegate.toBase64()},rd.prototype.toUint8Array=function(){return Wp(),this._delegate.toUint8Array()},rd.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},rd.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},rd),Xp="You are using the memory-only build of Firestore. Persistence support is only available via the @firebase/firestore bundle or the firebase-firestore.js build.",Jp=(nd.prototype.enableIndexedDbPersistence=function(t,e){throw new Vr(xr.FAILED_PRECONDITION,Xp)},nd.prototype.enableMultiTabIndexedDbPersistence=function(t){throw new Vr(xr.FAILED_PRECONDITION,Xp)},nd.prototype.clearIndexedDbPersistence=function(t){throw new Vr(xr.FAILED_PRECONDITION,Xp)},nd),$p=(Object.defineProperty(ed.prototype,"_databaseId",{get:function(){return this._delegate._databaseId},enumerable:!1,configurable:!0}),ed.prototype.settings=function(t){var e=this._delegate._getSettings();t.merge||e.host===t.host||Kr("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),t.merge&&delete(t=Object.assign(Object.assign({},e),t)).merge,this._delegate._setSettings(t)},ed.prototype.useEmulator=function(t,e,n){(function(t,e,n,r){void 0===r&&(r={});var i=(t=El(t,Al))._getSettings();if("firestore.googleapis.com"!==i.host&&i.host!==e&&Kr("Host has been set in both settings() and useEmulator(), emulator host will be used"),t._setSettings(Object.assign(Object.assign({},i),{host:e+":"+n,ssl:!1})),r.mockUserToken){n=function(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');var n=e||"demo-project",r=t.iat||0;if(!(e=t.sub||t.user_id))throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");return t=o({iss:"https://securetoken.google.com/"+n,aud:n,iat:r,exp:r+3600,auth_time:r,sub:e,user_id:e,firebase:{sign_in_provider:"custom",identities:{}}},t),[a.encodeString(JSON.stringify({alg:"none",type:"JWT"}),!1),a.encodeString(JSON.stringify(t),!1),""].join(".")}(r.mockUserToken),r=r.mockUserToken.sub||r.mockUserToken.user_id;if(!r)throw new Vr(xr.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");t._credentials=new sl(new el(n,new Ou(r)))}})(this._delegate,t,e,n=void 0===n?{}:n)},ed.prototype.enableNetwork=function(){return function(i){var t=this;return i.asyncQueue.enqueue(function(){return y(t,void 0,void 0,function(){var n,r;return g(this,function(t){switch(t.label){case 0:return[4,zh(i)];case 1:return n=t.sent(),[4,Xh(i)];case 2:return r=t.sent(),[2,(n.setNetworkEnabled(!0),(e=r).Or.delete(0),Ec(e))]}var e})})})}(Ql(El(this._delegate,Kl)))},ed.prototype.disableNetwork=function(){return function(r){var t=this;return r.asyncQueue.enqueue(function(){return y(t,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return[4,zh(r)];case 1:return e=t.sent(),[4,Xh(r)];case 2:return n=t.sent(),[2,(e.setNetworkEnabled(!1),function(n){return y(this,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return(e=n).Or.add(0),[4,Tc(e)];case 1:return t.sent(),e.Br.set("Offline"),[2]}})})}(n))]}})})})}(Ql(El(this._delegate,Kl)))},ed.prototype.enablePersistence=function(t){var e=!1,n=!1;return t&&ml("synchronizeTabs",e=!!t.synchronizeTabs,"experimentalForceOwningTab",n=!!t.experimentalForceOwningTab),e?this.Xc.enableMultiTabIndexedDbPersistence(this):this.Xc.enableIndexedDbPersistence(this,n)},ed.prototype.clearPersistence=function(){return this.Xc.clearIndexedDbPersistence(this)},ed.prototype.terminate=function(){return this.Zc&&(this.Zc._removeServiceInstance("firestore"),this.Zc._removeServiceInstance("firestore-exp")),this._delegate._delete()},ed.prototype.waitForPendingWrites=function(){return function(n){var t=this,r=new Pa;return n.asyncQueue.enqueueAndForget(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=_h,[4,Jh(n)];case 1:return[2,e.apply(void 0,[t.sent(),r])]}})})}),r.promise}(Ql(El(this._delegate,Kl)))},ed.prototype.onSnapshotsInSync=function(t){return e=this._delegate,t=t,function(n,t){var e=this,r=new Fh(t);return n.asyncQueue.enqueueAndForget(function(){return y(e,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=function(t,e){t.Gr.add(e),e.next()},[4,$h(n)];case 1:return[2,e.apply(void 0,[t.sent(),r])]}})})}),function(){r.Wo(),n.asyncQueue.enqueueAndForget(function(){return y(e,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=function(t,e){t.Gr.delete(e)},[4,$h(n)];case 1:return[2,e.apply(void 0,[t.sent(),r])]}})})})}}(Ql(El(e,Kl)),jl(t)?t:{next:t});var e},Object.defineProperty(ed.prototype,"app",{get:function(){if(!this.Zc)throw new Vr(xr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.Zc},enumerable:!1,configurable:!0}),ed.prototype.collection=function(t){try{return new Ed(this,Ml(this._delegate,t))}catch(t){throw fd(t,"collection()","Firestore.collection()")}},ed.prototype.doc=function(t){try{return new hd(this,Fl(this._delegate,t))}catch(t){throw fd(t,"doc()","Firestore.doc()")}},ed.prototype.collectionGroup=function(t){try{return new wd(this,function(t,e){if(t=El(t,Al),gl("collectionGroup","collection id",e),0<=e.indexOf("/"))throw new Vr(xr.INVALID_ARGUMENT,"Invalid collection ID '"+e+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new Dl(t,null,(e=e,new Ao(ai.emptyPath(),e)))}(this._delegate,t))}catch(t){throw fd(t,"collectionGroup()","Firestore.collectionGroup()")}},ed.prototype.runTransaction=function(e){var n,r=this;return function(n,r){var t=this,i=new Pa;return n.asyncQueue.enqueueAndForget(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return[4,Qh(n).then(function(t){return t.datastore})];case 1:return e=t.sent(),new Uh(n.asyncQueue,e,r,i).run(),[2]}})})}),i.promise}(Ql(n=this._delegate),function(t){return t=new Gp(n,t),e(new id(r,t))})},ed.prototype.batch=function(){var e=this;return Ql(this._delegate),new od(new kp(this._delegate,function(t){return qp(e._delegate,t)}))},ed.prototype.loadBundle=function(t){throw new Vr(xr.FAILED_PRECONDITION,'"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?')},ed.prototype.namedQuery=function(t){throw new Vr(xr.FAILED_PRECONDITION,'"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?')},ed),Zp=(n(td,zp=T),td.prototype.convertBytes=function(t){return new Yp(new Xl(t))},td.prototype.convertReference=function(t){t=this.convertDocumentKey(t,this.firestore._databaseId);return hd.tu(t,this.firestore,null)},td);function td(t){var e=this;return(e=zp.call(this)||this).firestore=t,e}function ed(t,e,n){var r=this;this._delegate=e,this.Xc=n,this.INTERNAL={delete:function(){return r.terminate()}},t instanceof rl||(this.Zc=t)}function nd(){}function rd(t){this._delegate=t}var id=(cd.prototype.get=function(t){var e=this,n=Cd(t);return this._delegate.get(n).then(function(t){return new vd(e._firestore,new $f(e._firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,n.converter))})},cd.prototype.set=function(t,e,n){t=Cd(t);return n?(vl("Transaction.set",n),this._delegate.set(t,e,n)):this._delegate.set(t,e),this},cd.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o=Cd(t);return 2===arguments.length?this._delegate.update(o,e):(t=this._delegate).update.apply(t,s([o,e,n],r)),this},cd.prototype.delete=function(t){t=Cd(t);return this._delegate.delete(t),this},cd),od=(ud.prototype.set=function(t,e,n){t=Cd(t);return n?(vl("WriteBatch.set",n),this._delegate.set(t,e,n)):this._delegate.set(t,e),this},ud.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o=Cd(t);return 2===arguments.length?this._delegate.update(o,e):(t=this._delegate).update.apply(t,s([o,e,n],r)),this},ud.prototype.delete=function(t){t=Cd(t);return this._delegate.delete(t),this},ud.prototype.commit=function(){return this._delegate.commit()},ud),sd=(ad.prototype.fromFirestore=function(t,e){t=new Zf(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new md(this._firestore,t),null!=e?e:{})},ad.prototype.toFirestore=function(t,e){return e?this._delegate.toFirestore(t,e):this._delegate.toFirestore(t)},ad.eu=function(t,e){var n=ad.nu,r=n.get(t);r||(r=new WeakMap,n.set(t,r));n=r.get(e);return n||(n=new ad(t,new Zp(t),e),r.set(e,n)),n},ad);function ad(t,e,n){this._firestore=t,this._userDataWriter=e,this._delegate=n}function ud(t){this._delegate=t}function cd(t,e){this._firestore=t,this._delegate=e,this._userDataWriter=new Zp(t)}sd.nu=new WeakMap;var hd=(ld.su=function(t,e,n){if(t.length%2!=0)throw new Vr(xr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.canonicalString()+" has "+t.length);return new ld(e,new Nl(e._delegate,n,new Si(t)))},ld.tu=function(t,e,n){return new ld(e,new Nl(e._delegate,n,t))},Object.defineProperty(ld.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(ld.prototype,"parent",{get:function(){return new Ed(this.firestore,this._delegate.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(ld.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),ld.prototype.collection=function(t){try{return new Ed(this.firestore,Ml(this._delegate,t))}catch(t){throw fd(t,"collection()","DocumentReference.collection()")}},ld.prototype.isEqual=function(t){return(t=m(t))instanceof Nl&&xl(this._delegate,t)},ld.prototype.set=function(t,e){e=vl("DocumentReference.set",e);try{return function(t,e,n){t=El(t,Nl);var r=El(t.firestore,Kl),e=Dp(t.converter,e,n);return qp(r,[df(pf(r),"setDoc",t._key,e,null!==t.converter,n).toMutation(t._key,cs.none())])}(this._delegate,t,e)}catch(t){throw fd(t,"setDoc()","DocumentReference.set()")}},ld.prototype.update=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];try{return 1===arguments.length?Vp(this._delegate,t):Vp.apply(void 0,s([this._delegate,t,e],n))}catch(t){throw fd(t,"updateDoc()","DocumentReference.update()")}},ld.prototype.delete=function(){return qp(El((t=this._delegate).firestore,Kl),[new Ds(t._key,cs.none())]);var t},ld.prototype.onSnapshot=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=pd(t),i=dd(t,function(t){return new vd(e.firestore,new $f(e.firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,e._delegate.converter))});return Up(this._delegate,r,i)},ld.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(e){e=El(e,Nl);var n=El(e.firestore,Kl),t=Ql(n),r=new Fp(n);return function(n,r){var t=this,i=new Pa;return n.asyncQueue.enqueueAndForget(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=function(o,s,a){return y(this,void 0,void 0,function(){var r,i;return g(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,(e=s,(n=o).persistence.runTransaction("read document","readonly",function(t){return n.Mn.mn(t,e)}))];case 1:return(i=t.sent()).isFoundDocument()?a.resolve(i):i.isNoDocument()?a.resolve(null):a.reject(new Vr(xr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return r=t.sent(),i=Bc(r,"Failed to get document '"+s+" from cache"),a.reject(i),[3,3];case 3:return[2]}var e,n})})},[4,Yh(n)];case 1:return[2,e.apply(void 0,[t.sent(),r,i])]}})})}),i.promise}(t,e._key).then(function(t){return new $f(n,r,e._key,t,new Jf(null!==t&&t.hasLocalMutations,!0),e.converter)})}:"server"===(null==t?void 0:t.source)?function(e){e=El(e,Nl);var n=El(e.firestore,Kl);return Zh(Ql(n),e._key,{source:"server"}).then(function(t){return jp(n,e,t)})}:function(e){e=El(e,Nl);var n=El(e.firestore,Kl);return Zh(Ql(n),e._key).then(function(t){return jp(n,e,t)})})(this._delegate).then(function(t){return new vd(e.firestore,new $f(e.firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,e._delegate.converter))})},ld.prototype.withConverter=function(t){return new ld(this.firestore,t?this._delegate.withConverter(sd.eu(this.firestore,t)):this._delegate.withConverter(null))},ld);function ld(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new Zp(t)}function fd(t,e,n){return t.message=t.message.replace(e,n),t}function pd(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if("object"==typeof r&&!jl(r))return r}return{}}function dd(t,e){var n;return{next:function(t){n.next&&n.next(e(t))},error:null===(t=(n=jl(t[0])?t[0]:jl(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]}).error)||void 0===t?void 0:t.bind(n),complete:null===(t=n.complete)||void 0===t?void 0:t.bind(n)}}var yd,gd,vd=(Object.defineProperty(Dd.prototype,"ref",{get:function(){return new hd(this._firestore,this._delegate.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(Dd.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(Dd.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(Dd.prototype,"exists",{get:function(){return this._delegate.exists()},enumerable:!1,configurable:!0}),Dd.prototype.data=function(t){return this._delegate.data(t)},Dd.prototype.get=function(t,e){return this._delegate.get(t,e)},Dd.prototype.isEqual=function(t){return op(this._delegate,t._delegate)},Dd),md=(n(Nd,gd=vd),Nd.prototype.data=function(t){return this._delegate.data(t)},Nd),wd=(Ad.prototype.where=function(t,e,n){try{return new Ad(this.firestore,ap(this._delegate,(r=n,i=e,o=zf("where",t),new pp(o,i,r))))}catch(t){throw fd(t,/(orderBy|where)\(\)/,"Query.$1()")}var r,i,o},Ad.prototype.orderBy=function(t,e){try{return new Ad(this.firestore,ap(this._delegate,(n=void 0===e?"asc":e,r=zf("orderBy",t),new dp(r,n))))}catch(t){throw fd(t,/(orderBy|where)\(\)/,"Query.$1()")}var n,r},Ad.prototype.limit=function(t){try{return new Ad(this.firestore,ap(this._delegate,(Tl("limit",e=t),new yp("limit",e,"F"))))}catch(t){throw fd(t,"limit()","Query.limit()")}var e},Ad.prototype.limitToLast=function(t){try{return new Ad(this.firestore,ap(this._delegate,(Tl("limitToLast",e=t),new yp("limitToLast",e,"L"))))}catch(t){throw fd(t,"limitToLast()","Query.limitToLast()")}var e},Ad.prototype.startAt=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new Ad(this.firestore,ap(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new gp("startAt",t,!0)}.apply(void 0,t)))}catch(t){throw fd(t,"startAt()","Query.startAt()")}},Ad.prototype.startAfter=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new Ad(this.firestore,ap(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new gp("startAfter",t,!1)}.apply(void 0,t)))}catch(t){throw fd(t,"startAfter()","Query.startAfter()")}},Ad.prototype.endBefore=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new Ad(this.firestore,ap(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new vp("endBefore",t,!0)}.apply(void 0,t)))}catch(t){throw fd(t,"endBefore()","Query.endBefore()")}},Ad.prototype.endAt=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new Ad(this.firestore,ap(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new vp("endAt",t,!1)}.apply(void 0,t)))}catch(t){throw fd(t,"endAt()","Query.endAt()")}},Ad.prototype.isEqual=function(t){return Vl(this._delegate,t._delegate)},Ad.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(e){e=El(e,Dl);var n=El(e.firestore,Kl),t=Ql(n),r=new Fp(n);return function(n,r){var t=this,i=new Pa;return n.asyncQueue.enqueueAndForget(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=function(i,o,s){return y(this,void 0,void 0,function(){var e,n,r;return g(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,wu(i,o,!0)];case 1:return r=t.sent(),e=new lh(o,r.Bn),n=e._o(r.documents),n=e.applyChanges(n,!1),s.resolve(n.snapshot),[3,3];case 2:return n=t.sent(),r=Bc(n,"Failed to execute query '"+o+" against cache"),s.reject(r),[3,3];case 3:return[2]}})})},[4,Yh(n)];case 1:return[2,e.apply(void 0,[t.sent(),r,i])]}})})}),i.promise}(t,e._query).then(function(t){return new tp(n,r,e,t)})}:"server"===(null==t?void 0:t.source)?function(e){e=El(e,Dl);var n=El(e.firestore,Kl),t=Ql(n),r=new Fp(n);return tl(t,e._query,{source:"server"}).then(function(t){return new tp(n,r,e,t)})}:function(e){e=El(e,Dl);var n=El(e.firestore,Kl),t=Ql(n),r=new Fp(n);return sp(e._query),tl(t,e._query).then(function(t){return new tp(n,r,e,t)})})(this._delegate).then(function(t){return new _d(e.firestore,new tp(e.firestore._delegate,e._userDataWriter,e._delegate,t._snapshot))})},Ad.prototype.onSnapshot=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=pd(t),i=dd(t,function(t){return new _d(e.firestore,new tp(e.firestore._delegate,e._userDataWriter,e._delegate,t._snapshot))});return Up(this._delegate,r,i)},Ad.prototype.withConverter=function(t){return new Ad(this.firestore,t?this._delegate.withConverter(sd.eu(this.firestore,t)):this._delegate.withConverter(null))},Ad),bd=(Object.defineProperty(Sd.prototype,"type",{get:function(){return this._delegate.type},enumerable:!1,configurable:!0}),Object.defineProperty(Sd.prototype,"doc",{get:function(){return new md(this._firestore,this._delegate.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(Sd.prototype,"oldIndex",{get:function(){return this._delegate.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(Sd.prototype,"newIndex",{get:function(){return this._delegate.newIndex},enumerable:!1,configurable:!0}),Sd),_d=(Object.defineProperty(Id.prototype,"query",{get:function(){return new wd(this._firestore,this._delegate.query)},enumerable:!1,configurable:!0}),Object.defineProperty(Id.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(Id.prototype,"size",{get:function(){return this._delegate.size},enumerable:!1,configurable:!0}),Object.defineProperty(Id.prototype,"empty",{get:function(){return this._delegate.empty},enumerable:!1,configurable:!0}),Object.defineProperty(Id.prototype,"docs",{get:function(){var e=this;return this._delegate.docs.map(function(t){return new md(e._firestore,t)})},enumerable:!1,configurable:!0}),Id.prototype.docChanges=function(t){var e=this;return this._delegate.docChanges(t).map(function(t){return new bd(e._firestore,t)})},Id.prototype.forEach=function(e,n){var r=this;this._delegate.forEach(function(t){e.call(n,new md(r._firestore,t))})},Id.prototype.isEqual=function(t){return op(this._delegate,t._delegate)},Id),Ed=(n(Td,yd=wd),Object.defineProperty(Td.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(Td.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Object.defineProperty(Td.prototype,"parent",{get:function(){var t=this._delegate.parent;return t?new hd(this.firestore,t):null},enumerable:!1,configurable:!0}),Td.prototype.doc=function(t){try{return new hd(this.firestore,void 0===t?Fl(this._delegate):Fl(this._delegate,t))}catch(t){throw fd(t,"doc()","CollectionReference.doc()")}},Td.prototype.add=function(t){var e,n,r,i=this;return e=this._delegate,n=t,t=El(e.firestore,Kl),r=Fl(e),n=Dp(e.converter,n),qp(t,[df(pf(e.firestore),"addDoc",r._key,n,null!==e.converter,{}).toMutation(r._key,cs.exists(!1))]).then(function(){return r}).then(function(t){return new hd(i.firestore,t)})},Td.prototype.isEqual=function(t){return xl(this._delegate,t._delegate)},Td.prototype.withConverter=function(t){return new Td(this.firestore,t?this._delegate.withConverter(sd.eu(this.firestore,t)):this._delegate.withConverter(null))},Td);function Td(t,e){var n=this;return(n=yd.call(this,t,e)||this).firestore=t,n._delegate=e,n}function Id(t,e){this._firestore=t,this._delegate=e}function Sd(t,e){this._firestore=t,this._delegate=e}function Ad(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new Zp(t)}function Nd(){return null!==gd&&gd.apply(this,arguments)||this}function Dd(t,e){this._firestore=t,this._delegate=e}function Cd(t){return El(t,Nl)}kd.documentId=function(){return new kd(ci.keyField().canonicalString())},kd.prototype.isEqual=function(t){return(t=m(t))instanceof Yl&&this._delegate._internalPath.isEqual(t._internalPath)},D=kd,Rd.serverTimestamp=function(){var t=new Tf("serverTimestamp");return t._methodName="FieldValue.serverTimestamp",new Rd(t)},Rd.delete=function(){var t=new gf("deleteField");return t._methodName="FieldValue.delete",new Rd(t)},Rd.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new If("arrayUnion",t)}.apply(void 0,t);return n._methodName="FieldValue.arrayUnion",new Rd(n)},Rd.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Sf("arrayRemove",t)}.apply(void 0,t);return n._methodName="FieldValue.arrayRemove",new Rd(n)},Rd.increment=function(t){t=new Af("increment",t);return t._methodName="FieldValue.increment",new Rd(t)},Rd.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},T=Rd;function Rd(t){this._delegate=t}function kd(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._delegate=new(Yl.bind.apply(Yl,s([void 0],t)))}function Od(t){return e=this._delegate,s=t,n=Ql(e=El(e,Kl)),t=new Gl,function(n,t,r){var e,i=this,o=(e=s,t=sc(t),e=function(t){if(t instanceof Uint8Array)return Mh(t,void 0);if(t instanceof ArrayBuffer)return Mh(new Uint8Array(t),void 0);if(t instanceof ReadableStream)return t.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}("string"==typeof e?(new TextEncoder).encode(e):e),new xh(e,t));n.asyncQueue.enqueueAndForget(function(){return y(i,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=Rh,[4,Jh(n)];case 1:return e.apply(void 0,[t.sent(),o,r]),[2]}})})})}(n,e._databaseId,t),t;var e,s,n}function Ld(t){var e=this,n=this._delegate,t=t;return function(n,r){var t=this;return n.asyncQueue.enqueue(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=function(t,e){var n=t;return n.persistence.runTransaction("Get named query","readonly",function(t){return n.Qe.getNamedQuery(t,e)})},[4,Yh(n)];case 1:return[2,e.apply(void 0,[t.sent(),r])]}})})})}(Ql(n=El(n,Kl)),t).then(function(t){return t?new Dl(n,null,t.query):null}).then(function(t){return t?new wd(e,t):null})}var Pd=(Md.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},Md.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},Md.prototype.setServiceProps=function(t){return this.serviceProps=t,this},Md.prototype.setInstanceCreatedCallback=function(t){return this.onInstanceCreated=t,this},Md);function Md(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}var Fd,xd,Vd={Firestore:$p,GeoPoint:$l,Timestamp:$r,Blob:Yp,Transaction:id,WriteBatch:od,DocumentReference:hd,DocumentSnapshot:vd,Query:wd,QueryDocumentSnapshot:md,QuerySnapshot:_d,CollectionReference:Ed,FieldPath:D,FieldValue:T,setLogLevel:function(t){Ur.setLogLevel(t)},CACHE_SIZE_UNLIMITED:-1};(Fd=e.default).INTERNAL.registerComponent(new Pd("firestore",function(t){var e=t.getProvider("app").getImmediate();return e=e,t=t.getProvider("auth-internal"),new $p(e,new Kl(e,t),new Jp)},"PUBLIC").setServiceProps(Object.assign({},Vd))),Fd.registerVersion("@firebase/firestore","2.3.7"),(xd=$p).prototype.loadBundle=Od,xd.prototype.namedQuery=Ld}.apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-firestore.memory.js - be sure to load firebase-app.js first.")}});
//# sourceMappingURL=firebase-firestore.memory.js.map
